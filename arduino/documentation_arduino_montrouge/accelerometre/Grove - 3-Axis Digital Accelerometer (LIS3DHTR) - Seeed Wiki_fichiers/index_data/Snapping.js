!function(e){function t(t){for(var r,a,s=t[0],u=t[1],c=t[2],f=0,p=[];f<s.length;f++)a=s[f],Object.prototype.hasOwnProperty.call(i,a)&&i[a]&&p.push(i[a][0]),i[a]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);for(l&&l(t);p.length;)p.shift()();return o.push.apply(o,c||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],r=!0,s=1;s<n.length;s++){var u=n[s];0!==i[u]&&(r=!1)}r&&(o.splice(t--,1),e=a(a.s=n[0]))}return e}var r={},i={48:0},o=[];function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=r,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var s=window.webpackJsonp=window.webpackJsonp||[],u=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var l=u;o.push([1132,2]),n()}({1132:function(e,t,n){e.exports=n(1193)},1193:function(e,t,n){"use strict";n.r(t);var r=n(20),i=n(7);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s,u;!function(e){e[e.None=0]="None",e[e.trackVertices=1]="trackVertices",e[e.padCenters=2]="padCenters",e[e.padVertices=4]="padVertices",e[e.viaCenters=8]="viaCenters",e[e.footprintOrigins=16]="footprintOrigins",e[e.polyObjects=32]="polyObjects",e[e.AllPoints=63]="AllPoints",e[e.Default=59]="Default"}(s||(s={})),function(e){e[e.None=0]="None",e[e.center=1]="center"}(u||(u={}));var c,l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a(this,"auto",void 0),a(this,"enabled",void 0),a(this,"objects",void 0),a(this,"userDistance",void 0),a(this,"autoDistance",void 0),a(this,"autoDistanceMil",void 0),this.enabled=!0,this.objects=s.Default,this.auto=!0,this.userDistance=15,this.autoDistance=10,this.autoDistanceMil=15}var t,n,r;return t=e,(n=[{key:"distance",get:function(){return Math.round(this.auto?this.autoDistanceMil:this.userDistance)}},{key:"updateDistance",value:function(e){e.getSize();var t=e.pixelsToUnits(1)/.01;this.autoDistanceMil=t*this.autoDistance}},{key:"apply",value:function(e){e&&(this.auto=null!=e.auto?e.auto:this.auto,this.enabled=null!=e.enabled?e.enabled:this.enabled,this.objects=e.objects?e.objects:this.objects,this.autoDistance=e.autoDistance?Math.abs(e.autoDistance):this.autoDistance,this.userDistance=e.userDistance?Math.abs(e.userDistance):this.userDistance)}}])&&o(t.prototype,n),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();!function(e){e[e.Cross=1]="Cross",e[e.Circle=2]="Circle",e[e.Box=3]="Box",e[e.Triangle=4]="Triangle"}(c||(c={}));var f=n(124),p=n(158),h=n(100),g=n(220);function d(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var b=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"serialize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n={};Object.assign(n,e);var r,i=d(t);try{for(i.s();!(r=i.n()).done;){var o=r.value;n[o]=void 0}}catch(e){i.e(e)}finally{i.f()}return JSON.stringify(n)}},{key:"deserialize",value:function(e,t){var n=JSON.parse(e);Object.assign(t,n)}}],(n=null)&&v(t.prototype,n),r&&v(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function P(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k(this,n)}}function k(e,t){if(t&&("object"===m(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function x(e,t,n){return t&&O(e.prototype,t),n&&O(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function j(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var C=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&w(e,t)}(n,e);var t=P(n);function n(e,r,i,o,a,s){var u;return j(this,n),(u=t.call(this,e,r,i,o)).column=a,u.row=s,u}return x(n)}(x((function e(t,n,r,i){j(this,e),this.point=t,this.object=n,this.item=r,this.layer=i})));function D(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var T=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new p.a,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new p.a;D(this,e),L(this,"size",void 0),L(this,"groupSize",void 0),L(this,"points",void 0),this.groupSize=n,this.points=[];var r=this.convertToGroupPosition(t.width,t.height);this.size=r?new p.a(r.x,r.y):new p.a}var t,n,r;return t=e,(n=[{key:"clear",value:function(){this.points=[]}},{key:"save",value:function(){return b.serialize(this)}},{key:"load",value:function(e){return b.deserialize(e,this),this}},{key:"count",value:function(){return this.points.length}},{key:"get",value:function(){return this.points}},{key:"addPoint",value:function(e,t,n,r){if(!Number.isSafeInteger(r))return!1;var i=this.getGroupPosition(e);if(!i)return!1;var o=new C(e,t,n,r,i.x,i.y);return this.points.push(o),!0}},{key:"getGroupPosition",value:function(e){var t=e[0],n=e[1];if(Number.isNaN(t)||Number.isNaN(n)||!Number.isFinite(t)||!Number.isFinite(n))return null;var r=this.convertToGroupPosition(t,n);return r.x<0||r.y<0||r.x>=this.size.width||r.y>=this.size.height?null:r}},{key:"convertToGroupPosition",value:function(e,t){var n=Math.floor(e/this.groupSize.width),r=Math.floor(t/this.groupSize.height);return new g.a(n,r)}}])&&M(t.prototype,n),r&&M(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function R(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function N(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function z(e,t,n){return t&&N(e.prototype,t),n&&N(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _=function(){function e(){R(this,e),I(this,"data",void 0),I(this,"status",void 0)}return z(e,[{key:"setData",value:function(e){return this.data=e,this.status="RunProcessing",this}},{key:"setCancelled",value:function(){return this.status="CancelProcessing",this}}]),e}(),A=function(){function e(){R(this,e),I(this,"data",void 0),I(this,"status",void 0)}return z(e,[{key:"setData",value:function(e){return this.data=e,this.status="SnappingChankReady",this}},{key:"setFinished",value:function(){return this.status="SnappingFinished",this}}]),e}();function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var U=function(){function e(t,n){var r,i,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.timeout=t,this.logger=n,o=void 0,(i="timeStamp")in(r=this)?Object.defineProperty(r,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[i]=o,this.timeStamp=Date.now()}var t,n,r;return t=e,(n=[{key:"reset",value:function(){this.timeStamp=Date.now()}},{key:"hasTimeout",value:function(){var e=2*this.timeout,t=Date.now()-this.timeStamp,n=t>=this.timeout;return n&&t>e&&this.logger.LogDebug("Timeout is much exceeded: ".concat(t," mSec")),n}},{key:"timeoutExceeding",get:function(){var e=Date.now()-this.timeStamp-this.timeout;return e>0?e:0}}])&&E(t.prototype,n),r&&E(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function G(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var B=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,n=null,r=[{key:"getArcPoints",value:regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,{point:n.center,item:u.center};case 2:return t.next=4,{point:e.getPointOnArc(n.center,n.radius,n.angles[0]),item:u.None};case 4:return t.next=6,{point:e.getPointOnArc(n.center,n.radius,n.angles[1]),item:u.None};case 6:case"end":return t.stop()}}),t)}))},{key:"getLinePoints",value:regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,{point:[t.from[0]+(t.to[0]-t.from[0])/2,t.from[1]+(t.to[1]-t.from[1])/2],item:u.center};case 2:return e.next=4,{point:t.from,item:u.None};case 4:return e.next=6,{point:t.to,item:u.None};case 6:case"end":return e.stop()}}),e)}))},{key:"getPolyPoints",value:regeneratorRuntime.mark((function e(t,n){var r,i,o,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.getPolygonByID(n.polygon),i=r.GetVertices(),o=0;case 3:if(!(o<i.length)){e.next=11;break}return a=n.position[0]+i[o].position[0]*n.scale[0],s=n.position[1]+i[o].position[1]*n.scale[1],e.next=8,{point:[a,s],item:u.None};case 8:++o,e.next=3;break;case 11:case"end":return e.stop()}}),e)}))},{key:"getUniPoints",value:regeneratorRuntime.mark((function t(n){var r,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=.5*n.size[0],i=.5*n.size[1],0!==n.radius){t.next=13;break}return t.next=5,{point:e.transformUniPoint([-r,-i],n),item:u.None};case 5:return t.next=7,{point:e.transformUniPoint([-r,i],n),item:u.None};case 7:return t.next=9,{point:e.transformUniPoint([r,-i],n),item:u.None};case 9:return t.next=11,{point:e.transformUniPoint([r,i],n),item:u.None};case 11:t.next=29;break;case 13:return t.next=15,{point:e.transformUniPoint([-r+n.radius,-i],n),item:u.None};case 15:return t.next=17,{point:e.transformUniPoint([-r+n.radius,i],n),item:u.None};case 17:return t.next=19,{point:e.transformUniPoint([r-n.radius,-i],n),item:u.None};case 19:return t.next=21,{point:e.transformUniPoint([r-n.radius,i],n),item:u.None};case 21:return t.next=23,{point:e.transformUniPoint([-r,-i+n.radius],n),item:u.None};case 23:return t.next=25,{point:e.transformUniPoint([-r,i-n.radius],n),item:u.None};case 25:return t.next=27,{point:e.transformUniPoint([r,-i+n.radius],n),item:u.None};case 27:return t.next=29,{point:e.transformUniPoint([r,i-n.radius],n),item:u.None};case 29:case"end":return t.stop()}}),t)}))},{key:"getUniTrackPoints",value:regeneratorRuntime.mark((function t(n){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.size[0]>n.size[1]?[.5*n.size[0]-n.radius,0]:[0,.5*n.size[1]-n.radius],t.next=3,{point:n.position,item:u.center};case 3:return t.next=5,{point:e.transformUniPoint([r[0],r[1]],n),item:u.None};case 5:return t.next=7,{point:e.transformUniPoint([-r[0],-r[1]],n),item:u.None};case 7:case"end":return t.stop()}}),t)}))},{key:"getPointOnArc",value:function(e,t,n){return[e[0]+t*Math.cos(n),e[1]+t*Math.sin(n)]}},{key:"transformUniPoint",value:function(e,t){return[(e=this.rotatePoint(e,t.direction))[0]+t.position[0],e[1]+t.position[1]]}},{key:"rotatePoint",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0],r=t[0],i=t[1];return[r*(e[0]-n[0])-i*(e[1]-n[1])+n[0],i*(e[0]-n[0])+r*(e[1]-n[1])+n[1]]}}],n&&G(t.prototype,n),r&&G(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function F(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var V=function(){function e(t){var n,r,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i=void 0,(r="name")in(n=this)?Object.defineProperty(n,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[r]=i,this.name=t}var t,n,r;return t=e,(n=[{key:"LogDebug",value:function(e){console.log(this.name+"\t\t|  "+this.getFormattedDate()+" | "+e)}},{key:"getFormattedDate",value:function(){var e=new Date(Date.now());return"".concat(e.getFullYear(),"-").concat(e.getMonth()+1,"-").concat(e.getDate()," ").concat(e.getHours(),":").concat(e.getMinutes(),":").concat(e.getSeconds(),".").concat(e.getMilliseconds())}}])&&F(t.prototype,n),r&&F(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function J(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return K(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return K(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function K(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function W(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Y(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){W(o,r,i,a,s,"next",e)}function s(e){W(o,r,i,a,s,"throw",e)}a(void 0)}))}}function $(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var X=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),q(this,"tickTimeLimit",100),q(this,"pointCountLimit",1e5),q(this,"timeLimiter",void 0),q(this,"cancellationToken",void 0),q(this,"logger",void 0),q(this,"layers",void 0),q(this,"snappingPoints",void 0),q(this,"pointCount",void 0),q(this,"timeLoad",void 0),this.logger=new V("SnappingProcessor"),this.cancellationToken=t,this.timeLimiter=new U(this.tickTimeLimit,this.logger)}var t,n,r,i,o,a,c,l,g;return t=e,n=[{key:"processAndSend",value:(g=Y(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.timeLoad=0,this.pointCount=new Map,this.snappingPoints=this.createStorage(n),!this.snappingPoints){e.next=9;break}return this.loadLayers(t,n),this.loadComponents(n),e.next=8,this.loadPrimitives(t,n);case 8:this.sendPoints();case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return g.apply(this,arguments)})},{key:"createStorage",value:function(t){var n=e.getSizes(t);return n?new T(n.boardSize,n.groupSize):new T}},{key:"loadLayers",value:function(e,t){var n=e.layers,r=t.layers;this.layers=r.map((function(e){var t={id:e.id,name:e.name,index:-1,used:!1},r=n.find((function(t){return!(t.is_barrel||t.is_cutout||t.is_inverted||t.is_keepout||t.name!=e.searchName)}));return r&&(t.index=r.index),t})).filter((function(e){return-1!=e.index}))}},{key:"loadComponents",value:function(e){for(var t,n,r=null!==(t=null==e||null===(n=e.components)||void 0===n?void 0:n.length)&&void 0!==t?t:0,i=0;i<r;i++){var o=e.components[i];o.pcbId&&(this.addPoint([o.pcbLocationX,o.pcbLocationY],s.footprintOrigins,u.None,o.layerId),this.cancellationToken.throwIfCancellationRequested())}}},{key:"loadPrimitives",value:(l=Y(regeneratorRuntime.mark((function e(t,n){var r,i,o,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(null!==(r=null==n||null===(i=n.primitives)||void 0===i?void 0:i.length)&&void 0!==r?r:0)){e.next=2;break}return e.abrupt("return");case 2:return o=n.primitives.filter((function(e){return e.pcbId})),a=t.getNodeItemsByIds(o.map((function(e){return e.pcbId}))),o.length!=a.length&&(s=Math.min(o.length,a.length),o=o.slice(0,s),a=a.slice(0,s)),e.next=7,this.loadPrimitivesData(t,o,a);case 7:this.loadComplete();case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"loadComplete",value:function(){var e=this;this.logger.LogDebug("Loaded layers: ".concat(this.layers.filter((function(e){return e.used})).map((function(e){return e.name})).join(", "),"."));var t=0;this.pointCount.forEach((function(n,r){t+=n,e.logger.LogDebug("... ".concat(s[r]," - ").concat(n," points."))})),this.logger.LogDebug("Total: ".concat(t," points in ").concat(this.timeLoad," ms"))}},{key:"loadPrimitivesData",value:(c=Y(regeneratorRuntime.mark((function e(t,n,r){var i,o,a,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=(new Date).getTime(),o=0;case 2:if(!(o<n.length)){e.next=27;break}if(a=n[o],c=r[o],a.pcbId&&c){e.next=7;break}return e.abrupt("continue",24);case 7:if(l=this.layers.find((function(e){return e.id===a.layerId}))){e.next=10;break}return e.abrupt("continue",24);case 10:e.t0=this.getKind(a),e.next=e.t0===f.c.Arc||e.t0===f.c.Track?13:e.t0===f.c.Via?16:e.t0===f.c.Pad?18:e.t0===f.c.Poly||e.t0===f.c.Region||e.t0===f.c.Fill?20:23;break;case 13:return e.next=15,this.processGeometry(t,a,c,s.trackVertices,l.index);case 15:return e.abrupt("break",24);case 16:return this.addPoint([a.x,a.y],s.viaCenters,u.None,a.layerId),e.abrupt("break",24);case 18:return this.addPoint([a.x,a.y],s.padCenters,u.None,a.layerId),e.abrupt("break",24);case 20:return e.next=22,this.processGeometry(t,a,c,s.polyObjects,l.index);case 22:return e.abrupt("break",24);case 23:return e.abrupt("continue",24);case 24:o++,e.next=2;break;case 27:this.timeLoad+=(new Date).getTime()-i;case 29:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return c.apply(this,arguments)})},{key:"getKind",value:function(e){return 255&e.kind}},{key:"addPoint",value:function(e,t,n,r){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(i&&(e=[e[0]/1e6,e[1]/1e6]),this.snappingPoints.addPoint(e,t,n,r)){if(this.pointCount.has(t)){var o=this.pointCount.get(t);this.pointCount.set(t,o+1)}else this.pointCount.set(t,1);var a=this.layers.find((function(e){return e.id===r}));a&&(a.used=!0)}this.snappingPoints.count()>=this.pointCountLimit&&this.sendPoints(),this.cancellationToken.throwIfCancellationRequested()}},{key:"sendPoints",value:function(){var e=this.snappingPoints.save();postMessage((new A).setData(e)),this.snappingPoints.clear()}},{key:"processGeometry",value:(a=Y(regeneratorRuntime.mark((function e(t,n,r,i,o){var a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=0;case 1:if(!(a<r.GetLayersCount())){e.next=10;break}if(!(s=r.GetLayerGeometry(a))||s.GetLayerIndex()!==o){e.next=7;break}return e.next=6,this.processGeometryItems(t,n,s,i);case 6:return e.abrupt("break",10);case 7:a++,e.next=1;break;case 10:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,i){return a.apply(this,arguments)})},{key:"processGeometryItems",value:(o=Y(regeneratorRuntime.mark((function e(t,n,r,i){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.processItems(r.GetArcsCount(),(function(e){return r.GetArc(e)}),B.getArcPoints,i,n.layerId);case 2:return e.next=4,this.processItems(r.GetLinesCount(),(function(e){return r.GetLine(e)}),B.getLinePoints,i,n.layerId);case 4:return e.next=6,this.processItems(r.GetPolysCount(),(function(e){return r.GetPoly(e)}),(function(e){return B.getPolyPoints(t,e)}),i,n.layerId);case 6:if(this.getKind(n)!=f.c.Track){e.next=11;break}return e.next=9,this.processItems(r.GetUnisCount(),(function(e){return r.GetUni(e)}),B.getUniTrackPoints,i,n.layerId);case 9:e.next=13;break;case 11:return e.next=13,this.processItems(r.GetUnisCount(),(function(e){return r.GetUni(e)}),B.getUniPoints,i,n.layerId);case 13:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return o.apply(this,arguments)})},{key:"processItems",value:(i=Y(regeneratorRuntime.mark((function e(t,n,r,i,o){var a,s,u,c,l,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=0;case 1:if(!(a<t)){e.next=13;break}s=n(a),u=r(s),c=J(u);try{for(c.s();!(l=c.n()).done;)f=l.value,this.addPoint(f.point,i,f.item,o,!1)}catch(e){c.e(e)}finally{c.f()}if(!this.timeLimiter.hasTimeout()){e.next=10;break}return e.next=9,Object(h.a)();case 9:this.timeLimiter.reset();case 10:a++,e.next=1;break;case 13:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,o){return i.apply(this,arguments)})}],r=[{key:"getSizes",value:function(e){var t=null==e?void 0:e.pcbDocument;return t&&t.horizontal&&t.vertical?{boardSize:new p.a(t.horizontal,t.vertical),groupSize:new p.a(.01*this.groupSizeMil,.01*this.groupSizeMil)}:null}}],n&&$(t.prototype,n),r&&$(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function H(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Q(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Q(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Q(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Z(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ee(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function te(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}q(X,"groupSizeMil",50);var ne=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new p.a,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new p.a;Z(this,e),te(this,"logger",void 0),te(this,"size",void 0),te(this,"discreteSize",void 0),te(this,"discreteStorage",void 0),te(this,"pointCount",0),te(this,"searchTime",0),te(this,"searchCount",0),te(this,"searchDiscreteCount",0),te(this,"searchPointCount",0),this.logger=r.a.createLogger("Snapping"),this.discreteSize=n;var i=this.getDiscretePosition(t.width,t.height);i&&(this.size=new p.a(i.x,i.y),this.discreteStorage=new Array(this.size.width),this.clearStatistic())}var t,n,i;return t=e,(n=[{key:"addPoints",value:function(e){var t,n=H(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.discreteStorage[r.column]||(this.discreteStorage[r.column]=new Array(this.size.height)),this.discreteStorage[r.column][r.row]||(this.discreteStorage[r.column][r.row]=[]),this.discreteStorage[r.column][r.row].push(r),this.pointCount++}}catch(e){n.e(e)}finally{n.f()}}},{key:"getSize",value:function(){return this.size}},{key:"getPointCount",value:function(){return this.pointCount}},{key:"getDiscretePosition",value:function(e,t){return new g.a(Math.floor(e/this.discreteSize.width),Math.floor(t/this.discreteSize.height))}},{key:"clampPosition",value:function(e){var t=this.clamp(e.x,0,this.size.width-1),n=this.clamp(e.y,0,this.size.height-1);return new g.a(t,n)}},{key:"getAllPoints",value:function(e,t){var n=this;if(!this.discreteStorage)return[];for(var r=[],i=0;i<this.size.width;i++){var o=this.discreteStorage[i];if(o)for(var a=0;a<this.size.height;a++){var s=o[a];if(s){var u=s.filter((function(r){return n.filterPoint(r,e,t)})).map((function(e){return e.point}));r=r.concat(u)}}}return r}},{key:"filterPoint",value:function(e,t,n){return!!e&&0!=(e.object&t.objects)&&n.includes(e.layer)}},{key:"getClosestPoint",value:function(e,t,n){if(!(this.discreteStorage&&0!==t.distance&&t.objects&s.AllPoints))return null;(new Date).getTime();var r=.01*t.distance;if(!this.getDiscretePosition(e[0],e[1]))return null;for(var i=Number.MAX_VALUE,o=null,a=Math.pow(r,2),u=this.clampPosition(this.getDiscretePosition(e[0]-r,e[1]-r)),l=this.clampPosition(this.getDiscretePosition(e[0]+r,e[1]+r)),f=u.x;f<=l.x;f++){var p=this.discreteStorage[f];if(p)for(var h=u.y;h<=l.y;h++){var g=p[h];if(g)for(var d=0;d<g.length;d++){var y=g[d];if(this.filterPoint(y,t,n)){var v=Math.pow(y.point[0]-e[0],2)+Math.pow(y.point[1]-e[1],2);v<a&&v<i&&(i=v,o=y)}}}}return o?{point:o.point,layer:o.layer,object:o.object,item:o.item,cursor:c.Cross}:null}},{key:"setStatistic",value:function(e,t,n,r){if(0!==n&&(this.searchCount++,this.searchTime+=r,this.searchDiscreteCount+=t,this.searchPointCount+=n,100===this.searchCount)){var i=Math.round(this.searchTime/100),o=Math.round(this.searchDiscreteCount/100),a=Math.round(this.searchPointCount/100);this.logger.LogDebug("Distance ".concat(e,"mil. Average search ").concat(a," points in ").concat(o," groups for ").concat(i," ms.")),this.clearStatistic()}}},{key:"clearStatistic",value:function(){this.searchTime=0,this.searchCount=0,this.searchDiscreteCount=0,this.searchPointCount=0}},{key:"clamp",value:function(e,t,n){return Math.max(t,Math.min(e,n))}}])&&ee(t.prototype,n),i&&ee(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function re(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ie(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var oe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ie(this,"logger",void 0),ie(this,"scene",void 0),ie(this,"options",void 0),ie(this,"storage",void 0),ie(this,"snappingPoint",null),ie(this,"showSnappings",!1),ie(this,"snappingNode",null),ie(this,"materialId",null),ie(this,"allLayers",void 0),ie(this,"layers",void 0),ie(this,"layerManager",void 0),this.logger=r.a.createLogger("Snapping"),this.options=new l}var t,n,o;return t=e,(n=[{key:"setup",value:function(){}},{key:"fillStorage",value:function(e){switch(this.storage||this.createStorage(),e.status){case"SnappingChankReady":var t=(new T).load(e.data);this.storage.addPoints(t.get()),this.logger.LogDebug("Added points: "+t.get().length);break;case"SnappingFinished":this.logger.LogDebug("Storage data is ready. Point count: ".concat(this.storage.getPointCount())),r.a.bus.emit("Snapping:loaded")}}},{key:"createStorage",value:function(){var e=X.getSizes(r.a.response.metadata);this.storage=e?new ne(e.boardSize,e.groupSize):new ne}},{key:"init",value:function(e,t){this.scene=e,this.layerManager=t,this.allLayers=t.getLayers(),this.setLayers(this.allLayers,!1)}},{key:"checkPoint",value:function(e){return this.snappingPoint=null,this.options.enabled&&this.storage&&(this.options.updateDistance(this.scene),this.snappingPoint=this.storage.getClosestPoint(e,this.options,this.layers),this.setCursor(this.snappingPoint)),this.isSnapped()}},{key:"getPoint",value:function(){return this.snappingPoint}},{key:"isSnapped",value:function(){return!!this.snappingPoint}},{key:"getOptions",value:function(){return this.options}},{key:"setOptions",value:function(e){e?this.options.apply(e):this.options=new l,this.updateDisplay()}},{key:"setLayers",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.filter((function(e){return e.isVisible&&!e.ignored||"Multi-Layer"===e.searchName}));this.layers=n.map((function(e){return e.metaId})),t&&this.updateDisplay()}},{key:"resetLayers",value:function(){this.layerManager&&(this.layerManager.resetLayers(),this.setLayers(this.layerManager.getLayers()))}},{key:"setLayerOnly",value:function(e){var t,n=null===(t=this.allLayers)||void 0===t?void 0:t.filter((function(t){return t.name==e||"Multi-Layer"===t.searchName}));null!=n&&n.length&&(this.layers=n.map((function(e){return e.metaId})),this.updateDisplay())}},{key:"show",value:function(){this.showSnappings=!0,this.updateDisplay()}},{key:"hide",value:function(){this.showSnappings=!1,this.updateDisplay()}},{key:"updateDisplay",value:function(){if(this.snappingNode&&(this.scene.removeItem(this.snappingNode),this.snappingNode=null),this.storage&&this.showSnappings){null===this.materialId&&(this.materialId=this.scene.addMaterial(new i.Material([0,175,14,255],void 0,void 0,!0,!1)));var e=new i.NodeContainer,t=this.storage.getAllPoints(this.options,this.layers);e.arcs.length=t.length;for(var n=0;n<t.length;n++)e.arcs[n]=i.Arc.createCircleFill(t[n][0],t[n][1],.05,this.materialId);var r=this.scene.layerMap.GetLayersCount()-2;this.snappingNode=this.scene.addNode(r,e)}}},{key:"setCursor",value:function(e){if(e)switch(e.object){case s.trackVertices:e.item==u.center?e.cursor=c.Triangle:e.cursor=c.Box;break;case s.polyObjects:e.cursor=c.Box;break;case s.padCenters:case s.viaCenters:e.cursor=c.Circle;break;default:e.cursor=c.Cross}}}])&&re(t.prototype,n),o&&re(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();function ae(){return new Worker(n.p+"snapping.threadWorker.worker.js?1651593835594")}function se(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ue(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ce=window.__CORE__,le=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ue(this,"worker",void 0),ue(this,"logger",void 0),this.logger=new V("Snapping ThreadRunner"),this.logger.LogDebug("Runned."),ce.bus.on("PcbLoader:onLoad",(function(e){var n;null===(n=t.worker)||void 0===n||n.postMessage((new _).setData({data:e,metadata:ce.response.metadata}))})),ce.bus.registerEvent("ThreadRunner:snappingPointsChunkReady")}var t,n,r;return t=e,(n=[{key:"runThread",value:function(){if(window.Worker)try{this.worker=new ae,this.worker.onmessage=function(e){ce.bus.emit("ThreadRunner:snappingPointsChunkReady",e.data)},this.logger.LogDebug("Thread started")}catch(e){this.logger.LogDebug("Can't load thread worker: ".concat(e))}else this.logger.LogDebug("Your browser doesn't support web workers.")}},{key:"terminateThread",value:function(){var e;null===(e=this.worker)||void 0===e||e.terminate(),this.logger.LogDebug("Thread terminated")}},{key:"cancelSnappingProcessing",value:function(){var e;null===(e=this.worker)||void 0===e||e.postMessage((new _).setCancelled()),this.logger.LogDebug("Snapping cancelled")}}])&&se(t.prototype,n),r&&se(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function fe(e){return(fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function pe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function he(e,t){return(he=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ge(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ye(e);if(t){var i=ye(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return de(this,n)}}function de(e,t){if(t&&("object"===fe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function ye(e){return(ye=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ve=window.__CORE__,be=(0,window.__APP__.createModule)({type:"Plugin",description:"Snapping",create:function(e){return new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&he(e,t)}(o,e);var t,n,r,i=ge(o);function o(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(e=i.call(this,{name:"Snapping",comment:"Snapping",description:"Snapping"})).logger=window.__CORE__.createLogger("Snapping"),e.snappingManager=new oe,e.threadRuner=new le,e.threadRuner.runThread(),ve.bus.on("ThreadRunner:snappingPointsChunkReady",(function(t){return e.snappingManager.fillStorage(t)})),ve.bus.on("Snapping:loaded",(function(){e.threadRuner.terminateThread()})),ve.bus.on("Snapping:getPoint",(function(t,n){n.result=e.snappingManager.getPoint(),n.snapped=e.snappingManager.isSnapped()})),ve.bus.on("Snapping:checkPoint",(function(t){var n=t.point;e.snappingManager.checkPoint(n),t.result=e.snappingManager.getPoint(),t.snapped=e.snappingManager.isSnapped()})),ve.bus.on("Snapping:setOptions",(function(t){e.snappingManager.setOptions(t)})),ve.bus.on("Snapping:getOptions",(function(t){t.options=e.snappingManager.getOptions()})),ve.bus.on("Snapping:show",(function(t){e.snappingManager.show()})),ve.bus.on("Snapping:hide",(function(t){e.snappingManager.hide()})),ve.bus.on("GraphiteEngine:createdScene2D",(function(t){e.scene=t})),ve.bus.on("PcbEngine:layerManagerCreated",(function(t){e.snappingManager.init(e.scene,t)})),ve.bus.on("Layers:change",(function(t){e.snappingManager.setLayers(t.flat())})),ve.bus.on("Layers:offOnly",(function(t){e.snappingManager.setLayers(t.flat())})),ve.bus.on("Layers:onOnly",(function(t){e.snappingManager.setLayerOnly(t)})),ve.bus.on("Layers:reset",(function(){e.snappingManager.resetLayers()})),e}return t=o,(n=[{key:"events",get:function(){return["Snapping:loaded","Snapping:getPoint","Snapping:checkPoint","Snapping:setOptions","Snapping:getOptions","Snapping:show","Snapping:hide"]}},{key:"setup",value:function(){var e=this;return new Promise((function(t){e.logger.LogDebug("Setup"),e.snappingManager.setup(),t()}))}}])&&pe(t.prototype,n),r&&pe(t,r),Object.defineProperty(t,"prototype",{writable:!1}),o}(e))}});ve&&ve.addModule(be)}});