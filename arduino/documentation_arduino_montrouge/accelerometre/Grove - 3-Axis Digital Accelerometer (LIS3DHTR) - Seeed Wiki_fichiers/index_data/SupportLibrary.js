!function(t){function e(e){for(var r,a,s=e[0],u=e[1],l=e[2],h=0,f=[];h<s.length;h++)a=s[h],Object.prototype.hasOwnProperty.call(i,a)&&i[a]&&f.push(i[a][0]),i[a]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(t[r]=u[r]);for(c&&c(e);f.length;)f.shift()();return o.push.apply(o,l||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],r=!0,s=1;s<n.length;s++){var u=n[s];0!==i[u]&&(r=!1)}r&&(o.splice(e--,1),t=a(a.s=n[0]))}return t}var r={},i={50:0},o=[];function a(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=r,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)a.d(n,r,function(e){return t[e]}.bind(null,r));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="";var s=window.webpackJsonp=window.webpackJsonp||[],u=s.push.bind(s);s.push=e,s=s.slice();for(var l=0;l<s.length;l++)e(s[l]);var c=u;o.push([1143,2]),n()}({1143:function(t,e,n){t.exports=n(1185)},1185:function(t,e,n){"use strict";n.r(e);var r=n(7),i=n(20);function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var a,s=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n,r;return e=t,n=null,r=[{key:"getUniTrackSize",value:function(t){return t.size[0]>t.size[1]?[.5*t.size[0]-t.radius,0]:[0,.5*t.size[1]-t.radius]}},{key:"transformUniPoint",value:function(t,e){return[(t=this.rotatePoint(t,e.direction))[0]+e.position[0],t[1]+e.position[1]]}},{key:"rotatePoint",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0],r=e[0],i=e[1];return[r*(t[0]-n[0])-i*(t[1]-n[1])+n[0],i*(t[0]-n[0])+r*(t[1]-n[1])+n[1]]}},{key:"getUniAngles",value:function(t,e){var n=Math.atan2(e.direction[1],e.direction[0]);return[t[0]+n,t[1]+n]}},{key:"getArcVertices",value:regeneratorRuntime.mark((function t(e,n,r,i){var o,a,s,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o=i/n,a=r[0];case 2:if(!(a<=r[1])){t.next=10;break}return s=e[0]+n*Math.cos(a),u=e[1]+n*Math.sin(a),a+=o,t.next=8,[s,u];case 8:t.next=2;break;case 10:case"end":return t.stop()}}),t)}))},{key:"distanceBetweenSegments",value:function(e,n,r,i){var o,a;if(this.isIntersected(e,n,r,i)){var s,u=null!==(s=this.getCrossPoint(e,n,r,i))&&void 0!==s?s:e;return[0,new y(u,u)]}var l=Number.MAX_VALUE;return(a=t.distanceToSegmentSq(e,r,i))[0]<l&&(l=a[0],o=new y(e,a[1])),(a=t.distanceToSegmentSq(n,r,i))[0]<l&&(l=a[0],o=new y(n,a[1])),(a=t.distanceToSegmentSq(r,e,n))[0]<l&&(l=a[0],o=new y(a[1],r)),(a=t.distanceToSegmentSq(i,e,n))[0]<l&&(l=a[0],o=new y(a[1],i)),[l,o]}},{key:"isIntersected",value:function(t,e,n,r){var i=e[0]-t[0],o=e[1]-t[1],a=r[0]-n[0],s=r[1]-n[1],u=o*a-i*s,l=((t[0]-n[0])*s+(n[1]-t[1])*a)/u;if(Number.isNaN(l))return!1;var c=((n[0]-t[0])*o+(t[1]-n[1])*i)/-u;return l>=0&&l<=1&&c>=0&&c<=1}},{key:"getCrossPoint",value:function(t,e,n,r){var i;if(e[1]-t[1]!=0){var o=(e[0]-t[0])/(t[1]-e[1]),a=n[0]-r[0]+(n[1]-r[1])*o;if(!a)return null;i=(n[0]-t[0]+(n[1]-t[1])*o)/a}else{if(!(n[1]-r[1]))return null;i=(n[1]-t[1])/(n[1]-r[1])}return[n[0]+(r[0]-n[0])*i,n[1]+(r[1]-n[1])*i]}},{key:"distanceToSegmentSq",value:function(t,e,n){var r,i=n[0]-e[0],o=n[1]-e[1];if(0==i&&0==o)return r=e,[(i=t[0]-e[0])*i+(o=t[1]-e[1])*o,r];var a=((t[0]-e[0])*i+(t[1]-e[1])*o)/(i*i+o*o);return a<0?(r=[e[0],e[1]],i=t[0]-e[0],o=t[1]-e[1]):a>1?(r=[n[0],n[1]],i=t[0]-n[0],o=t[1]-n[1]):(r=[e[0]+a*i,e[1]+a*o],i=t[0]-r[0],o=t[1]-r[1]),[i*i+o*o,r]}},{key:"isOverlappedBoundRects",value:function(t,e,n,r){var i=Math.abs(e[0]-t[0]),o=Math.abs(e[1]-t[1]),a=Math.abs(r[0]-n[0]),s=Math.abs(r[1]-n[1]);return 2*Math.abs(t[0]+i/2-(n[0]+a/2))<i+a&&2*Math.abs(t[1]+o/2-(n[1]+s/2))<o+s}}],n&&o(e.prototype,n),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function u(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function c(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function h(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function a(t){c(o,r,i,a,s,"next",t)}function s(t){c(o,r,i,a,s,"throw",t)}a(void 0)}))}}function f(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function d(t,e,n){return e&&f(t.prototype,e),n&&f(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function p(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function v(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}!function(t){t[t.Vertices=0]="Vertices",t[t.Lines=1]="Lines",t[t.Both=2]="Both"}(a||(a={}));var y=d((function t(e,n){p(this,t),v(this,"from",void 0),v(this,"to",void 0),this.from=e,this.to=n})),g=function(){function t(){p(this,t),v(this,"layerIndex",void 0),v(this,"vertices",[]),v(this,"lines",[]),v(this,"_reduced",void 0),this._reduced=!1}return d(t,[{key:"reduced",get:function(){return this._reduced}},{key:"reduce",value:function(){this._reduced=!0,this.lines=[]}},{key:"addLine",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.Vertices;if(e&&!(e.length<2)){var r=n===a.Lines||n===a.Both,i=n===a.Vertices||n===a.Both;i&&this.vertices.push(e),(!this.reduced&&i||this.reduced&&r)&&t.buildLines(e,this.lines)}}},{key:"addArc",value:function(t,e,n){var r=Array.from(s.getArcVertices(t,e,n,.01));this.addLine(r)}}],[{key:"buildLines",value:function(t,e){for(var n=t[0],r=1;r<t.length;r++){var i=t[r];e.push(new y(n,i)),n=i}}}]),t}(),b=function(){function t(){p(this,t),v(this,"epsilon",1e-4),v(this,"scene2D",void 0),v(this,"logger",void 0),this.logger=i.a.createLogger("Support library")}var e,n;return d(t,[{key:"setScene2D",value:function(t){this.scene2D=t}},{key:"getContour",value:function(t){for(var e=[],n=0;n<t.length;n++){var r=t[n],i=new g;i.layerIndex=r.GetLayerIndex();for(var o=0;o<r.GetArcsCount();o++)this.addArcContour(i,r.GetArc(o));for(o=0;o<r.GetPolysCount();o++)this.addPolyContour(i,r.GetPoly(o));for(o=0;o<r.GetUnisCount();o++)this.addUniContour(i,r.GetUni(o));0!=i.vertices.length&&e.push(i)}return e}},{key:"getClosestDistance",value:(n=h(regeneratorRuntime.mark((function t(e,n){var r,i,o,a,s,l,c,h,f,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r=this.tryReduceContours(e,n,-1))){t.next=3;break}return t.abrupt("return",r);case 3:o=Number.MAX_VALUE,a=u(e),t.prev=5,a.s();case 7:if((s=a.n()).done){t.next=36;break}l=s.value,c=u(n),t.prev=10,c.s();case 12:if((h=c.n()).done){t.next=26;break}return f=h.value,t.next=16,this.getClosestLines(l.lines,f.lines,o);case 16:if(!(d=t.sent)){t.next=24;break}if((i=d).contour1=l,i.contour2=f,o=i.distance,0!==i.distance){t.next=24;break}return t.abrupt("return",i);case 24:t.next=12;break;case 26:t.next=31;break;case 28:t.prev=28,t.t0=t.catch(10),c.e(t.t0);case 31:return t.prev=31,c.f(),t.finish(31);case 34:t.next=7;break;case 36:t.next=41;break;case 38:t.prev=38,t.t1=t.catch(5),a.e(t.t1);case 41:return t.prev=41,a.f(),t.finish(41);case 44:return i&&(i.distance=Math.round(Math.sqrt(o)/.01*100)/100),t.abrupt("return",i);case 46:case"end":return t.stop()}}),t,this,[[5,38,41,44],[10,28,31,34]])}))),function(t,e){return n.apply(this,arguments)})},{key:"tryReduceContours",value:function(t,e,n){var r=this.logStatistic(t,e,n),i=this.needReduce(r[0],t[0].reduced,r[1],e[0].reduced);if(-1!==i){var o=[t,e],a=this.getReducedContours(t,e);return Array.isArray(a)?(o[i].forEach((function(t){return t.reduce()})),o[i][0].lines=a[i],this.tryReduceContours(t,e,i)):a}return null}},{key:"logStatistic",value:function(t,e,n){var r=0,i=0;t.forEach((function(t){return r+=t.lines.length})),e.forEach((function(t){return i+=t.lines.length}));var o=-1===n?"Precise":"Reduce #".concat(n);return this.logger.LogDebug("".concat(o,": ").concat(r," x ").concat(i," lines, ").concat(r*i," hits.")),[r,i]}},{key:"needReduce",value:function(t,e,n,r){return e&&r?-1:t*n>3e6?t>n?e?1:0:r?0:1:-1}},{key:"getReducedContours",value:function(t,e){var n=t.map((function(t){return t.vertices})).reduce((function(t,e){return t.concat(e)}),[]),r=e.map((function(t){return t.vertices})).reduce((function(t,e){return t.concat(e)}),[]);if(0!==n.length&&0!==r.length){var i,o=Number.MAX_VALUE,a=null,s=null,l=-1,c=-1,h=u(n);try{for(h.s();!(i=h.n()).done;){var f,d=i.value,p=u(r);try{for(p.s();!(f=p.n()).done;){for(var v=f.value,y=-1,g=-1,b=Number.MAX_VALUE,m=0;m<d.length;m++)for(var w=0;w<v.length;w++){var k=Math.pow(d[m][0]-v[w][0],2)+Math.pow(d[m][1]-v[w][1],2);b>k&&(y=m,g=w,b=k)}if(o>b&&(a=d,s=v,l=y,c=g,(o=b)<this.epsilon))return{contour1:t[0],point1:d[y],line1:null,contour2:e[0],point2:v[g],line2:null,distance:0}}}catch(t){p.e(t)}finally{p.f()}}}catch(t){h.e(t)}finally{h.f()}return[this.getReducedLines(a,l),this.getReducedLines(s,c)]}}},{key:"getReducedLines",value:function(t,e){var n=[];if(!t)return n;var r=Math.max(e-5,0),i=Math.min(e+5,t.length);return g.buildLines(t.slice(r,i),n),n}},{key:"getClosestLines",value:(e=h(regeneratorRuntime.mark((function t(e,n,r){var i,o,a,l,c,h,f,d,p,v;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o=u(e),t.prev=1,o.s();case 3:if((a=o.n()).done){t.next=32;break}l=a.value,c=u(n),t.prev=6,c.s();case 8:if((h=c.n()).done){t.next=22;break}if(f=h.value,!((d=s.distanceBetweenSegments(l.from,l.to,f.from,f.to))[0]<r)){t.next=20;break}if(r=d[0],i={contour1:null,point1:d[1].from,line1:l,contour2:null,point2:d[1].to,line2:f,distance:d[0]},!(r<this.epsilon)){t.next=20;break}return v=null!==(p=s.getCrossPoint(l.from,l.to,f.from,f.to))&&void 0!==p?p:i.point1,i.point1=v,i.point2=v,i.distance=0,t.abrupt("return",i);case 20:t.next=8;break;case 22:t.next=27;break;case 24:t.prev=24,t.t0=t.catch(6),c.e(t.t0);case 27:return t.prev=27,c.f(),t.finish(27);case 30:t.next=3;break;case 32:t.next=37;break;case 34:t.prev=34,t.t1=t.catch(1),o.e(t.t1);case 37:return t.prev=37,o.f(),t.finish(37);case 40:return t.abrupt("return",i);case 41:case"end":return t.stop()}}),t,this,[[1,34,37,40],[6,24,27,30]])}))),function(t,n,r){return e.apply(this,arguments)})},{key:"addUniContour",value:function(t,e){var n=.5*e.size[0],r=.5*e.size[1];if(e.radius<.01){var i=s.transformUniPoint([-n,-r],e),o=s.transformUniPoint([-n,r],e),a=s.transformUniPoint([n,r],e),u=s.transformUniPoint([n,-r],e);t.addLine([i,o,a,u])}else{var l=s.transformUniPoint([-n,-r+e.radius],e),c=s.transformUniPoint([-n,r-e.radius],e),h=s.transformUniPoint([-n+e.radius,r],e),f=s.transformUniPoint([n-e.radius,r],e),d=s.transformUniPoint([n,r-e.radius],e),p=s.transformUniPoint([n,-r+e.radius],e),v=s.transformUniPoint([n-e.radius,-r],e),y=s.transformUniPoint([-n+e.radius,-r],e);this.equalVectors(l,c)||t.addLine([l,c]),this.equalVectors(h,f)||t.addLine([h,f]),this.equalVectors(d,p)||t.addLine([d,p]),this.equalVectors(v,y)||t.addLine([v,y]),t.addArc(s.transformUniPoint([-n+e.radius,-r+e.radius],e),e.radius,s.getUniAngles([Math.PI,3*Math.PI/2],e)),t.addArc(s.transformUniPoint([-n+e.radius,r-e.radius],e),e.radius,s.getUniAngles([Math.PI/2,Math.PI],e)),t.addArc(s.transformUniPoint([n-e.radius,r-e.radius],e),e.radius,s.getUniAngles([0,Math.PI/2],e)),t.addArc(s.transformUniPoint([n-e.radius,-r+e.radius],e),e.radius,s.getUniAngles([3*Math.PI/2,2*Math.PI],e))}}},{key:"addPolyContour",value:function(t,e){for(var n=this.scene2D.getPolygonByID(e.polygon),r=n.GetOutlineIndices(),i=n.GetVertices(),o=null,a=null,s=1;s<r.length;s+=2){var u=e.position[0]+i[r[s-1]].position[0]*e.scale[0],l=e.position[1]+i[r[s-1]].position[1]*e.scale[1],c=e.position[0]+i[r[s]].position[0]*e.scale[0],h=e.position[1]+i[r[s]].position[1]*e.scale[1];this.equalVectors([u,l],[c,h])||(!o||o[0]===u&&o[1]===l||(t.addLine(a),a=null),a||(a=[]).push([u,l]),o=[c,h],a.push(o))}t.addLine(a)}},{key:"addArcContour",value:function(t,e){t.addArc(e.center,e.radius+e.width/2,e.angles),t.addArc(e.center,e.radius-e.width/2,e.angles);var n=e.center[0]+e.radius*Math.cos(e.angles[0]),r=e.center[1]+e.radius*Math.sin(e.angles[0]),i=e.angles[0],o=e.angles[0]-Math.PI;t.addArc([n,r],e.width/2,[o,i]),n=e.center[0]+e.radius*Math.cos(e.angles[1]),r=e.center[1]+e.radius*Math.sin(e.angles[1]),o=e.angles[1],i=e.angles[1]+Math.PI,t.addArc([n,r],e.width/2,[o,i])}},{key:"equalVectors",value:function(t,e){return t[0]===e[0]&&t[1]===e[1]}}]),t}();function m(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function w(t,e,n){return e&&m(t.prototype,e),n&&m(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function k(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var C=w((function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}));function P(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}k(C,"MetaInfo",'version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"'),k(C,"SvgStyles",'stroke-linecap="{0}" stroke-linejoin="{1}" fill="{2}"'),k(C,"XmlHeader",'<?xml version="1.0"  encoding="UTF-8" standalone="no"?>'),k(C,"DocHeader",'<svg {0} {1} width="{2}" height="{3}" data-doc-id="{4}">'),k(C,"DocFooter","</svg>"),k(C,"GroupHeader",'<g id = "{0}">'),k(C,"UnitGroupHeader",'<g data-unit-id="{0}">'),k(C,"VariantGroupHeader",'<g data-variant-id="{0}">'),k(C,"ClipGroupHeader",'<g> <clipPath id = "ClipRect{0}"> <rect x = "{1}" y="{2}" width="{3}" height="{4}"/></clipPath>'),k(C,"GroupFooter","</g>"),k(C,"Line",'<line x1="{0}" y1="{1}" x2="{2}" y2="{3}"{4}/>'),k(C,"Rect",'<rect x = "{0}" y="{1}" width="{2}" height="{3}"{4}{5}{6}/>'),k(C,"RectCorners",' rx="{0}" ry="{1}"'),k(C,"Fill",' fill="{0}" fill-opacity="{1}"'),k(C,"Text",'<text {0} x = "{1}" y="{2}" font-size="{3}px" font-family="{4}" fill="{5}" {6} {7} xml:space="preserve">{8}</text>'),k(C,"ClipUrl",'clip-path="url(#ClipRect{0})"'),k(C,"Polygon",'<polygon points = "{0}"{1}{2}/>'),k(C,"Points","{0},{1}"),k(C,"ArcPath","M{0},{1} A{2},{3} 0 {4},1 {5},{6}"),k(C,"Path",'<path{0} d="{1}"/>'),k(C,"Ellipse",'<ellipse cx="{0}" cy="{1}" rx="{2}" ry="{3}" {4}/>'),k(C,"Png","data:image/png;base64,"),k(C,"Image",'<image x = "{0}" y="{1}" width="{2}" height="{3}" xlink:href="{4}"/>'),k(C,"NonScalingPen",' stroke="{0}" stroke-width="{1}px" vector-effect="non-scaling-stroke"'),k(C,"PenWidth",' stroke="{0}" stroke-width="{1}px"'),k(C,"StrokeDash",' stroke-dasharray="4"'),k(C,"StrokeDot",' stroke-dasharray="2"'),k(C,"StrokeDashDot",' stroke-dasharray="4 2"'),k(C,"StrokeDashDotDot",' stroke-dasharray="4 2 2"'),k(C,"TextDecorations",'text-decoration="{0}"'),k(C,"Underline","underline"),k(C,"Strikout","line-through"),k(C,"Delimiter"," "),k(C,"Weight",'font-weight="{0}"'),k(C,"Italic",'font-style="italic"'),k(C,"Rotate",'transform= "rotate({0} {1} {2})"'),k(C,"stubPreview",'<?xml version="1.0"  encoding="UTF-8" standalone="no"?><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="100" height="100"><g id = "scene"><g id = "DocumentMainGroup"><g id = "BackgroundGroup"></g></g></g></svg>');var M=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n,r;return e=t,r=[{key:"normalizeAngle",value:function(t){for(var e=t;e>360;)e-=360;for(;e<0;)e+=360;return e}},{key:"GetPointFromAngle",value:function(t,e,n,r){return[t+n*Math.cos(this.toRadian(r)),e+n*Math.sin(this.toRadian(r))]}},{key:"getPointFromAngleForEllipse",value:function(t,e,n,r,i){var o=this.getRawVector2FromAngleForEllipse(t,e,n,r,i);return[Math.trunc(o[0]),Math.trunc(o[1])]}},{key:"getRawVector2FromAngleForEllipse",value:function(t,e,n,r,i){if(0==n||0==r)return[t,e];var o=this.toRadian(i),a=Math.cos(o),s=Math.sin(o),u=Math.sqrt(1/(Math.pow(a/n,2)+Math.pow(s/r,2)));return[t+u*a,e+u*s]}},{key:"toRadian",value:function(t){return t*Math.PI/180}}],(n=null)&&P(e.prototype,n),r&&P(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function S(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function D(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function x(t,e,n){return e&&D(t.prototype,e),n&&D(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function T(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var O,L,A=function(){function t(e){S(this,t),T(this,"offset",void 0),this.offset=e}return x(t,[{key:"transform",value:function(t){return[t[0]+this.offset[0],t[1]+this.offset[1]]}}]),t}(),X=function(){function t(e,n){S(this,t),T(this,"base",void 0),T(this,"angle",void 0),this.base=e,this.angle=M.toRadian(n)}return x(t,[{key:"transform",value:function(t){t[0]-=this.base[0],t[1]-=this.base[1];var e=Math.sin(this.angle),n=Math.cos(this.angle);return[t[0]*n-t[1]*e+this.base[0],t[0]*e+t[1]*n+this.base[1]]}}]),t}();function j(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function F(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}!function(t){t[t.Solid=0]="Solid",t[t.Dash=1]="Dash",t[t.Dot=2]="Dot",t[t.DashDot=3]="DashDot",t[t.DashDotDot=4]="DashDotDot"}(O||(O={})),function(t){t[t.Alternate=0]="Alternate",t[t.Winding=1]="Winding"}(L||(L={}));var I=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),F(this,"_content",""),F(this,"_size",[0,0]),F(this,"_origin",[0,0]),F(this,"totalClipCount",0),F(this,"currentClipCount",0),F(this,"transforms",[])}var e,n,r;return e=t,(n=[{key:"content",get:function(){return this._content}},{key:"size",get:function(){return[this._size[0]-this._origin[0],this._size[1]-this._origin[1]]}},{key:"origin",get:function(){return this._origin}},{key:"startDraw",value:function(t,e,n){this._size=e,this._origin=[0,0],this._content="",this.totalClipCount=0,this.currentClipCount=0,this.appendLine(C.XmlHeader),this.appendFmt(C.DocHeader,C.MetaInfo,t,this.getZoomStr(e[0]),this.getZoomStr(e[1]),n),this.appendLine()}},{key:"endDraw",value:function(){this.appendLine(C.DocFooter)}},{key:"beginGroup",value:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:C.GroupHeader;n=null!==(e=n)&&void 0!==e?e:C.GroupHeader,this.appendFmt(n,t)}},{key:"endGroup",value:function(){this.appendLine(C.GroupFooter)}},{key:"append",value:function(t){this._content=this._content+t._content,this.updateSize(t._size)}},{key:"appendLine",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this._content+="".concat(t,"\n")}},{key:"appendFmt",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];this._content=this._content+this.format.apply(this,[t].concat(n))}},{key:"format",value:function(t){for(var e=0;e<(arguments.length<=1?0:arguments.length-1);e++){var n="{".concat(e,"}");t=t.replace(n,e+1<1||arguments.length<=e+1?void 0:arguments[e+1])}return t}},{key:"applyTransform",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.transforms.forEach((function(e){return t=e.transform(t)})),e&&this.updateSize(t),t}},{key:"updateSize",value:function(t){this._size[0]=Math.max(this._size[0],t[0]),this._size[1]=Math.max(this._size[1],t[1]),this._origin[0]=Math.min(this._origin[0],t[0]),this._origin[1]=Math.min(this._origin[1],t[1])}},{key:"applyZoom",value:function(t){var e=this.applyTransform([1,0],!1),n=this.applyTransform([0,0],!1),r=n[0]-e[0],i=n[1]-e[1];return Math.sqrt(r*r+i*i)*t}},{key:"getZoomStr",value:function(t){return this.applyZoom(t).toString()}},{key:"GetArcStr",value:function(t,e,n,r,i,o){for(var a=M.getPointFromAngleForEllipse(t,e,n,r,o),s=M.getPointFromAngleForEllipse(t,e,n,r,i),u=this.applyTransform(a),l=this.applyTransform(s),c=-o,h=-i;c<h;)c+=360;var f=c-h<=180?0:1;return this.format(C.ArcPath,u[0],u[1],this.getZoomStr(n),this.getZoomStr(r),f,l[0],l[1])}},{key:"drawArc",value:function(t,e,n,r,i,o,a){if(M.normalizeAngle(o)==M.normalizeAngle(a)){var s=this.applyTransform([e,n]);this.appendFmt(C.Ellipse,s[0],s[0],this.getZoomStr(r/2),this.getZoomStr(i/2),this.penToString(t))}else{var u=this.GetArcStr(e,n,r/2,i/2,o,a);this.appendFmt(C.Path,this.penToString(t),u)}this.appendLine()}},{key:"penToString",value:function(t){var e=t.color,n="";n=t.nonScaled?this.format(C.NonScalingPen,e,t.width):this.format(C.PenWidth,e,this.getZoomStr(t.width));var r="";switch(t.style){case O.Dash:r=C.StrokeDash;break;case O.Dot:r=C.StrokeDot;break;case O.DashDot:r=C.StrokeDashDot;break;case O.DashDotDot:r=C.StrokeDashDotDot}return n+r}},{key:"drawLine",value:function(t,e,n,r,i){var o=this.applyTransform([e,n]),a=this.applyTransform([r,i]);this.appendFmt(C.Line,o[0],o[1],a[0],a[1],this.penToString(t)),this.appendLine()}},{key:"drawLines",value:function(t,e){if(!(e.length<2))for(var n=0;n<e.length-2;n++)this.drawLine(t,e[n][0],e[n][1],e[n+1][0],e[n+1][1])}},{key:"drawBounds",value:function(t,e){this.drawRectangle(t,e[0],e[1],e[2],e[3])}},{key:"drawRectangle",value:function(t,e,n,r,i){var o=this.applyTransform([e,n]),a=this.applyTransform([r,i]);this.appendFmt(C.Rect,Math.min(o[0],a[0]),Math.min(o[1],a[1]),Math.abs(o[0]-a[0]),Math.abs(o[1]-a[1]),this.penToString(t),"",""),this.appendLine()}},{key:"appendStr",value:function(t,e,n){return t?e?t+n+e:t:e}},{key:"getTextStyle",value:function(t){var e="";if(t.underline||t.strikout){var n="";t.underline&&(n=C.Underline),t.strikout&&(n=this.appendStr(n,C.Strikout,C.Delimiter)),e=this.format(C.TextDecorations,n)}return t.weight&&(e=this.appendStr(e,this.format(C.Weight,t.weight),C.Delimiter)),t.italic&&(e=this.appendStr(e,C.Italic,C.Delimiter)),e}},{key:"drawString",value:function(t,e,n,r){var i=this.applyTransform([n,r]),o=Math.trunc(this.applyZoom(e.size));o=o<=0?1:o;var a=e.getSize(t),s=[n+a[0],r+a[1]],u="";if(0!=e.rotation){i=M.GetPointFromAngle(i[0],i[1],o,e.rotation+90),u=this.format(C.Rotate,e.rotation,i[0],i[1]);var l=new X(i,e.rotation);this.applyTransform(l.transform(s))}else i[1]+=o,this.applyTransform(s);var c="";this.currentClipCount>0&&(c=this.format(C.ClipUrl,this.totalClipCount)),this.appendFmt(C.Text,c,i[0],i[1],o,e.name,e.color,this.getTextStyle(e),u,t),this.appendLine()}},{key:"pointsToString",value:function(t){for(var e="",n=0;n<t.length;n++){e.length>0&&(e+=C.Delimiter);var r=this.applyTransform([t[n][0],t[n][1]]);e+=this.format(C.Points,r[0],r[1])}return e}},{key:"drawPolygons",value:function(t,e){for(var n=0;n<e.length;n++)this.appendFmt(C.Polygon,this.pointsToString(e[n]),this.penToString(t),"")}},{key:"fillPolygons",value:function(t,e){for(var n=0;n<e.length;n++)this.appendFmt(C.Polygon,this.pointsToString(e[n]),"",this.brushToString(t))}},{key:"brushToString",value:function(t){return this.format(C.Fill,t.color,t.opacity)}},{key:"fillBounds",value:function(t,e){this.fillRectangle(t,e[0],e[1],e[2],e[3])}},{key:"fillRectangle",value:function(t,e,n,r,i){var o=this.applyTransform([e,n]),a=this.applyTransform([r,i]);this.appendFmt(C.Rect,Math.min(o[0],a[0]),Math.min(o[1],a[1]),Math.abs(o[0]-a[0]),Math.abs(o[1]-a[1]),"","",this.brushToString(t)),this.appendLine()}},{key:"resetClip",value:function(){this.currentClipCount=0}},{key:"pushTransform",value:function(t){this.transforms.push(t)}},{key:"popTransform",value:function(){this.transforms.pop()}},{key:"pushClip",value:function(t,e,n,r){this.totalClipCount++,this.currentClipCount++;var i=this.applyTransform([t,e]),o=this.applyTransform([n,r]);this.appendFmt(C.ClipGroupHeader,this.totalClipCount,Math.min(i[0],o[0]),Math.min(i[1],o[1]),Math.abs(i[0]-o[0]),Math.abs(i[1]-o[1]))}},{key:"popClip",value:function(){this.appendFmt(C.GroupFooter),this.currentClipCount--}},{key:"drawRoundedRectangle",value:function(t,e,n,r,i,o,a){var s=this.applyTransform([e,n]),u=this.applyTransform([r,i]),l="";0==o&&0==a||(l=this.format(C.RectCorners,this.getZoomStr(o),this.getZoomStr(a))),this.appendFmt(C.Rect,Math.min(s[0],u[0]),Math.min(s[1],u[1]),Math.abs(s[0]-u[0]),Math.abs(s[1]-u[1]),this.penToString(t),l,""),this.appendLine()}},{key:"fillRoundedRectangle",value:function(t,e,n,r,i,o,a){var s=this.applyTransform([e,n]),u=this.applyTransform([r,i]),l="";0==o&&0==a||(l=this.format(C.RectCorners,this.getZoomStr(o),this.getZoomStr(a)));var c=this.brushToString(t);this.appendFmt(C.Rect,Math.min(s[0],u[0]),Math.min(s[1],u[1]),Math.abs(s[0]-u[0]),Math.abs(s[1]-u[1]),"",l,c),this.appendLine()}}])&&j(e.prototype,n),r&&j(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function G(t,e,n){return(G=V()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&B(i,n.prototype),i}).apply(null,arguments)}function V(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function B(t,e){return(B=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function E(t){return function(t){if(Array.isArray(t))return R(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return R(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return R(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function R(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function H(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _(t,e,n){return e&&H(t.prototype,e),n&&H(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function N(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function U(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var z=_((function t(){N(this,t)}));U(z,"FixedMM",4),U(z,"FixedMIL",3),U(z,"DefaultFontName","Segoe UI, Helvetica, Arial, sans-serif"),U(z,"DefaultFontSize",8),U(z,"DefaultFontColor","#080A0A"),U(z,"DefaultFontWeight","normal"),U(z,"DefaultPenColor","#000000"),U(z,"DefaultPenStyle",O.Solid),U(z,"DefaultPenWidth",1),U(z,"DefaultPenNonScaled",!0),U(z,"DefaultBrushColor","#FFFFFF"),U(z,"DefaultBrushOpacity",1),U(z,"TransparentOpacity",0),U(z,"ColumnNo","#"),U(z,"ColumnThk","THK"),U(z,"ColumnName","NAME"),U(z,"ColumnType","TYPE"),U(z,"ColumnGap",20),U(z,"Scale",8),U(z,"Margin",30),U(z,"HeaderGap",1),U(z,"LayerToTextGap",32),U(z,"DefaultThickness",2),U(z,"MinViaCount",5),U(z,"ViaZoneWidth",50),U(z,"ViaPadDX",18),U(z,"ViaOuterDX",10),U(z,"ViaInnerDX",5),U(z,"ViaOuterMDX",7),U(z,"ViaInnerMDX",3),U(z,"CopperObjectLongDX",9),U(z,"CopperObjectShortDX",6),U(z,"Scene","scene"),U(z,"MainGroup","DocumentMainGroup"),U(z,"BackgroundGroup","BackgroundGroup");var Y=function(){function t(){var e,n,r,i;N(this,t),U(this,"name",void 0),U(this,"size",void 0),U(this,"color",void 0),U(this,"rotation",void 0),U(this,"weight",void 0),U(this,"italic",void 0),U(this,"strikout",void 0),U(this,"underline",void 0),this.name=null!==(e=arguments.length<=0?void 0:arguments[0])&&void 0!==e?e:z.DefaultFontName,this.size=null!==(n=arguments.length<=1?void 0:arguments[1])&&void 0!==n?n:z.DefaultFontSize,this.color=null!==(r=arguments.length<=2?void 0:arguments[2])&&void 0!==r?r:z.DefaultFontColor,this.weight=null!==(i=arguments.length<=3?void 0:arguments[3])&&void 0!==i?i:z.DefaultFontWeight,this.rotation=0,this.italic=!1,this.strikout=!1,this.underline=!1}return _(t,[{key:"getSize",value:function(t){return[this.size/2.3*t.length,this.size+4]}}]),t}(),Z=_((function t(){var e,n,r,i;N(this,t),U(this,"color",void 0),U(this,"width",void 0),U(this,"style",void 0),U(this,"nonScaled",void 0),this.color=null!==(e=arguments.length<=0?void 0:arguments[0])&&void 0!==e?e:z.DefaultPenColor,this.width=null!==(n=arguments.length<=1?void 0:arguments[1])&&void 0!==n?n:z.DefaultPenWidth,this.style=null!==(r=arguments.length<=2?void 0:arguments[2])&&void 0!==r?r:z.DefaultPenStyle,this.nonScaled=null!==(i=arguments.length<=3?void 0:arguments[3])&&void 0!==i?i:z.DefaultPenNonScaled})),W=_((function t(){var e,n;N(this,t),U(this,"color",void 0),U(this,"opacity",void 0),this.color=null!==(e=arguments.length<=0?void 0:arguments[0])&&void 0!==e?e:z.DefaultBrushColor,this.opacity=(null!==(n=arguments.length<=1?void 0:arguments[1])&&void 0!==n?n:arguments.length<=0?void 0:arguments[0])?z.DefaultBrushOpacity:z.TransparentOpacity})),q=function(){function t(e){var n;N(this,t),U(this,"defaultFields",[z.ColumnNo,z.ColumnName,z.ColumnType,z.ColumnThk]),U(this,"defaultBrushes",new Map([["Background",["#E9E9E9"]],["Overlay",["#9AAF89"]],["Solder Mask",["#29763C"]],["Dielectric",["#5E5747"]],["Core",["#5E5747"]],["Prepreg",["#AA9E81"]],["Non-Conductive",["#AA9E81"]],["Plane",["#DBAB61"]],["Signal",["#000000",0]],["ViaBarrel",["#CDB475"]],["ViaHole",["#E8C8A4"]],["ViaSkip",["#DEB984"]],["Grid",["#DADADA"]],["CopperObject",["#CDA86C"]],["Debug",["#FF0000"]]])),U(this,"defaultFonts",new Map([["TableHeader",[z.DefaultFontName,z.DefaultFontSize,"#727272"]],["TableData",[z.DefaultFontName,z.DefaultFontSize,"#080A0A"]]])),U(this,"defaultPens",new Map([["Overlay",["#707A69"]],["Solder Mask",["#1C582B"]],["Dielectric",["#4B4537"]],["Core",["#4B4537"]],["Prepreg",["#575252"]],["Non-Conductive",["#575252"]],["Plane",["#655337"]],["Via",["#5C5134"]],["Debug",["#FF0000"]],["Callout",["#9E9E9E"]],["CopperObject",["#7E6E53"]]])),U(this,"fields",void 0),U(this,"brushes",void 0),U(this,"fonts",void 0),U(this,"pens",void 0),this.fields=null!==(n=null==e?void 0:e.fields)&&void 0!==n?n:this.defaultFields,this.brushes=this.merge(null==e?void 0:e.brushes,this.defaultBrushes),this.fonts=this.merge(null==e?void 0:e.fonts,this.defaultFonts),this.pens=this.merge(null==e?void 0:e.pens,this.defaultPens)}return _(t,[{key:"getBrush",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.brushes.get(t);return n?G(W,E(n)):e?null:new W}},{key:"getFont",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.fonts.get(t);return n?G(Y,E(n)):e?null:new Y}},{key:"getPen",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.pens.get(t);return n?G(Z,E(n)):e?null:new Z}},{key:"merge",value:function(t,e){return t?new Map([].concat(E(e),E(t))):e}}]),t}();function $(t){return function(t){if(Array.isArray(t))return K(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return K(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return K(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function K(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function J(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Q(t,e,n){return e&&J(t.prototype,e),n&&J(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function tt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function et(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var nt=Q((function t(e,n,r){tt(this,t),et(this,"text",void 0),et(this,"size",void 0),et(this,"position",void 0),et(this,"unit",void 0),this.text=e,this.size=n.getSize(e),this.unit=r,this.position=[0,0]})),rt=Q((function t(e,n){tt(this,t),et(this,"height",void 0),et(this,"position",void 0),et(this,"cells",void 0),this.cells=e,this.height=Math.max.apply(Math,$(e.map((function(t){return t.size[1]}))))+n,this.position=0})),it=Q((function t(e){tt(this,t),et(this,"width",void 0),et(this,"position",void 0),et(this,"cells",void 0),this.cells=e,this.width=Math.max.apply(Math,$(e.map((function(t){return t.size[0]})))),this.position=0})),ot=function(){function t(e){tt(this,t),et(this,"_width",void 0),et(this,"_rows",void 0),et(this,"_cols",void 0),et(this,"cells",void 0),et(this,"units",void 0),this.clear(),this.units=e}return Q(t,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._rows.length}},{key:"rows",get:function(){return this._rows}},{key:"columns",get:function(){return this._cols}},{key:"clear",value:function(){this._width=0,this._cols=[],this._rows=[],this.cells=[],this.units=[]}},{key:"add",value:function(t,e){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=t.map((function(t,r){return new nt(t,e,n.units&&n.units[r])}));this._width=Math.max(this._width,t.length),this.cells.push(i);var o=new rt(i,r);return this._rows.push(o),o}},{key:"align",value:function(t){var e=this;this._cols=[];for(var n=0;n<this.width;n++){var r=this.cells.map((function(t){return t[n]}));this._cols.push(new it(r))}t.forEach((function(t){return t.align(e)}))}}]),t}(),at=n(367);function st(t){return function(t){if(Array.isArray(t))return ut(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return ut(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ut(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ut(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function lt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ct(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ht(t,e){var n=t.properties.find((function(t){return"Thickness"===t.name}));if(n){var r,i,o=e?null===(r=n.valueInMms)||void 0===r?void 0:r.replace("mm",""):null===(i=n.valueInMils)||void 0===i?void 0:i.replace("mil","");return o?Number.parseFloat(o):0}return 0}function ft(t){return"Signal"===t.typeName||"Plane"===t.typeName||"Conductive"===t.typeName}var dt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ct(this,"fields",void 0),ct(this,"counter",void 0),this.fields=e;var n=e.indexOf(z.ColumnThk);this.counter={mmTotal:0,milTotal:0,layerNo:1,columnNo:0,colTotal:n>0?e[n-1]:null}}var e,n,r;return e=t,(n=[{key:"getColumnHeaders",value:function(){return this.getValues(null,this.getColumnHeader)}},{key:"getColumnValues",value:function(t){return this.getValues(t,this.getColumnValue)}},{key:"getColumnUnits",value:function(){return this.getValues(null,this.getColumnUnit)}},{key:"getColumnFooters",value:function(){return this.getValues(null,this.getColumnFooter)}},{key:"getColumnIndexes",value:function(){return this.getValues(null,this.getColumnIndex)}},{key:"getValues",value:function(t,e){var n=this,r=[];return this.fields.forEach((function(i){return r.push.apply(r,st(e(i,t,n.counter)))})),r}},{key:"getColumnHeader",value:function(t,e,n){switch(t){case z.ColumnNo:return[""];case z.ColumnThk:return["Thk (mm)","Thk (mil)"];case z.ColumnName:return["Layer"];case z.ColumnType:return["Type"];default:return[""]}}},{key:"getColumnValue",value:function(t,e,n){switch(t){case z.ColumnNo:return[ft(e)?(n.layerNo++).toString():"-"];case z.ColumnThk:var r=ht(e,!0),i=ht(e,!1),o=0===r?"":r.toFixed(z.FixedMM),a=0===i?"":i.toFixed(z.FixedMIL);return n.mmTotal+=r,n.milTotal+=i,[o,a];case z.ColumnName:return[e.name];case z.ColumnType:return[e.typeName];default:return[""]}}},{key:"getColumnUnit",value:function(t,e,n){switch(t){case z.ColumnThk:return[at.b,at.a];default:return[null]}}},{key:"getColumnFooter",value:function(t,e,n){switch(t){case z.ColumnThk:return[n.mmTotal.toFixed(z.FixedMM),n.milTotal.toFixed(z.FixedMIL)];default:return t===n.colTotal?["Total"]:[""]}}},{key:"getColumnIndex",value:function(t,e,n){var r=n.columnNo;switch(n.columnNo++,t){case z.ColumnThk:return[r,r];default:return[r]}}}])&&lt(e.prototype,n),r&&lt(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function pt(t){return function(t){if(Array.isArray(t))return vt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return vt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vt(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function yt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function gt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function bt(t,e,n){return e&&gt(t.prototype,e),n&&gt(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function mt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var wt=function(){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;yt(this,t),mt(this,"gap",void 0),mt(this,"offset",void 0),mt(this,"indexMap",void 0),this.gap=n,this.offset=e,this.indexMap=r}return bt(t,[{key:"align",value:function(t){this.indexMap&&this.indexMap.length===t.columns.length&&this.indexMap.reduce((function(e,n,r){return e[n]=[].concat(pt(e[n]||[]),[t.columns[r]]),e}),[]).filter((function(t){return t.length>1})).forEach((function(t){var e=Math.max.apply(Math,pt(t.map((function(t){return t.width}))));t.forEach((function(t){return t.width=e}))}));for(var e=Math.trunc(this.gap/2),n=this.offset,r=0,i=0,o=0;o<t.width;o++){var a,s=null!==(a=this.indexMap&&this.indexMap[o])&&void 0!==a?a:o,u=t.columns[o];r!==s&&(n=n+i+this.gap),u.position=n,u.width=u.width+this.gap,u.cells.forEach((function(t){return t.position[0]=n+e})),r=s,i=u.width}}}]),t}(),kt=function(){function t(e,n){yt(this,t),mt(this,"gap",void 0),mt(this,"rowBases",void 0),mt(this,"rowCenters",void 0),this.gap=e,this.rowBases=n,this.rowCenters=n.map((function(t){return t[2]}))}return bt(t,[{key:"align",value:function(t){var e=t.rows;if(e.length===this.rowBases.length){var n,r;if(e.length%2==0)n=(r=t.rows.length/2)-1;else{var i=Math.trunc(t.rows.length/2);n=i-1,r=i+1}this.alignTextsUp(t,n),this.alignTextsDown(t,r),this.setTextPositions(t),this.expandRowHeights(t)}}},{key:"alignTextsUp",value:function(t,e){for(var n=e;n>=0;n--){var r=this.rowCenters[n+1],i=this.rowCenters[n];if(-1!=i){var o=t.rows[n].height-(r-i);o>0&&(this.rowCenters[n]-=o)}else this.rowCenters[n]=r-this.gap-t.rows[n].height}}},{key:"alignTextsDown",value:function(t,e){for(var n=e;n<t.rows.length;n++){var r=this.rowCenters[n-1],i=this.rowCenters[n];if(-1!=i){var o=t.rows[n].height-(i-r);o>0&&(this.rowCenters[n]+=o)}else this.rowCenters[n]=r+this.gap+t.rows[n].height}}},{key:"setTextPositions",value:function(t){for(var e=this,n=function(){var n=t.rows[r];n.position=e.rowCenters[r]-n.height/2,n.cells.forEach((function(t){return t.position[1]=n.position}))},r=0;r<t.rows.length;r++)n()}},{key:"expandRowHeights",value:function(t){for(var e=0;e<t.rows.length;e++)if(-1!==this.rowBases[e][2]){var n=t.rows[e-1],r=t.rows[e],i=t.rows[e+1],o=r.position-Math.max(this.rowBases[e][0],n.position+n.height);o>0&&(r.position-=o,r.height+=o);var a=Math.min(this.rowBases[e][1],i.position)-(r.position+r.height);a>0&&(r.height+=a)}}}]),t}(),Ct=n(429);function Pt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Mt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var St=function(){function t(e,n,r,i,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Mt(this,"id",void 0),Mt(this,"skip",void 0),Mt(this,"micro",void 0),Mt(this,"baseX",void 0),Mt(this,"baseY",void 0),this.id=e.id,this.skip=e.type==Ct.b.SkipMicroVia,this.micro=e.type==Ct.b.SkipMicroVia||e.type==Ct.b.StackedMicroVia,this.baseX=i,this.baseY=o>0?[n[1],n[3],r[1],r[3]]:[n[3],n[1],r[3],r[1]]}var e,n,r;return e=t,(n=[{key:"innerMX1",get:function(){return this.baseX-z.ViaInnerMDX}},{key:"innerMX2",get:function(){return this.baseX+z.ViaInnerMDX}},{key:"outerMX1",get:function(){return this.baseX-z.ViaOuterMDX}},{key:"outerMX2",get:function(){return this.baseX+z.ViaOuterMDX}},{key:"innerX1",get:function(){return this.baseX-z.ViaInnerDX}},{key:"innerX2",get:function(){return this.baseX+z.ViaInnerDX}},{key:"outerX1",get:function(){return this.baseX-z.ViaOuterDX}},{key:"outerX2",get:function(){return this.baseX+z.ViaOuterDX}},{key:"padX1",get:function(){return this.baseX-z.ViaPadDX}},{key:"padX2",get:function(){return this.baseX+z.ViaPadDX}},{key:"hole",get:function(){return this.micro?this.getMicroHole():this.getThruHole()}},{key:"contour",get:function(){return this.micro?this.getMicroContour():this.getThruContour()}},{key:"getThruHole",value:function(){return[[this.innerX1,this.baseY[0]],[this.innerX2,this.baseY[0]],[this.innerX2,this.baseY[3]],[this.innerX1,this.baseY[3]],[this.innerX1,this.baseY[0]]]}},{key:"getMicroHole",value:function(){return[[this.innerX1,this.baseY[0]],[this.innerX2,this.baseY[0]],[this.innerX2,this.baseY[1]],[this.innerMX2,this.baseY[2]],[this.innerMX1,this.baseY[2]],[this.innerX1,this.baseY[1]],[this.innerX1,this.baseY[0]]]}},{key:"getThruContour",value:function(){return[[this.padX1,this.baseY[0]],[this.padX2,this.baseY[0]],[this.padX2,this.baseY[1]],[this.outerX2,this.baseY[1]],[this.outerX2,this.baseY[2]],[this.padX2,this.baseY[2]],[this.padX2,this.baseY[3]],[this.padX1,this.baseY[3]],[this.padX1,this.baseY[2]],[this.outerX1,this.baseY[2]],[this.outerX1,this.baseY[1]],[this.padX1,this.baseY[1]],[this.padX1,this.baseY[0]]]}},{key:"getMicroContour",value:function(){return[[this.padX1,this.baseY[0]],[this.padX2,this.baseY[0]],[this.padX2,this.baseY[1]],[this.outerX2,this.baseY[1]],[this.outerMX2,this.baseY[2]],[this.padX2,this.baseY[2]],[this.padX2,this.baseY[3]],[this.padX1,this.baseY[3]],[this.padX1,this.baseY[2]],[this.outerMX1,this.baseY[2]],[this.outerX1,this.baseY[1]],[this.padX1,this.baseY[1]],[this.padX1,this.baseY[0]]]}}])&&Pt(e.prototype,n),r&&Pt(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Dt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function xt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Tt,Ot=function(){function t(e,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),xt(this,"y1",void 0),xt(this,"y2",void 0),xt(this,"baseX",void 0),xt(this,"orientation",void 0),this.baseX=n,this.orientation=r,this.y1=r?e[3]:e[1],this.y2=r?e[1]:e[3]}var e,n,r;return e=t,(n=[{key:"longX1",get:function(){return this.baseX-z.CopperObjectLongDX}},{key:"longX2",get:function(){return this.baseX+z.CopperObjectLongDX}},{key:"shortX1",get:function(){return this.baseX-z.CopperObjectShortDX}},{key:"shortX2",get:function(){return this.baseX+z.CopperObjectShortDX}},{key:"contour",get:function(){return this.getContour()}},{key:"getContour",value:function(){return[[this.shortX1,this.y1],[this.shortX2,this.y1],[this.longX2,this.y2],[this.longX1,this.y2],[this.shortX1,this.y1]]}}])&&Dt(e.prototype,n),r&&Dt(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Lt(t){return function(t){if(Array.isArray(t))return At(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return At(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return At(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function At(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Xt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function jt(t,e,n){return e&&Xt(t.prototype,e),n&&Xt(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ft(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function It(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}!function(t){t[t.Layers=1]="Layers",t[t.Table=2]="Table",t[t.Vias=4]="Vias",t[t.Preview=5]="Preview",t[t.All=7]="All"}(Tt||(Tt={}));var Gt=jt((function t(){Ft(this,t),It(this,"stack",void 0),It(this,"dataFont",void 0),It(this,"headerFont",void 0),It(this,"table",void 0),It(this,"rows",void 0),It(this,"columns",void 0),It(this,"electricCount",void 0),It(this,"drawLayers",void 0),It(this,"drawTable",void 0),It(this,"drawVias",void 0),It(this,"drawCallout",void 0)})),Vt=function(){function t(){Ft(this,t),It(this,"layer",void 0),It(this,"electricNo",void 0),It(this,"thickness",void 0),It(this,"layerBox",void 0),It(this,"text",void 0)}return jt(t,[{key:"getLayerCY",value:function(){return this.layerBox[1]+(this.layerBox[3]-this.layerBox[1])/2}},{key:"getRowBase",value:function(){return[this.layerBox[1],this.layerBox[3],this.getLayerCY()]}}]),t}(),Bt=function(){function t(){Ft(this,t),It(this,"options",void 0)}return jt(t,[{key:"draw",value:function(t,e){this.options=new q(e);var n=new I;n.pushTransform(new A([z.Margin,z.Margin]));var r=this.calculateStack(t.stackup.stacks[0],Tt.All);return this.drawStack(n,r),this.drawDocument(t.id,n,z.Margin)}},{key:"drawPreview",value:function(t,e){this.options=new q(e);var n=new I,r=this.calculateStack(t.stackup.stacks[0],Tt.Preview);return this.drawStack(n,r),this.drawDocument(t.id,n,0)}},{key:"drawDocument",value:function(t,e,n){var r=new I,i=[e.size[0]+n,e.size[1]+n],o=function(t){for(var e=0;e<(arguments.length<=1?0:arguments.length-1);e++){var n="{".concat(e,"}");t=t.replace(n,e+1<1||arguments.length<=e+1?void 0:arguments[e+1])}return t}(C.SvgStyles,"rect","rect","none");return r.startDraw(o,i,t),r.beginGroup(z.Scene),r.beginGroup(z.MainGroup),r.beginGroup(z.BackgroundGroup),r.fillRectangle(this.options.getBrush("Background"),0,0,i[0],i[1]),r.append(e),r.endGroup(),r.endGroup(),r.endGroup(),r.endDraw(),r.content}},{key:"calculateStack",value:function(t,e){var n=new Gt;n.stack=t,n.electricCount=0,n.dataFont=this.options.getFont("TableData"),n.headerFont=this.options.getFont("TableHeader"),n.drawVias=0!=(e&Tt.Vias),n.drawTable=0!=(e&Tt.Table),n.drawLayers=0!=(e&Tt.Layers),n.drawCallout=(n.drawLayers||n.drawVias)&&n.drawTable,n.columns=Math.max(t.viaSpans.length,z.MinViaCount),n.rows=t.layers.filter((function(t){return t.isSupported})).map((function(t){var e=ft(t);n.electricCount+=e?1:0;var r=new Vt;return r.layer=t,r.electricNo=e?n.electricCount:0,r.thickness=n.drawLayers?ht(t,!1):z.DefaultThickness,r}));var r=n.drawLayers||n.drawVias?n.columns*z.ViaZoneWidth:0;return this.fillGraphics(r,n),n.drawTable&&this.fillTable(n,n.drawCallout?r+z.LayerToTextGap:0),n}},{key:"fillGraphics",value:function(t,e){var n=0,r=Math.min.apply(Math,Lt(e.rows.map((function(t){return t.thickness})).filter((function(t){return t>0}))));e.rows.forEach((function(e){var i=n+Math.max(e.thickness,r)*z.Scale;e.layerBox=[0,n,t,i],n=i}))}},{key:"fillTable",value:function(t,e){var n=new dt(this.options.fields);t.table=new ot(n.getColumnUnits()),t.table.add(n.getColumnHeaders(),t.headerFont,z.HeaderGap),t.rows.forEach((function(e){e.text=t.table.add(n.getColumnValues(e.layer),t.dataFont)})),t.table.add(n.getColumnFooters(),t.headerFont,z.HeaderGap);var r=[0,0,-1],i=[r].concat(Lt(t.rows.map((function(t){return t.getRowBase()}))),[r]);t.table.align([new wt(e,z.ColumnGap,n.getColumnIndexes()),new kt(z.HeaderGap,i)])}},{key:"drawStack",value:function(t,e){if(e.drawTable){var n=e.table.rows[0];n.position<0&&t.pushTransform(new A([0,Math.abs(n.position)])),this.drawCells(t,n.cells,e.headerFont)}if((e.drawLayers||e.drawTable)&&this.drawLayers(t,e),e.drawVias&&this.drawVias(t,e.stack.viaSpans,e),e.drawTable){var r=e.table.rows[0],i=e.table.rows[e.table.height-1];e.drawTable&&this.drawCells(t,i.cells,e.headerFont),r.position<0&&t.popTransform()}}},{key:"drawLayers",value:function(t,e){var n=this,r=1,i=this.options.getBrush("Grid"),o=this.options.getBrush("Background"),a=this.options.getPen("Callout");e.rows.forEach((function(s){e.drawLayers&&n.drawGroup(t,"".concat(s.layer.id,":I"),null,(function(){var e=n.options.getBrush(s.layer.typeName);e&&t.fillBounds(e,s.layerBox);var r=n.options.getPen(s.layer.typeName,!0);r&&t.drawBounds(r,s.layerBox)})),e.drawTable&&(n.drawGroup(t,"".concat(s.layer.id,":T"),null,(function(){var n=e.table.columns[0].position,a=s.text.position,u=e.table.columns[e.table.width-1].position+e.table.columns[e.table.width-1].width,l=s.text.position+s.text.height;t.fillRectangle(r%2==0?o:i,n,a,u,l)})),n.drawCells(t,s.text.cells,e.dataFont),e.drawCallout&&n.drawGroup(t,"".concat(s.layer.id,":C"),null,(function(){var n=s.layerBox[2],r=s.getLayerCY(),i=e.table.columns[0].position,o=s.text.position+s.text.height/2;t.drawLine(a,n,r,i,o)}))),r++}))}},{key:"drawGroup",value:function(t,e,n,r){e&&t.beginGroup(e,n),r(),e&&t.endGroup()}},{key:"drawCells",value:function(t,e,n){var r=this;e.forEach((function(e){r.drawGroup(t,e.unit,C.UnitGroupHeader,(function(){t.drawString(e.text,n,e.position[0],e.position[1]+1)}))}))}},{key:"drawVias",value:function(t,e,n){var r=this,i=-z.ViaZoneWidth/2;e.forEach((function(e){var o=r.getStartStopLayer(e,n);if(-1!==o.start&&-1!==o.stop){var a=[];if(a.push(r.drawVia(t,e,n,o.start,o.stop,i+=z.ViaZoneWidth,o.direction)),e.isSymmetric){var s=n.electricCount-n.rows[o.start].electricNo+1,u=n.electricCount-n.rows[o.stop].electricNo+1;s=n.rows.findIndex((function(t){return t.electricNo===s})),u=n.rows.findIndex((function(t){return t.electricNo===u})),-1!==s&&-1!==u&&a.push(r.drawVia(t,e,n,s,u,i,-o.direction))}var l=r.options.getPen("Via");r.drawGroup(t,"".concat(a[0].id),null,(function(){a.forEach((function(e){return t.drawPolygons(l,[e.contour])}))}))}})),this.range(n.columns-e.length).forEach((function(e){return r.drawCopperObjects(t,n,-1,-1,i+=z.ViaZoneWidth)}))}},{key:"getStartStopLayer",value:function(t,e){var n=e.rows.findIndex((function(e){return e.layer.id===t.startLayerId})),r=e.rows.findIndex((function(e){return e.layer.id===t.stopLayerId}));return{start:n,stop:r,direction:n<r?1:-1}}},{key:"drawVia",value:function(t,e,n,r,i,o,a){var s=this.options.getPen("Via"),u=this.options.getBrush("ViaBarrel"),l=this.options.getBrush("ViaHole"),c=new St(e,n.rows[r].layerBox,n.rows[i].layerBox,o,a);return c.skip&&this.drawSkipPlanes(t,n,c,r,i),t.fillPolygons(u,[c.contour]),t.fillPolygons(l,[c.hole]),t.drawPolygons(s,[c.hole]),c.micro&&t.drawLine(s,c.innerX1,c.baseY[1],c.innerX2,c.baseY[1]),this.drawCopperObjects(t,n,r,i,o),c}},{key:"drawSkipPlanes",value:function(t,e,n,r,i){var o=Math.min(r,i)+1,a=Math.max(r,i)-1;if(!(o>=a))for(var s=this.options.getPen("Via"),u=this.options.getBrush("ViaSkip"),l=o;l<=a;l++){var c=e.rows[l];if("Plane"===c.layer.typeName){var h=c.layerBox[1],f=c.layerBox[3],d=[n.padX1,h+s.width/2,n.padX2,f-s.width/2];t.fillBounds(u,d),t.drawLine(s,n.padX1,h,n.padX1,f),t.drawLine(s,n.padX2,h,n.padX2,f)}}}},{key:"drawCopperObjects",value:function(t,e,n,r,i){for(var o=Math.min(n,r),a=Math.max(n,r),s=this.options.getPen("CopperObject"),u=this.options.getBrush("CopperObject"),l=0;l<e.rows.length;l++)if(!(l>=o&&l<=a)){var c=e.rows[l];if("Signal"==c.layer.typeName){var h=c.layer.properties.find((function(t){return"CopperOrientation"===t.name}));if(h){var f=new Ot(c.layerBox,i,Number.parseInt(h.text));t.fillPolygons(u,[f.contour]),t.drawPolygons(s,[f.contour])}}}}},{key:"range",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Lt(Array(t).keys()).map((function(t){return t+e}))}}]),t}();function Et(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function Rt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ht(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var _t=function(){function t(e,n,r,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Ht(this,"logger",void 0),Ht(this,"dataHelper",void 0),Ht(this,"hintHelper",void 0),Ht(this,"contourHelper",void 0),this.logger=e,this.dataHelper=n,this.hintHelper=i,this.contourHelper=r}var e,n,i,o,s;return e=t,(n=[{key:"getOtoDistance",value:function(t,e){var n=this,r={state:"Failed",pcbId1:t,pcbId2:e,object1:this.dataHelper.getPcbPrimitiveDescriptionById(t),object2:this.dataHelper.getPcbPrimitiveDescriptionById(e)};try{var i=this.dataHelper.getNodeItemById(t),o=this.dataHelper.getNodeItemById(e);if(!i||!o)return r;var a=this.contourHelper.getContour(this.dataHelper.getPrimitiveGeometry(i)),s=this.contourHelper.getContour(this.dataHelper.getPrimitiveGeometry(o));if(0===a.length||0===s.length)return r;setTimeout((function(){return n.getOtoDistanceResult(t,e,a,s)}),0),r.state="Started"}catch(t){this.logger.LogError(null==t?void 0:t.stack),r.state="Failed"}return r}},{key:"getOtoDistanceResult",value:(o=regeneratorRuntime.mark((function t(e,n,i,o){var s,u,l,c,h,f,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u={pcbId1:e,pcbId2:n,distance:0,point1:null,point2:null,state:"Failed",flattened:!1,time:0},l=Date.now(),c=null,t.prev=3,t.next=6,this.contourHelper.getClosestDistance(i,o);case 6:c=t.sent,t.next=13;break;case 9:t.prev=9,t.t0=t.catch(3),this.logger.LogError(null===t.t0||void 0===t.t0?void 0:t.t0.stack),c=null;case 13:u.time=Date.now()-l,c&&(u.state="Completed",u.point1=c.point1,u.point2=c.point2,u.distance=c.distance,u.flattened=(null===(h=c.contour1)||void 0===h?void 0:h.layerIndex)!=(null===(f=c.contour2)||void 0===f?void 0:f.layerIndex)),r.Core.bus.emit("SupportLibrary:getOtoDistanceResult",u),c&&null!==(s=this.hintHelper)&&void 0!==s&&s.mode&&((d=Array.from(i).concat(o))[0].addLine([c.point1,c.point2],a.Both),this.hintHelper.showContour(d));case 17:case"end":return t.stop()}}),t,this,[[3,9]])})),s=function(){var t=this,e=arguments;return new Promise((function(n,r){var i=o.apply(t,e);function a(t){Et(i,n,r,a,s,"next",t)}function s(t){Et(i,n,r,a,s,"throw",t)}a(void 0)}))},function(t,e,n,r){return s.apply(this,arguments)})},{key:"lsmToSvg",value:function(t,e,n){var r={svg:C.stubPreview,state:"Failed"};if(t)try{var i=new Bt;r.svg="Preview"===n?i.drawPreview(t,e):i.draw(t,e),r.state="Completed"}catch(t){this.logger.LogError(null==t?void 0:t.stack)}return r}}])&&Rt(e.prototype,n),i&&Rt(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}(),Nt=n(439),Ut=n(23);function zt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Yt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Zt;!function(t){t[t.None=0]="None",t[t.Signal=1]="Signal",t[t.Other=2]="Other"}(Zt||(Zt={}));var Wt,qt,$t=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Yt(this,"layerManager",void 0),Yt(this,"layerMap",new Map),Yt(this,"holeLayers",[])}var e,n,r;return e=t,(n=[{key:"setup",value:function(t){var e=this;this.layerManager=t;var n=this.layerManager.getLayers();this.holeLayers=n.filter((function(t){return e.isHolesLayer(t)})).map((function(t){return t.id})),this.setLayers(n.filter((function(t){return!e.isHolesLayer(t)})))}},{key:"setLayers",value:function(t){var e=this;this.layerMap=new Map,t.forEach((function(t){var n={};Object.assign(n,t),e.layerMap.set(n.id,n)}))}},{key:"setLayerOnly",value:function(t){var e,n,r=this;this.layerMap.forEach((function(t){return t.isVisible=!1}));var i=null===(e=this.layerManager)||void 0===e||null===(n=e.getLayers())||void 0===n?void 0:n.filter((function(e){return e.name==t||"Multi-Layer"===e.searchName}));null==i||i.forEach((function(t){var e=r.layerMap.get(t.id);e&&(e.isVisible=!0)}))}},{key:"resetLayers",value:function(){this.layerManager&&(this.layerManager.resetLayers(),this.setLayers(this.layerManager.getLayers()))}},{key:"getLayerKind",value:function(t){var e=this.layerMap.get(t),n=Ut.a.Signal|Ut.a.Plane;return e?e.ignored||!e.isVisible?Zt.None:(e.kind&n)>0?Zt.Signal:Zt.Other:this.holeLayers.find((function(e){return e===t}))?Zt.Other:Zt.None}},{key:"isHolesLayer",value:function(t){return!!t&&(t.searchName.startsWith("Pad Holes")||t.searchName.startsWith("Via Holes"))}}])&&zt(e.prototype,n),r&&zt(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Kt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Jt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}!function(t){t[t.Metric=0]="Metric",t[t.Imperial=1]="Imperial"}(Wt||(Wt={})),function(t){t[t.Mil=0]="Mil",t[t.Meta=1]="Meta",t[t.Graphite=2]="Graphite"}(qt||(qt={}));var Qt,te=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Jt(this,"scene2D",void 0),Jt(this,"pcbUnits",void 0),Jt(this,"metadata",void 0),Jt(this,"metadataRepository",void 0),Jt(this,"layerHelper",void 0),this.layerHelper=e}var e,n,o;return e=t,(n=[{key:"setScene2D",value:function(t){this.scene2D=t}},{key:"setup",value:function(){var t,e,n,r,o;this.metadataRepository=Nt.a.instance,this.metadata=null===(t=i.a.response)||void 0===t?void 0:t.metadata,this.pcbUnits="number"==typeof(null===(e=this.metadata)||void 0===e||null===(n=e.pcbDocument)||void 0===n?void 0:n.units)?null===(r=this.metadata)||void 0===r||null===(o=r.pcbDocument)||void 0===o?void 0:o.units:Wt.Imperial}},{key:"getNodeItemById",value:function(t){return this.scene2D.getNodeItemById(t)}},{key:"getMetadataLayer",value:function(t){return this.metadata&&this.metadata.layers?this.metadata.layers.find((function(e){return e.id==t})):null}},{key:"getPcbPrimitiveDescriptionById",value:function(t){var e=this.metadataRepository.getPrimitiveById(t);return e?this.getPcbPrimitiveDescription(e):"Unknown"}},{key:"pcbFormat",value:function(t,e){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:qt.Mil,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e=void 0===e?this.pcbUnits:e;var o=1;switch(r){case qt.Graphite:o=.01;break;case qt.Meta:o=1e4}var a="";return t.forEach((function(t){var r="".concat(n.round(t/o),"mil"),s="".concat(n.round(t/o*.0254),"mm"),u="",l="";e==Wt.Metric?(u=s,l=r):(u=r,l=s),a&&(a+=","),a=a+u+(i?" (".concat(l,")"):"")})),a}},{key:"round",value:function(t){return Math.round(1e3*t)/1e3}},{key:"getPcbPrimitiveDescription",value:function(t){var e=255&t.kind,n=this.getPcbPrimiviveNameByKind(e),r=this.getLayerName(t.layerId);return"".concat(n," on ").concat(r)}},{key:"getPcbPrimiviveNameByKind",value:function(t){return Object(r.getObjectIdName)(t)}},{key:"getLayerName",value:function(t){var e=this.getMetadataLayer(t);return e?e.name:"#".concat(t)}},{key:"getPrimitiveGeometry",value:function(t){for(var e=this,n=[],r=[],i=t.GetLayersCount(),o=(Ut.a.Signal,Ut.a.Plane,0);o<i;o++){var a=t.GetLayerGeometry(o);if(a&&(0!=a.GetPolysCount()||0!=a.GetArcsCount()||0!=a.GetUnisCount())){var s=this.layerHelper.getLayerKind(a.GetLayerIndex());s==Zt.Signal?r.push(a):s==Zt.Other&&n.push(a)}}return(r.length>0?r:n).reduce((function(t,n){return t.find((function(t){return e.equalGeometries(t,n)}))||t.push(n),t}),[])}},{key:"equalGeometries",value:function(t,e){var n=t.GetArcsCount(),r=t.GetUnisCount(),i=t.GetPolysCount();if(n!==e.GetArcsCount())return!1;if(r!==e.GetUnisCount())return!1;if(i!==e.GetPolysCount())return!1;for(var o=0;o<n;o++){var a=t.GetArc(o),s=e.GetArc(o);if(a.width!==s.width)return!1;if(a.radius!==s.radius)return!1;if(a.angles[0]!==s.center[0])return!1;if(a.angles[1]!==s.center[1])return!1;if(a.center[0]!==s.center[0])return!1;if(a.center[1]!==s.center[1])return!1}for(o=0;o<r;o++){var u=t.GetUni(o),l=e.GetUni(o);if(u.radius!==l.radius)return!1;if(u.size[0]!==l.size[0])return!1;if(u.size[1]!==l.size[1])return!1;if(u.position[0]!==l.position[0])return!1;if(u.position[1]!==l.position[1])return!1;if(u.direction[0]!==l.direction[0])return!1;if(u.direction[1]!==l.direction[1])return!1}for(o=0;o<i;o++){var c=t.GetPoly(o),h=e.GetPoly(o);if(c.polygon!==h.polygon)return!1;if(c.angle[0]!==h.angle[0])return!1;if(c.angle[1]!==h.angle[1])return!1;if(c.scale[0]!==h.scale[0])return!1;if(c.scale[1]!==h.scale[1])return!1;if(c.position[0]!==h.position[0])return!1;if(c.position[1]!==h.position[1])return!1}return!0}}])&&Kt(e.prototype,n),o&&Kt(e,o),Object.defineProperty(e,"prototype",{writable:!1}),t}();function ee(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ne(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}!function(t){t[t.None=0]="None",t[t.Reduced=1]="Reduced",t[t.Full=2]="Full"}(Qt||(Qt={}));var re=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ne(this,"logger",void 0),ne(this,"scene2D",void 0),ne(this,"hintNode",null),ne(this,"hintMaterial",null),ne(this,"mode",Qt.None),this.logger=i.a.createLogger("Support library")}var e,n,o;return e=t,(n=[{key:"setScene2D",value:function(t){this.scene2D=t}},{key:"clear",value:function(){this.hintNode&&(this.scene2D.removeItem(this.hintNode),this.hintNode=null)}},{key:"showContour",value:function(t){if(this.clear(),this.mode&&null!=t&&t.length&&this.scene2D){var e;switch(null===this.hintMaterial&&(this.hintMaterial=this.scene2D.addMaterial(new r.Material([0,175,14,255],void 0,void 0,!0,!1))),this.mode){case Qt.Reduced:e=this.getReducedContainer(t);break;case Qt.Full:e=this.getFullContainer(t);break;default:return}if(e){var n=this.scene2D.layerMap.GetLayersCount()-2;this.hintNode=this.scene2D.addNode(n,e)}}}},{key:"getReducedContainer",value:function(t){var e=new r.NodeContainer,n=t.map((function(t){return t.lines})).reduce((function(t,e){return t.concat(e)}),[]);e.unis.length=n.length;for(var i=0;i<n.length;i++){var o=n[i];e.unis[i]=r.Uni.createLine(o.from[0],o.from[1],o.to[0],o.to[1],.001,this.hintMaterial,"round")}return e}},{key:"getFullContainer",value:function(t){for(var e=new r.NodeContainer,n=t.map((function(t){return t.vertices})).reduce((function(t,e){return t.concat(e)}),[]),i=0;i<n.length;i++)for(var o=n[i],a=o[0],s=1;s<o.length;s++){var u=o[s],l=r.Uni.createLine(a[0],a[1],u[0],u[1],.001,this.hintMaterial,"round");e.unis.push(l),a=u}return e}}])&&ee(e.prototype,n),o&&ee(e,o),Object.defineProperty(e,"prototype",{writable:!1}),t}();function ie(t){return(ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function oe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ae(t,e){return(ae=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function se(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=le(t);if(e){var i=le(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ue(this,n)}}function ue(t,e){if(e&&("object"===ie(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function le(t){return(le=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ce=window.__CORE__,he=(0,window.__APP__.createModule)({type:"Plugin",description:"SupportLibrary",create:function(t){return new(function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ae(t,e)}(o,t);var e,n,r,i=se(o);function o(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this,{name:"SupportLibrary",comment:"SupportLibrary",description:"SupportLibrary"})).logger=ce.createLogger("Support library"),t.layerHelper=new $t,t.dataHelper=new te(t.layerHelper),t.hintHelper=new re,t.contourHelper=new b,t.library=new _t(t.logger,t.dataHelper,t.contourHelper,t.hintHelper),ce.bus.on("GraphiteEngine:createdScene2D",(function(e){return new Promise((function(n){t.dataHelper.setScene2D(e),t.hintHelper.setScene2D(e),t.contourHelper.setScene2D(e),n()}))})),ce.bus.on("PcbEngine:layerManagerCreated",(function(e){t.layerHelper.setup(e)})),ce.bus.on("Layers:change",(function(e){t.layerHelper.setLayers(e.flat())})),ce.bus.on("Layers:offOnly",(function(e){t.layerHelper.setLayers(e.flat())})),ce.bus.on("Layers:onOnly",(function(e){t.layerHelper.setLayerOnly(e)})),ce.bus.on("Layers:reset",(function(){t.layerHelper.resetLayers()})),ce.bus.on("SupportLibrary:hintMode",(function(e){t.hintHelper.hintMode=e})),ce.bus.on("SupportLibrary:getOtoDistance",(function(e){e.result=t.library.getOtoDistance(e.id1,e.id2)})),ce.bus.on("SupportLibrary:lsmToSvg",(function(e){var n;e.result=t.library.lsmToSvg(e.lsm,e.options,null!==(n=e.kind)&&void 0!==n?n:"View")})),t}return e=o,(n=[{key:"events",get:function(){return["SupportLibrary:hintMode","SupportLibrary:getOtoDistance","SupportLibrary:getOtoDistanceResult","SupportLibrary:lsmToSvg"]}},{key:"setup",value:function(){var t=this;return this.logger.LogDebug("Setup"),new Promise((function(e){t.dataHelper.setup(),e()}))}},{key:"handleOtoResult",value:function(t){this.logger.LogDebug("OTO #".concat(t.pcbId1," - #").concat(t.pcbId2," : ").concat(t.state," in ").concat(t.time,"ms")),this.logger.LogDebug(this.dataHelper.pcbFormat([t.distance],Wt.Imperial,qt.Mil,!0)+(t.flattened?" (flattened)":""))}}])&&oe(e.prototype,n),r&&oe(e,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(t))}});ce&&ce.addModule(he)}});