!function(e){function t(t){for(var o,a,c=t[0],u=t[1],s=t[2],l=0,p=[];l<c.length;l++)a=c[l],Object.prototype.hasOwnProperty.call(r,a)&&r[a]&&p.push(r[a][0]),r[a]=0;for(o in u)Object.prototype.hasOwnProperty.call(u,o)&&(e[o]=u[o]);for(f&&f(t);p.length;)p.shift()();return i.push.apply(i,s||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],o=!0,c=1;c<n.length;c++){var u=n[c];0!==r[u]&&(o=!1)}o&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var o={},r={52:0},i=[];function a(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=o,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(n,o,function(t){return e[t]}.bind(null,o));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var c=window.webpackJsonp=window.webpackJsonp||[],u=c.push.bind(c);c.push=t,c=c.slice();for(var s=0;s<c.length;s++)t(c[s]);var f=u;i.push([1152,2]),n()}({1152:function(e,t,n){e.exports=n(1166)},1166:function(e,t,n){"use strict";n.r(t);var o,r,i,a="00000000-0000-0000-0000-000000000000";!function(e){e[e.Resolved=0]="Resolved",e[e.Active=1]="Active"}(o||(o={})),function(e){e[e.None=0]="None",e[e.Polyline=1]="Polyline"}(r||(r={})),function(e){e[e.ZeroSize=0]="ZeroSize",e[e.Small=1]="Small",e[e.Medium=2]="Medium",e[e.Large=3]="Large"}(i||(i={}));var c=window.__CORE__,u=n(15);function s(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var f=new(function(){function e(){var t,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o=!0,(n="_visible")in(t=this)?Object.defineProperty(t,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[n]=o}var t,n,o;return t=e,(n=[{key:"setup",value:function(){var e=this;c.bus.on("CommentsDrawingEngine:visibilityChange",(function(t){return e._visible=t}))}},{key:"visible",get:function(){return this._visible}}])&&s(t.prototype,n),o&&s(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}());function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function h(){return(h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=d(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}}).apply(this,arguments)}function d(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=w(e)););return e}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=w(e);if(t){var r=w(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return b(this,n)}}function b(e,t){if(t&&("object"===l(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return m(e)}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var E={where:function(e){return["PROGRESS"===e.type]},to:"PROGRESS"},O={where:function(e){return["PROGRESS_ACTIVE"===e.type]},to:"PROGRESS_ACTIVE"},S={where:function(e){return["RESOLVE"===e.type]},to:"RESOLVE"},I={where:function(e){return["RESOLVE_ACTIVE"===e.type]},to:"RESOLVE_ACTIVE"},P={where:function(e){return["REMOVE"===e.type]},to:"REMOVE"},T={IDLE:[{where:function(e){return["EDIT"===e.type]},to:"EDIT"},E,S],EDIT:[{where:function(e){return["WAIT_FOR_POST"===e.type]},to:"WAIT_FOR_POST"},P],WAIT_FOR_POST:[O,P],PROGRESS_ACTIVE:[E,I,P],PROGRESS:[O,P],RESOLVE_ACTIVE:[O,S,P],RESOLVE:[I,P]},k=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&y(e,t)}(i,e);var t,n,o,r=v(i);function i(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),g(m(n=r.call(this,"IDLE",T)),"logger",void 0),g(m(n),"viewEngine",void 0),g(m(n),"dataStore",void 0),g(m(n),"toString",(function(){return"CommentsDrawingEngine.Graphics"})),n.logger=c.createLogger("CPGraphics"),n.viewEngine=e,n.dataStore=t,n.onEdit=n.onEdit.bind(m(n)),n.on("EDIT",n.onEdit),n.onRemove=n.onRemove.bind(m(n)),n.on("REMOVE",n.onRemove),n.onReadyToSubmit=n.onReadyToSubmit.bind(m(n)),n.once("WAIT_FOR_POST",n.onReadyToSubmit),n}return t=i,(n=[{key:"type",get:function(){var e;return null!==(e=this.dataStore.type)&&void 0!==e?e:"NONE"}},{key:"guid",get:function(){return this.dataStore.guid}},{key:"documentName",get:function(){var e;return null!==(e=this.dataStore.documentName)&&void 0!==e?e:""}},{key:"documentType",get:function(){var e;return null!==(e=this.dataStore.documentType)&&void 0!==e?e:""}},{key:"objectType",get:function(){var e;return null!==(e=this.dataStore.objectType)&&void 0!==e?e:""}},{key:"documentId",get:function(){var e;return null!==(e=this.dataStore.data.DocumentUniqueID)&&void 0!==e?e:""}},{key:"pageId",get:function(){var e;return null!==(e=this.dataStore.data.PageUniqueID)&&void 0!==e?e:""}},{key:"uniqueId",get:function(){return""===this.pageId.trim()?this.documentId:"".concat(this.pageId,"-").concat(this.documentId)}},{key:"serializedData",get:function(){return this.viewEngine.serializeBaseData(this.dataStore)}},{key:"serializedDrawingData",get:function(){return this.viewEngine.serializeDrawingData(this.dataStore)}},{key:"active",get:function(){return"PROGRESS_ACTIVE"===this.state||"RESOLVE_ACTIVE"===this.state}},{key:"visible",get:function(){var e=this;return!!this.active||"WAIT_FOR_POST"===this.state||!!f.visible&&!!gf.getActiveThreads().find((function(t){return t.id===e.guid}))}},{key:"getState",value:function(){return h(w(i.prototype),"getState",this).call(this)}},{key:"emit",value:function(e){for(var t,n=arguments.length,o=new Array(n>1?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];return(t=h(w(i.prototype),"emit",this)).call.apply(t,[this,e].concat(o))}},{key:"dispatch",value:function(e){return h(w(i.prototype),"dispatch",this).call(this,e)}},{key:"edit",value:function(){this.dispatch({type:"EDIT"})}},{key:"setup",value:function(){switch(this.dataStore.status){case 0:this.dispatch({type:"RESOLVE"});break;case 1:this.dispatch({type:"PROGRESS"});break;default:throw new Error("Not implemented thread status "+status)}}},{key:"resolve",value:function(){this.dispatch({type:"RESOLVE_ACTIVE"})}},{key:"unresolve",value:function(){this.dispatch({type:"PROGRESS_ACTIVE"})}},{key:"remove",value:function(){this.dispatch({type:"REMOVE"})}},{key:"draw",value:function(){var e=this;this.viewEngine.storeToScene(this.dataStore);var t=this.viewEngine.createGraphicsPainter(this.dataStore),n=function(t,n){"PROGRESS"!==e.state&&"RESOLVE"!==e.state||c.bus.emit("CommentsDrawingEngine:showTooltip",{id:e.dataStore.guid,x:t,y:n})};t.on("SHOW_TOOLTIP",n);var o=function(){return c.bus.emit("CommentsDrawingEngine:hideTooltip")};t.on("HIDE_TOOLTIP",o);var r=function(){var t=e.getState();if("IDLE"!==t&&"EDIT"!==t&&"WAIT_FOR_POST"!==t){var n=e.active?null:e.dataStore.guid;c.bus.emit("CommentsDrawingEngine:changeActiveState",n)}};t.on("CHANGE_STATE",r);var i=function(){(e.active||"WAIT_FOR_POST"===e.getState())&&e.emit("UPDATE_ICON_POSITION",{iconRect:t.iconRect})};t.on("ICON_MOVING",i);var a=function(){"WAIT_FOR_POST"!==e.state&&e.emit("UPDATE_THREAD",{op:"replace",path:"/Data",value:e.serializedData})};t.on("ICON_MOVED",a);var u=function(){var t,n,o;e.emit("UPDATE_DRAWINGS",{count:null!==(t=null===(n=e.dataStore.drawing)||void 0===n||null===(o=n.Items)||void 0===o?void 0:o.length)&&void 0!==t?t:0}),e.active&&e.emit("UPDATE_THREAD",{op:"replace",path:"/Drawing",value:e.serializedDrawingData})};t.on("DRAWINGS_CHANGED",u);var s=function(){t.updateVisibility(e.visible),t.updateState(e.getState())};this.on("PROGRESS_ACTIVE",s),this.on("RESOLVE_ACTIVE",s),this.on("RESOLVE",s),this.on("PROGRESS",s),this.once("CLEAR",(function(){t.destroy()}));var f=function(){return t.zoomToFit()};this.on("ZOOM_TO_FIT",f);var l=function(){t.updateVisibility(e.visible)};c.bus.on("CommentsDrawingEngine:visibilityChange",l);var p=function(){return t.updateVisibility(e.visible)};c.bus.on("CommentsDrawingEngine:filterChange",p),t.once("DESTROYED",(function(){t.off("SHOW_TOOLTIP",n),t.off("HIDE_TOOLTIP",o),t.off("CHANGE_STATE",r),t.off("ICON_MOVING",i),t.off("ICON_MOVED",a),t.off("DRAWINGS_CHANGED",u),e.off("PROGRESS_ACTIVE",s),e.off("RESOLVE_ACTIVE",s),e.off("RESOLVE",s),e.off("PROGRESS",s),e.off("ZOOM_TO_FIT",f),c.bus.off("CommentsDrawingEngine:visibilityChange",l),c.bus.off("CommentsDrawingEngine:filterChange",p)})),t.paint(this.getState(),this.visible)}},{key:"clear",value:function(){this.emit("CLEAR")}},{key:"collapse",value:function(){var e=this.getState();"PROGRESS_ACTIVE"===e?this.dispatch({type:"PROGRESS"}):"RESOLVE_ACTIVE"===e&&this.dispatch({type:"RESOLVE"})}},{key:"expand",value:function(){this.dispatch({type:"PROGRESS_ACTIVE"})||this.dispatch({type:"RESOLVE_ACTIVE"})}},{key:"zoomToFit",value:function(){this.emit("ZOOM_TO_FIT")}},{key:"onEdit",value:function(){var e=this;setTimeout((function(){return e.dispatch({type:"WAIT_FOR_POST",threadEditOptions:e.viewEngine.createUiThreadEditOptions()})}))}},{key:"onReadyToSubmit",value:function(){this.logger.LogDebug("Ready to post."),this.draw()}},{key:"onRemove",value:function(){this.logger.LogDebug("Removed."),this.clear()}}])&&p(t.prototype,n),o&&p(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(u.a),j=n(37);function x(e){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function D(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function R(e,t){return(R=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function A(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=B(e);if(t){var r=B(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return M(this,n)}}function M(e,t){if(t&&("object"===x(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _(e)}function _(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function B(e){return(B=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var V=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&R(e,t)}(i,e);var t,n,o,r=A(i);function i(){var e;D(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return L(_(e=r.call.apply(r,[this].concat(n))),"toString",(function(){return"CommentsDrawingEngine.Painters.None"})),e}return t=i,(n=[{key:"iconRect",get:function(){return{isInfinite:!0}}},{key:"paint",value:function(){}},{key:"destroy",value:function(){}},{key:"updateVisibility",value:function(){}},{key:"updateState",value:function(){}},{key:"zoomToFit",value:function(){}}])&&C(t.prototype,n),o&&C(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(j.a);function N(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function G(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var H=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),G(this,"logger",c.createLogger("CPActiveThreadSession")),G(this,"workspace",null),G(this,"cancelClickHandling",null),G(this,"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Base.ActiveThreadSession"}))}var t,n,o;return t=e,(n=[{key:"run",value:function(e){this.stop(),this.workspace=e,e&&(this.onMouseDown=this.onMouseDown.bind(this),this.onTouchStart=this.onTouchStart.bind(this),e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("touchstart",this.onTouchStart))}},{key:"stop",value:function(){this.cancelClickHandling&&(this.cancelClickHandling(),this.cancelClickHandling=null);var e=this.workspace;e&&(e.removeEventListener("mousedown",this.onMouseDown),e.removeEventListener("touchstart",this.onTouchStart))}},{key:"onMouseDown",value:function(e){var t=this;if(0===e.button){var n=!1,o=function(){n=!0},r=function e(t){window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",e),n||c.bus.emit("CommentsDrawingEngine:documentClick",t),n=!1};window.addEventListener("mousemove",o),window.addEventListener("mouseup",r),this.cancelClickHandling&&this.cancelClickHandling(),this.cancelClickHandling=function(){window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",r),t.cancelClickHandling=null},this.stopBubble(e)}}},{key:"onTouchStart",value:function(e){var t=this;if(1===e.touches.length){var n=!1,o=function(){n=!0},r=function e(t){window.removeEventListener("touchmove",o),window.removeEventListener("touchend",e),n||c.bus.emit("CommentsDrawingEngine:documentClick",t),n=!1};window.addEventListener("touchmove",o),window.addEventListener("touchend",r),this.cancelClickHandling&&this.cancelClickHandling(),this.cancelClickHandling=function(){window.removeEventListener("touchmove",o),window.removeEventListener("touchend",r),t.cancelClickHandling=null},this.stopBubble(e)}}},{key:"stopBubble",value:function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}}])&&N(t.prototype,n),o&&N(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();function W(e){return(W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function F(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return U(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return U(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw i}}}}function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function z(e,t,n,o,r,i,a){try{var c=e[i](a),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(o,r)}function Y(e){return function(){var t=this,n=arguments;return new Promise((function(o,r){var i=e.apply(t,n);function a(e){z(i,o,r,a,c,"next",e)}function c(e){z(i,o,r,a,c,"throw",e)}a(void 0)}))}}function X(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function q(){return(q="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=Z(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}}).apply(this,arguments)}function Z(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ee(e)););return e}function J(e,t){return(J=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Q(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=ee(e);if(t){var r=ee(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return $(this,n)}}function $(e,t){if(t&&("object"===W(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return K(e)}function K(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ee(e){return(ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function te(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ne={where:function(e){return["ACTIVE"===e.type]},to:"ACTIVE"},oe={where:function(e){return["NOT_ACTIVE"===e.type]},to:"NOT_ACTIVE"},re={IDLE:[{where:function(e){return["SET"===e.type]},to:"SET"}],SET:[{where:function(e){return["READY"===e.type]},to:"READY"}],READY:[{where:function(e){return["DISABLE"===e.type]},to:"DISABLE"},oe,ne],DISABLE:[],NOT_ACTIVE:[ne],ACTIVE:[oe,ne]},ie=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&J(e,t)}(u,e);var t,n,o,i,a=Q(u);function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),te(K(t=a.call(this,"IDLE",re)),"logger",void 0),te(K(t),"Core",window.__CORE__),te(K(t),"store",new Set),te(K(t),"workspace",null),te(K(t),"activeThreadSession",void 0),te(K(t),"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Base"})),t.logger=c.createLogger("CPViewEngine_".concat(e)),t.activeThreadSession=t.createActiveThreadSession(),t.setupStateChangeHandlers(),t.on("viewShown",(function(e){t.workspace=e,t.onViewShown()})),t.on("viewHidden",(function(){t.onViewHidden(),t.workspace=null})),t.onRemoveThread=t.onRemoveThread.bind(K(t)),c.bus.on("CommentsDrawingEngine:remove",t.onRemoveThread),t.onResolveThread=t.onResolveThread.bind(K(t)),c.bus.on("CommentsDrawingEngine:resolve",t.onResolveThread),t.onActivateThread=t.onActivateThread.bind(K(t)),c.bus.on("CommentsDrawingEngine:activate",t.onActivateThread),t}return t=u,(n=[{key:"state",get:function(){return this.getState()}},{key:"emit",value:function(e){for(var t,n=arguments.length,o=new Array(n>1?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];return(t=q(ee(u.prototype),"emit",this)).call.apply(t,[this,e].concat(o))}},{key:"dispatch",value:function(e){return q(ee(u.prototype),"dispatch",this).call(this,e)}},{key:"setup",value:function(){var e=this;return new Promise((function(t,n){e.dispatch({type:"SET"})?e.once("READY",(function(n){n.error?e.dispatch({type:"DISABLE",error:n.error}):e.viewIsShown()?e.dispatch({type:"ACTIVE"}):e.dispatch({type:"NOT_ACTIVE"}),t()})):n(new Error("Wrong setup initial state [".concat(e.state,"].")))}))}},{key:"createGraphics",value:(i=Y(regeneratorRuntime.mark((function e(){var t,n,o,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.createCreationSession(),n=function(){return t.cancel()},c.bus.on("CommentsDrawingEngine:remove",n),e.next=5,new Promise((function(e){t.once("complete",(function(t,o){c.bus.off("CommentsDrawingEngine:remove",n),e(o.dataStore)})),t.run()}));case 5:if(o=e.sent){e.next=8;break}return e.abrupt("return",null);case 8:return r=new k(this,o),this.registerGraphics(r),r.edit(),e.abrupt("return",r);case 12:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"addGraphics",value:function(e,t){var n=new k(this,e);return this.registerGraphics(n),n.setup(),this.canBePaint(n)&&(n.draw(),t&&n.expand()),Promise.resolve(n)}},{key:"createGraphicsPainter",value:function(e){return new V}},{key:"serializeBaseData",value:function(e){var t=this,n=function(e){return e||" "};if("document"===e.coordType)throw new Error("Not implemented method");var o=e.data,r=[];if(r.push("DocumentUniqueID=".concat(n(o.DocumentUniqueID))),r.push("ObjectUniqueID=".concat(n(o.ObjectUniqueID))),r.push("PageUniqueID=".concat(n(o.PageUniqueID))),r.push("AreaLeft=".concat(this.coordXToDocument(o.AreaLeft))),r.push("AreaTop=".concat(this.coordYToDocument(o.AreaTop))),r.push("AreaRight=".concat(this.coordXToDocument(o.AreaRight))),r.push("AreaBottom=".concat(this.coordYToDocument(o.AreaBottom))),r.push("TextLeft=".concat(this.coordXToDocument(o.TextLeft))),r.push("TextTop=".concat(this.coordYToDocument(o.TextTop))),r.push("TextRight=".concat(this.coordXToDocument(o.TextRight))),r.push("TextBottom=".concat(this.coordYToDocument(o.TextBottom))),r.push("Text=".concat(n(o.Text))),o.SerializedData){var i=o.SerializedData,a={};a.X=this.coordXToDocument(i.X),a.Y=this.coordYToDocument(i.Y),a.AnchorOffsetX=this.coordXToDocument(i.AnchorOffsetX),a.AnchorOffsetY=this.coordYToDocument(i.AnchorOffsetY),Array.isArray(i.Vertices)&&(a.Vertices=[],i.Vertices.forEach((function(e){if(Array.isArray(e)){var n=[];e.forEach((function(e){e&&n.push({X:t.coordXToDocument(e.X),Y:t.coordYToDocument(e.Y)})})),a.Vertices.push(n)}}))),r.push("SerializedData=".concat(JSON.stringify(a)))}return r.push("Collapsed=".concat(o.Collapsed?"True":"False")),r.join("|")}},{key:"serializeDrawingData",value:function(e){var t,n,o=this;if("document"===e.coordType)throw new Error("Not implemented method");var r={Items:new Array};return null===(t=e.drawing)||void 0===t||null===(n=t.Items)||void 0===n||n.forEach((function(e){var t={};t.Type=e.Type,t.Color=e.Color,t.LineSize=e.LineSize,t.AreaLeft=o.coordXToDocument(e.AreaLeft),t.AreaTop=o.coordYToDocument(e.AreaTop),t.AreaRight=o.coordXToDocument(e.AreaRight),t.AreaBottom=o.coordYToDocument(e.AreaBottom);var n=e.Vertices;n&&(t.Vertices=[],n.forEach((function(e){return t.Vertices.push({X:o.coordXToDocument(e.X),Y:o.coordYToDocument(e.Y)})}))),r.Items.push(t)})),JSON.stringify(r)}},{key:"storeToScene",value:function(e){var t,n,o,i,a=this;"document"===e.coordType&&(e.coordType="scene",function(e,t,n){if(e.AreaLeft=t(e.AreaLeft),e.AreaTop=n(e.AreaTop),e.AreaRight=t(e.AreaRight),e.AreaBottom=n(e.AreaBottom),e.TextLeft=t(e.TextLeft),e.TextTop=n(e.TextTop),e.TextRight=t(e.TextRight),e.TextBottom=n(e.TextBottom),e.SerializedData){var o,r,i,a=e.SerializedData;a.X=t(a.X),a.Y=n(a.Y),a.AnchorOffsetX=t(a.AnchorOffsetX),a.AnchorOffsetY=n(a.AnchorOffsetY),null===(o=a.Vertices)||void 0===o||o.forEach((function(e){return null==e?void 0:e.forEach((function(e,o){e&&(e.X=t(e.X),e.Y=n(e.Y),o&&(r?(r.x=Math.min(r.x,e.X),r.y=Math.min(r.y,e.Y)):r={x:e.X,y:e.Y},i?(i.x=Math.max(i.x,e.X),i.y=Math.max(i.y,e.Y)):i={x:e.X,y:e.Y}))}))})),r&&(e.AreaLeft=r.x,e.AreaTop=r.y,e.AreaRight=i.x,e.AreaBottom=i.y)}}(e.data,(function(e){return a.coordXToScene(e)}),(function(e){return a.coordYToScene(e)})),t=e.drawing,n=function(e){return a.coordXToScene(e)},o=function(e){return a.coordYToScene(e)},null==t||null===(i=t.Items)||void 0===i||i.forEach((function(e){var t;e.AreaLeft=n(e.AreaLeft),e.AreaTop=o(e.AreaTop),e.AreaRight=n(e.AreaRight),e.AreaBottom=o(e.AreaBottom),e.Type===r.Polyline&&(null===(t=e.Vertices)||void 0===t||t.forEach((function(e){e&&(e.X=n(e.X),e.Y=o(e.Y))})))})))}},{key:"createActiveThreadSession",value:function(){return new H}},{key:"setupMetadata",value:function(){return Promise.resolve()}},{key:"createOverlay",value:function(){}},{key:"destroyOverlay",value:function(){}},{key:"coordXToDocument",value:function(e){return null!=e?e:0}},{key:"coordYToDocument",value:function(e){return null!=e?e:0}},{key:"coordXToScene",value:function(e){return null!=e?e:0}},{key:"coordYToScene",value:function(e){return null!=e?e:0}},{key:"canBePaint",value:function(e){return"ACTIVE"===this.getState()}},{key:"setupStateChangeHandlers",value:function(){var e=this;this.onSet=this.onSet.bind(this),this.on("SET",(function(){return e.logger.LogDebug("SET")})),this.on("SET",this.onSet),this.on("READY",(function(){return e.logger.LogDebug("READY")})),this.onActivate=this.onActivate.bind(this),this.on("ACTIVE",(function(){return e.logger.LogDebug("ACTIVE")})),this.on("ACTIVE",this.onActivate),this.onDeactivate=this.onDeactivate.bind(this),this.on("NOT_ACTIVE",(function(){return e.logger.LogDebug("NOT_ACTIVE")})),this.on("NOT_ACTIVE",this.onDeactivate),this.onDisable=this.onDisable.bind(this),this.on("DISABLE",(function(){return e.logger.LogDebug("DISABLE")})),this.on("DISABLE",this.onDisable)}},{key:"onSet",value:function(){var e=this;setTimeout(Y(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.setupMetadata();case 3:e.dispatch({type:"READY"}),t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),e.dispatch({type:"READY",error:t.t0});case 9:case"end":return t.stop()}}),t,null,[[0,6]])}))),0)}},{key:"onActivate",value:function(){var e=this;try{this.createOverlay(),this.store.forEach((function(t){e.canBePaint(t)&&t.draw()}))}catch(e){this.logger.LogError("Engine activate error.",e),this.dispatch({type:"NOT_ACTIVE"})}}},{key:"onDeactivate",value:function(){try{c.bus.emit("CommentsDrawingEngine:cancelEdit"),this.store.forEach((function(e){return e.clear()})),this.destroyOverlay()}catch(e){this.logger.LogError("Engine deactivate error.",e)}}},{key:"onDisable",value:function(e){this.logger.LogError("Engine is disabled.",e.error)}},{key:"registerGraphics",value:function(e){var t=this,n=function(){return t.activeThreadSession.run(t.workspace)};e.on("EDIT",n),e.on("RESOLVE_ACTIVE",n),e.on("PROGRESS_ACTIVE",n);var o=function(){return t.activeThreadSession.stop()};e.on("RESOLVE",o),e.on("PROGRESS",o),e.on("REMOVE",(function r(){t.activeThreadSession.stop(),e.off("RESOLVE",o),e.off("PROGRESS",o),e.off("EDIT",n),e.off("RESOLVE_ACTIVE",n),e.off("PROGRESS_ACTIVE",n),e.off("REMOVE",r),t.onGraphicsRemove(e)})),this.store.add(e),this.onGraphicsRegistered(e)}},{key:"onGraphicsRegistered",value:function(e){}},{key:"onGraphicsRemove",value:function(e){this.store.delete(e)}},{key:"onResolveThread",value:function(e){var t=this.getByGuid(e.Guid);if(t)switch(e.Status){case 0:t.unresolve();break;case 1:t.resolve()}}},{key:"onActivateThread",value:function(e){this.store.forEach((function(e){e.active&&e.collapse()}));var t,n=this.getByGuid(e.id);n?this.activateGraphics(n,e.zoomToFit,null!==(t=e.callback)&&void 0!==t?t:function(){}):e.callback&&e.callback(null)}},{key:"getByGuid",value:function(e){if(e){var t,n=F(this.store);try{for(n.s();!(t=n.n()).done;){var o=t.value;if(o.guid===e)return o}}catch(e){n.e(e)}finally{n.f()}}return null}},{key:"onRemoveThread",value:function(e){if(e){this.logger.LogDebug("Try remove "+e);var t=this.getByGuid(e);t&&t.remove()}}},{key:"onViewShown",value:function(){this.dispatch({type:"ACTIVE"})}},{key:"onViewHidden",value:function(){this.dispatch({type:"NOT_ACTIVE"})}}])&&X(t.prototype,n),o&&X(t,o),Object.defineProperty(t,"prototype",{writable:!1}),u}(u.a);function ae(e){return(ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ce(e,t,n,o,r,i,a){try{var c=e[i](a),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(o,r)}function ue(e){return function(){var t=this,n=arguments;return new Promise((function(o,r){var i=e.apply(t,n);function a(e){ce(i,o,r,a,c,"next",e)}function c(e){ce(i,o,r,a,c,"throw",e)}a(void 0)}))}}function se(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function fe(e,t){return(fe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function le(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=de(e);if(t){var r=de(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return pe(this,n)}}function pe(e,t){if(t&&("object"===ae(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return he(e)}function he(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function de(e){return(de=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ye(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ve=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&fe(e,t)}(f,e);var t,n,o,r,i,a,u,s=le(f);function f(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),ye(he(t=s.call(this)),"cancelled",!1),ye(he(t),"leaveEvent",null),ye(he(t),"startPoint",{x:0,y:0}),ye(he(t),"config",void 0),ye(he(t),"logger",void 0),ye(he(t),"toString",(function(){return"CommentsDrawingEngine.CreationSession.Base"})),t.config=e,t.logger=c.createLogger("CPCreationSession_".concat(e.name)),t.on("before",(function(){return t.logger.LogDebug("Start session.")})),t.on("after",(function(){return t.logger.LogDebug("End session.")})),t}return t=f,(n=[{key:"run",value:(u=ue(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.logger.LogDebug("Run"),this.emit("before",this,{}),e.prev=2,t=null;case 4:if(t||this.cancelled){e.next=11;break}return e.next=7,this.execute();case 7:t=e.sent,this.logger.LogDebug("Executed. [Data: ".concat(t,"] [Cancelled: ").concat(this.cancelled,"]")),e.next=4;break;case 11:this.emit("complete",this,{dataStore:t});case 12:return e.prev=12,this.emit("after",this,{}),e.finish(12);case 15:case"end":return e.stop()}}),e,this,[[2,,12,15]])}))),function(){return u.apply(this,arguments)})},{key:"cancel",value:function(){this.cancelled=!0,this.emit("executed",null)}},{key:"doStopBubble",value:function(e){return!0}},{key:"createData",value:function(e){return Promise.resolve(null)}},{key:"init",value:function(e){this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),e.addEventListener("mousemove",this.onMouseMove,!0),e.addEventListener("mousedown",this.onMouseDown,!0),e.addEventListener("mouseleave",this.onMouseLeave,!0),e.addEventListener("touchstart",this.onTouchStart,!0)}},{key:"clear",value:function(e){e.removeEventListener("mousedown",this.onMouseDown,!0),e.removeEventListener("mousemove",this.onMouseMove,!0),e.removeEventListener("mouseleave",this.onMouseLeave,!0),e.removeEventListener("touchstart",this.onTouchStart,!0),e.removeEventListener("mouseup",this.onMouseUp),e.removeEventListener("mouseenter",this.onMouseEnter),e.removeEventListener("touchmove",this.onTouchMove),e.removeEventListener("touchend",this.onTouchEnd)}},{key:"startHighlight",value:function(e){}},{key:"stopHighlight",value:function(){}},{key:"execute",value:(a=ue(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.doExecute();case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),this.logger.LogError("Thread creation error.",e.t0),this.cancelled=!0,e.abrupt("return",null);case 11:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return a.apply(this,arguments)})},{key:"doExecute",value:(i=ue(regeneratorRuntime.mark((function e(){var t,n,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.config.workspace,this.init(t),e.next=4,new Promise((function(e){return o.once("executed",(function(t){return e(t)}))}));case 4:return n=e.sent,this.clear(t),e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"doDrawRect",value:function(e,t){var n={x:Math.min(this.startPoint.x,e),y:Math.min(this.startPoint.y,t),width:Math.abs(this.startPoint.x-e),height:Math.abs(this.startPoint.y-t)};this.emit("drawRect",n)}},{key:"doCreateData",value:(r=ue(regeneratorRuntime.mark((function e(t,n){var o,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o={x:Math.min(this.startPoint.x,t),y:Math.min(this.startPoint.y,n),width:Math.abs(this.startPoint.x-t),height:Math.abs(this.startPoint.y-n)},e.next=4,this.createData(o);case 4:r=e.sent,this.emit("executed",r),e.next=13;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0),this.logger.LogError("Thread data creation error.",e.t0),this.emit("executed",null);case 13:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e,t){return r.apply(this,arguments)})},{key:"stopBubble",value:function(e){this.doStopBubble(e)&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation())}},{key:"onMouseDown",value:function(e){if(0===e.button){var t=this.config.workspace;t.addEventListener("mouseup",this.onMouseUp),t.addEventListener("mouseenter",this.onMouseEnter),this.startPoint.x=e.clientX,this.startPoint.y=e.clientY,this.stopBubble(e)}}},{key:"onMouseMove",value:function(e){switch(e.buttons){case 0:this.startHighlight({x:e.clientX,y:e.clientY}),this.stopBubble(e);break;case 1:this.stopHighlight(),this.stopBubble(e),this.doDrawRect(e.clientX,e.clientY);break;default:this.stopHighlight()}}},{key:"onMouseUp",value:function(e){var t=this.config.workspace;t.removeEventListener("mouseup",this.onMouseUp),t.removeEventListener("mouseenter",this.onMouseEnter),this.doCreateData(e.clientX,e.clientY),this.stopHighlight(),this.stopBubble(e)}},{key:"onMouseLeave",value:function(e){1===e.buttons&&(this.leaveEvent=e)}},{key:"onMouseEnter",value:function(e){1!==e.buttons&&this.leaveEvent&&(this.onMouseUp(this.leaveEvent),this.leaveEvent=null)}},{key:"onTouchStart",value:function(e){var t=this.config.workspace;1===e.touches.length&&(this.startPoint.x=e.touches[0].clientX,this.startPoint.y=e.touches[0].clientY,t.addEventListener("touchmove",this.onTouchMove),t.addEventListener("touchend",this.onTouchEnd),this.stopBubble(e)),2===e.touches.length&&(t.removeEventListener("touchmove",this.onTouchMove),t.removeEventListener("touchend",this.onTouchEnd))}},{key:"onTouchMove",value:function(e){this.doDrawRect(e.touches[0].clientX,e.touches[0].clientY)}},{key:"onTouchEnd",value:function(e){var t=this.config.workspace;1===e.touches.length&&(t.addEventListener("touchmove",this.onTouchMove),t.addEventListener("touchend",this.onTouchEnd)),0===e.touches.length&&(t.removeEventListener("touchmove",this.onTouchMove),t.removeEventListener("touchend",this.onTouchEnd),this.doCreateData(e.changedTouches[0].clientX,e.changedTouches[0].clientY))}}])&&se(t.prototype,n),o&&se(t,o),Object.defineProperty(t,"prototype",{writable:!1}),f}(j.a),be=n(175);function me(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg",e);return Array.isArray(t)?t.forEach((function(e){return n.setAttribute(e.key,e.value)})):Object.entries(t).forEach((function(e){return n.setAttribute(e[0],e[1])})),n}function we(e,t){var n;return null!==(n=Object.keys(e).map((function(t){return e[t]})).filter((function(e){return!(parseInt(e)>=0)})).find((function(n){return e[n]===t})))&&void 0!==n?n:""}function ge(e){return(ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ee(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Oe(e,t){return(Oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Se(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Te(e);if(t){var r=Te(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Ie(this,n)}}function Ie(e,t){if(t&&("object"===ge(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Pe(e)}function Pe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Te(e){return(Te=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ke(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var je=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Oe(e,t)}(u,e);var t,n,r,i=Se(u);function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),ke(Pe(t=i.call(this,{name:"Sch",supportedTypes:["OBJECT","AREA","POINT"],workspace:e.workspace})),"rect",void 0),ke(Pe(t),"activeObjectGroup",void 0),ke(Pe(t),"highlightObjectGroup",void 0),ke(Pe(t),"domPoint",void 0),ke(Pe(t),"paintInfo",void 0),ke(Pe(t),"currentObject",void 0),ke(Pe(t),"toString",(function(){return"CommentsDrawingEngine.CreationSession.Sch"})),t.paintInfo=e,t.setupActiveObjects(),t.on("before",(function(){e.workspace.style.cursor="crosshair"})),t.on("after",(function(){var n,o,r;t.cancelled&&c.bus.emit("SCHView:enableSelection",!0),null===(n=t.rect)||void 0===n||n.remove(),null===(o=t.activeObjectGroup)||void 0===o||o.remove(),null===(r=t.highlightObjectGroup)||void 0===r||r.remove(),e.workspace.style.cursor="auto"})),t.on("drawRect",(function(e){return t.drawRect(e)})),t}return t=u,(n=[{key:"createData",value:function(e){var t={coordType:"scene"};return t.guid=a,t.drawing={Items:[]},t.status=o.Active,t.threadNumber=-1,t.documentName=this.paintInfo.documentName,t.documentType="SCH",t.data={},t.data.DocumentUniqueID=this.paintInfo.documentId,t.data.TextLeft=0,t.data.TextTop=0,t.data.TextRight=0,t.data.TextBottom=0,this.currentObject?(t.type="OBJECT",t.objectType=we(wo,this.currentObject.kind),t.data.ObjectUniqueID=this.currentObject.id,this.currentObject.kind===wo.Wire||this.currentObject.kind===wo.Pin?this.setPointData(t,e):this.setRectData(t,this.currentObject.element.getBoundingClientRect())):e.width||e.height?(t.type="AREA",this.setRectData(t,e)):(t.type="POINT",this.setPointData(t,e)),Promise.resolve(t)}},{key:"drawRect",value:function(e){this.rect||(this.rect=me("rect",{class:"comment-area-selection-rect",fill:"none",stroke:"#267FEB","stroke-width":"4","stroke-opacity":"0.48","stroke-linecap":"round","stroke-linejoin":"round","vector-effect":"non-scaling-stroke"}),this.paintInfo.sceneGroup.appendChild(this.rect));var t=this.screenToSVG(e.x,e.y,this.paintInfo.sceneGroup.getScreenCTM()),n=this.screenToSVG(e.x+e.width,e.y+e.height,this.paintInfo.sceneGroup.getScreenCTM());this.rect.width.baseVal.value=Math.abs(t.x-n.x),this.rect.height.baseVal.value=Math.abs(t.y-n.y),this.rect.x.baseVal.value=Math.min(t.x,n.x),this.rect.y.baseVal.value=Math.min(t.y,n.y),this.activeObjectGroup&&this.activeObjectGroup.setAttribute("display","none")}},{key:"screenToSVG",value:function(e,t,n){var o,r;this.domPoint=null!==(o=this.domPoint)&&void 0!==o?o:null===(r=this.paintInfo.sceneGroup.closest("svg"))||void 0===r?void 0:r.createSVGPoint(),this.domPoint.x=e,this.domPoint.y=t;var i=n;return this.domPoint.matrixTransform(i.inverse())}},{key:"setupActiveObjects",value:function(){var e=this;this.activeObjectGroup&&this.activeObjectGroup.remove(),this.activeObjectGroup=me("g",[{key:"data-type",value:"active-objects"}]),this.paintInfo.sceneGroup.appendChild(this.activeObjectGroup),this.highlightObjectGroup&&this.highlightObjectGroup.remove(),this.highlightObjectGroup=me("g",[{key:"data-type",value:"highlight-objects"}]),this.paintInfo.sceneGroup.appendChild(this.highlightObjectGroup);var t=me("style",{});t.innerHTML="g[data-type=highlight-objects] * { fill: none; stroke: #267FEB; stroke-opacity: 0.48; pointer-events:none; } ",t.innerHTML+="g[data-type=highlight-objects] rect { stroke-width: 2px; } ",this.highlightObjectGroup.appendChild(t),this.paintInfo.objects.forEach((function(t){var n=t.node.getAttribute("id");if(n){var o=function e(n){if(n&&n.localName){var o=n.localName;if("g"===o){if(t.kind===wo.Wire||t.kind===wo.Pin){for(var r=[],i=0;i<n.children.length;i++){var a=e(n.children[i]);a&&r.push(a)}return be.a.join(r)}return be.a.getPathForGroup(n)}if("line"===o)return be.a.getPathForLine(n);if("ellipse"===o)return be.a.getPathForEllipse(n);if("polyline"===o)return be.a.getPathForPolyLine(n);if("polygon"===o)return be.a.getPathForPolygon(n)}return null}(t.node);o&&e.addActiveObjectToScene(o,n,t.kind)}}))}},{key:"addActiveObjectToScene",value:function(e,t,n){var o=this,r=e.createSvgElement((function(e){e.setAttribute("class","activeMouse"),e.addEventListener("mouseenter",(function(){var t=function(e){var t=e;return e.getAttribute("data-id")||(t=e.closest("[".concat("data-id","]"))),{element:t,id:t.getAttribute("data-id"),kind:Number.parseInt(t.getAttribute("data-kind"))}}(e);o.currentObject=t,o.setHighlight(t)})),e.addEventListener("mouseleave",(function(){o.currentObject=null,o.clearHighlight()}))}));r&&(r.setAttribute("data-id",t),r.setAttribute("data-kind","".concat(n)),this.activeObjectGroup.appendChild(r))}},{key:"setHighlight",value:function(e){if(e.kind===wo.Wire||e.kind===wo.Pin){var t=this.paintInfo.sceneGroup.closest("svg");this.setupWireHighlight(null==t?void 0:t.getElementById(e.id),e.id)}else{var n=e.element.cloneNode(!0);n.setAttribute("data-id",e.id),n.setAttribute("data-kind",e.kind),this.highlightObjectGroup.appendChild(n)}}},{key:"clearHighlight",value:function(){for(;this.highlightObjectGroup.hasChildNodes();){var e=this.highlightObjectGroup.lastChild;if("style"===(null==e?void 0:e.nodeName))break;null==e||e.remove()}}},{key:"setupWireHighlight",value:function(e,t){var n=this;if(e&&e.localName){var o=e.localName;if("g"===o)this.forEveryChild(e,(function(e){return n.setupWireHighlight(e,t)}));else if("line"===o||"polyline"===o){var r=e.cloneNode(!0);r.setAttribute("data-id",t),r.hasAttribute("id")&&r.removeAttribute("id");var i=window.getComputedStyle(r)["stroke-width"],a=1;i.match(/^\-?\d+(\.?\d*)px$/)&&(a=parseFloat(i.substring(0,i.length-2))),r.setAttribute("stroke-width","".concat(a+2,"px")),this.highlightObjectGroup.appendChild(r)}}}},{key:"forEveryChild",value:function(e,t){for(var n=e.children,o=0;o<n.length;o++){var r=n[o];r&&t(r)}}},{key:"setPointData",value:function(e,t){var n=this.screenToSVG(t.x,t.y,this.paintInfo.sceneGroup.getScreenCTM());e.data.AreaLeft=Math.round(n.x)+5,e.data.AreaTop=Math.round(n.y)+5,e.data.AreaRight=Math.round(n.x)-5,e.data.AreaBottom=Math.round(n.y)-5}},{key:"setRectData",value:function(e,t){var n=this.screenToSVG(t.x,t.y,this.paintInfo.sceneGroup.getScreenCTM()),o=this.screenToSVG(t.x+t.width,t.y+t.height,this.paintInfo.sceneGroup.getScreenCTM());e.data.AreaLeft=Math.round(n.x),e.data.AreaTop=Math.round(n.y),e.data.AreaRight=Math.round(o.x),e.data.AreaBottom=Math.round(o.y)}}])&&Ee(t.prototype,n),r&&Ee(t,r),Object.defineProperty(t,"prototype",{writable:!1}),u}(ve);function xe(e,t,n,o){var r=o;r||(r=e.closest("svg").createSVGPoint());r.x=t,r.y=n;var i=e.getScreenCTM();return i?r.matrixTransform(i.inverse()):r}var De=function(){var e=this.$createElement,t=this._self._c||e;return t("svg",{staticStyle:{position:"absolute",left:"0",top:"0","pointer-events":"none","z-index":"0"},attrs:{id:this.elementId,xmlns:"http://www.w3.org/2000/svg",width:"100%",height:"100%"}},[t("defs",[t("filter",{attrs:{id:"filter-comment-icon-full-d",x:"4",y:"5",width:"40",height:"40","filter-units":"userSpaceOnUse","color-interpolation-filters":"sRGB"}},[t("feFlood",{attrs:{"flood-opacity":"0",result:"BackgroundImageFix"}}),this._v(" "),t("feColorMatrix",{attrs:{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}}),this._v(" "),t("feOffset",{attrs:{dy:"1"}}),this._v(" "),t("feGaussianBlur",{attrs:{"std-deviation":"2"}}),this._v(" "),t("feColorMatrix",{attrs:{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.48 0"}}),this._v(" "),t("feBlend",{attrs:{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow"}}),this._v(" "),t("feBlend",{attrs:{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow",result:"shape"}})],1)])])};De._withStripped=!0;var Ce={name:"Overlay",data:function(e){return{elementId:e.$root.elementId}}},Re=n(0),Ae=Object(Re.a)(Ce,De,[],!1,null,null,null);Ae.options.__file="src/engines/comment.engine/icon/view/components/Overlay.vue";var Me=Ae.exports,_e=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("g",{style:e.mainGroupStyle,attrs:{"data-id":e.renderInfo.id,transform:e.transform}},[n("line",{staticClass:"connection-line",style:e.connectionLineStyle,attrs:{x1:e.positionX,y1:e.positionY,x2:e.positionX,y2:e.positionY}}),e._v(" "),n("circle",{staticClass:"connection-point",style:e.connectionPointStyle,attrs:{cx:e.positionX,cy:e.positionY,r:"4"}}),e._v(" "),n("foreignObject",{staticClass:"main-icon",staticStyle:{overflow:"visible"},attrs:{height:"32",width:"1",x:e.iconPositionX,y:e.iconPositionY}},[n("Icon",{staticClass:"main-icon-interaction-group",attrs:{text:e.text,"is-active":e.isActive,align:e.iconAlign}})],1)],1)};_e._withStripped=!0;var Be=function(){var e=this.$createElement,t=this._self._c||e;return t("button",{staticClass:"comment-marker",class:this.classes},[t("span",{staticClass:"comment-marker--text"},[this._v(this._s(this.text))]),this._v(" "),t("Css",[this._v('\n    .comment-marker {\n      white-space: nowrap;\n      background: #ffffff;\n      border: 1px\n      solid #181818;\n      border-radius: 4px 4px 4px 0;\n      height: 24px;\n      pointer-events: all;\n      padding: 6px 8px;\n      box-sizing: border-box;\n      display: inline-flex;\n      position: relative;\n    }\n    .comment-marker:after,\n    .comment-marker:before {\n      content: "";\n      display: block;\n      position: absolute;\n      width: 0;\n      height: 0;\n    }\n    .comment-marker:after {\n      top: 21px;\n      left: 0;\n      border-top: 7px solid #ffffff;\n      border-right: 7px solid transparent;\n    }\n    .comment-marker:before {\n      top: 22px;\n      left: -1px;\n      border-top: 9px solid #181818;\n      border-right: 9px solid transparent;\n    }\n    .comment-marker_active {\n      background: #267feb;\n      color: #ffffff;\n    }\n    .comment-marker_active:after,.comment-marker_left.comment-marker_active:after  {\n      border-top-color: #267feb;\n    }\n    .comment-marker--text {\n      font-size: 11px;\n      line-height: 12px;\n    }\n    .comment-marker_left {\n      border-radius: 4px 0 4px 4px;\n    }\n    .comment-marker_left:before {\n      top: -1px;\n      left: auto;\n      right: -9px;\n    }\n    .comment-marker_left:after {\n      top: 0;\n      left: auto;\n      right: -7px;\n      border-top: 8px solid #ffffff;\n      border-right: 8px solid transparent;\n    }\n\n  ')])],1)};Be._withStripped=!0;var Le={name:"Css",functional:!0,render:function(e,t){return e("style",t.children)}},Ve=Object(Re.a)(Le,void 0,void 0,!1,null,null,null);Ve.options.__file="WebUI/VueJsComponentLibrary/src/components/Css/Css.vue";var Ne=Ve.exports,Ge=["top","left"],He={name:"Icon",components:{Css:Ne},props:{text:{type:[Number,String],required:!0,default:""},isActive:{type:Boolean,required:!0,default:!1},align:{type:String,default:"top",validator:function(e){return Ge.includes(e)}}},computed:{classes:function(){return[{"comment-marker_active":this.isActive},"comment-marker_".concat(this.align)]}}},We=Object(Re.a)(He,Be,[],!1,null,null,null);We.options.__file="src/engines/comment.engine/icon/view/components/Icon.vue";var Fe=We.exports;function Ue(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function ze(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ue(Object(n),!0).forEach((function(t){Ye(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ue(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ye(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Xe=window.__APP__.library.Vuex.mapGetters,qe={name:"IconGroup",components:{Icon:Fe},data:function(e){return{renderInfo:e.$root.renderInfo,scale:e.$root.scale}},computed:ze(ze({},Xe(["threadById"])),{},{thread:function(){return this.threadById(this.renderInfo.id)},text:function(){var e,t,n;return(null===(e=this.thread)||void 0===e||null===(t=e.properties)||void 0===t?void 0:t.LwTaskHrid)||(null===(n=this.thread)||void 0===n?void 0:n.threadNumber)||this.renderInfo.threadNumber},transform:function(){return"matrix(".concat(this.scale.x," 0 0 ").concat(this.scale.y," -24 -24)")},visible:function(){return this.renderInfo.visible},state:function(){return this.renderInfo.state},status:function(){return this.renderInfo.status},isActive:function(){return 1===this.state},mainGroupStyle:function(){var e={opacity:1===this.renderInfo.status?1:.48};return this.visible||(e.display="none"),e},mainIconStyle:function(){return{fill:"none","fill-opacity":"1",stroke:"none","stroke-opacity":"1",cursor:"pointer","pointer-events":"all"}},connectionLineStyle:function(){var e={stroke:"#267FEB","stroke-width":"2"};return 0===this.state&&(e.display="none"),e},connectionPointStyle:function(){var e={fill:"#267FEB","fill-opacity":"1",stroke:"none"};return 0===this.state&&(e.display="none"),e},positionX:function(){return(this.renderInfo.iconPosition.x+24)/this.scale.x},positionY:function(){return(this.renderInfo.iconPosition.y+24)/this.scale.y},iconPositionX:function(){var e="left"===this.renderInfo.align?-31:0;return this.positionX+e},iconPositionY:function(){var e="left"===this.renderInfo.align?0:-31;return this.positionY+e},iconAlign:function(){return this.renderInfo.align||"top"}}),mounted:function(){this.renderInfo.iconSvg=this.$el.querySelector(".main-icon"),this.renderInfo.mainCircleGroup=this.$el.querySelector(".main-icon-interaction-group")}},Ze=Object(Re.a)(qe,_e,[],!1,null,null,null);Ze.options.__file="src/engines/comment.engine/icon/view/components/IconGroup.vue";var Je=Ze.exports;function Qe(e){return(Qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ke(e,t){return(Ke=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function et(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=nt(e);if(t){var r=nt(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return tt(this,n)}}function tt(e,t){if(t&&("object"===Qe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function nt(e){return(nt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ot=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ke(e,t)}(i,e);var t,n,o,r=et(i);function i(e,t){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),r.call(this,{store:gf.store,data:{renderInfo:e,scale:t},render:function(e){return e(Je)}})}return t=i,(n=[{key:"mount",value:function(e){var t=document.createElement("div");e.appendChild(t),this.$mount(t)}}])&&$e(t.prototype,n),o&&$e(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(window.__APP__.library.Vue);function rt(e){return(rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function it(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function at(e,t){return(at=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ct(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=ft(e);if(t){var r=ft(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return ut(this,n)}}function ut(e,t){if(t&&("object"===rt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return st(e)}function st(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ft(e){return(ft=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function lt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var pt,ht=window.__APP__.library.Vue;!function(e){e[e.None=0]="None",e[e.Selected=1]="Selected"}(pt||(pt={}));var dt,yt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&at(e,t)}(i,e);var t,n,o,r=ct(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),lt(st(t=r.call(this,{data:{elementId:e},render:function(e){return e(Me)}})),"groupViews",[]),lt(st(t),"scale",{x:1,y:1}),t}return t=i,(n=[{key:"add",value:function(e){var t=new ot(e,this.scale);this.groupViews.push(t),t.mount(this.$el)}},{key:"remove",value:function(e){var t=this.groupViews.findIndex((function(t){return t.renderInfo===e}));if(t>-1){var n=this.groupViews[t];this.groupViews.splice(t,1),n.$el.remove()}}},{key:"mount",value:function(e){var t=document.createElement("div");e.appendChild(t),this.$mount(t),this.onWindowResize=this.onWindowResize.bind(this),window.addEventListener("resize",this.onWindowResize),this.onWindowResize()}},{key:"destroy",value:function(){var e;window.removeEventListener("resize",this.onWindowResize),this.$destroy(),null===(e=this.$el.parentNode)||void 0===e||e.removeChild(this.$el)}},{key:"onWindowResize",value:function(){var e=this.$el.createSVGPoint(),t=xe(this.$el,0,0,e),n=xe(this.$el,10,10,e);this.scale.x=(n.x-t.x)/10,this.scale.y=(n.y-t.y)/10}}])&&it(t.prototype,n),o&&it(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(ht);function vt(e){return(vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function bt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function mt(e,t){return(mt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function wt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Ot(e);if(t){var r=Ot(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return gt(this,n)}}function gt(e,t){if(t&&("object"===vt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Et(e)}function Et(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ot(e){return(Ot=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function St(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.None=0]="None",e[e.Hover=1]="Hover",e[e.Down=2]="Down"}(dt||(dt={}));var It=new Map([["None",{sr:0}],["Hover",{sr:20}],["Down",{sr:24}],["Selected",{sr:24}]]),Pt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&mt(e,t)}(a,e);var t,n,r,i=wt(a);function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),St(Et(t=i.call(this)),"config",void 0),St(Et(t),"renderInfo",void 0),St(Et(t),"moved",!1),St(Et(t),"startPoint",{x:0,y:0}),St(Et(t),"mouseState",dt.None),St(Et(t),"svgPoint",void 0),St(Et(t),"toString",(function(){return"CommentsDrawingEngine.Icon"})),t.config=e,t.renderInfo={id:t.config.guid,visible:!0,state:pt.None,status:o.Active,iconPosition:{x:0,y:0},pointPosition:{x:24,y:24},threadNumber:"#",shadowRadius:0,align:e.iconAlign,scrollable:e.scrollable},t.config.overlayView.add(t.renderInfo),t.initEvents(),t.svgPoint=e.overlayView.$el.closest("svg").createSVGPoint(),t.onChange(),t}return t=a,(n=[{key:"number",set:function(e){this.renderInfo.threadNumber=e}},{key:"visible",set:function(e){this.renderInfo.visible=e}},{key:"state",set:function(e){switch(e){case"WAIT_FOR_POST":case"PROGRESS_ACTIVE":this.renderInfo.state=pt.Selected,this.renderInfo.status=o.Active,this.renderInfo.mainCircleGroup.addEventListener("mousedown",this.onMouseDown),this.refreshIconShadow();break;case"PROGRESS":this.renderInfo.state=pt.None,this.renderInfo.status=o.Active,this.renderInfo.mainCircleGroup.removeEventListener("mousedown",this.onMouseDown),this.refreshIconShadow();break;case"RESOLVE_ACTIVE":this.renderInfo.state=pt.Selected,this.renderInfo.status=o.Resolved,this.renderInfo.mainCircleGroup.addEventListener("mousedown",this.onMouseDown),this.refreshIconShadow();break;case"RESOLVE":this.renderInfo.state=pt.None,this.renderInfo.status=o.Resolved,this.renderInfo.mainCircleGroup.removeEventListener("mousedown",this.onMouseDown),this.refreshIconShadow()}}},{key:"clientBox",get:function(){return this.renderInfo.iconSvg.getBoundingClientRect()}},{key:"destroy",value:function(){this.config.observableObject.off("change",this.onChange),this.config.observableObject.destroy(),this.config.overlayView.remove(this.renderInfo),this.emit("DESTROY")}},{key:"onChange",value:function(){var e=this,t=this.config.observableObject.areaPoint.x,n=this.config.observableObject.areaPoint.y,o=this.config.observableObject.textPoint.x,r=this.config.observableObject.textPoint.y,i=xe(this.config.overlayView.$el,t,n,this.svgPoint),a=i;o===t&&r===n||(a=xe(this.config.overlayView.$el,o,r,this.svgPoint)),(this.renderInfo.iconPosition.x!==a.x||this.renderInfo.iconPosition.y!==a.y||this.renderInfo.pointPosition.x!==i.x||this.renderInfo.pointPosition.y!==i.y||this.renderInfo.scrollable)&&(this.renderInfo.iconPosition.x=a.x,this.renderInfo.iconPosition.y=a.y,this.renderInfo.pointPosition.x=i.x,this.renderInfo.pointPosition.y=i.y,this.config.overlayView.$nextTick((function(){return e.emit("MOVING")})))}},{key:"initEvents",value:function(){var e=this;this.onChange=this.onChange.bind(this),this.config.observableObject.on("change",this.onChange),this.onClick=this.onClick.bind(this),this.renderInfo.mainCircleGroup.addEventListener("click",this.onClick,!0),this.onMouseEnter=this.onMouseEnter.bind(this),this.renderInfo.mainCircleGroup.addEventListener("mouseenter",this.onMouseEnter,!0),this.onMouseLeave=this.onMouseLeave.bind(this),this.renderInfo.mainCircleGroup.addEventListener("mouseleave",this.onMouseLeave,!0),this.onMouseDown=this.onMouseDown.bind(this),this.onMove=this.onMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.renderInfo.mainCircleGroup.addEventListener("mousedown",(function(t){0===t.button&&(e.mouseState|=dt.Down,e.refreshIconShadow())})),this.renderInfo.mainCircleGroup.addEventListener("mouseup",(function(t){0===t.button&&(e.mouseState&=~dt.Down,e.refreshIconShadow())})),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.renderInfo.mainCircleGroup.addEventListener("touchstart",this.onTouchStart,!0)}},{key:"refreshIconShadow",value:function(){var e="None";this.renderInfo.state===pt.Selected?e="Selected":0!=(this.mouseState&dt.Down)?e="Down":0!=(this.mouseState&dt.Hover)&&(e="Hover");var t=It.get(e);this.renderInfo.shadowRadius=t.sr}},{key:"stopBubble",value:function(e){e.stopPropagation(),e.preventDefault()}},{key:"onClick",value:function(e){this.moved?this.moved=!1:this.emit("CLICK"),this.stopBubble(e)}},{key:"onMouseEnter",value:function(e){if(e.target===this.renderInfo.mainCircleGroup){this.mouseState|=dt.Hover,this.refreshIconShadow();var t=this.renderInfo.mainCircleGroup.getBoundingClientRect(),n=t.x+t.width,o=t.y+t.height/2;this.emit("ENTER",n,o)}}},{key:"onMouseLeave",value:function(e){e.target===this.renderInfo.mainCircleGroup&&(this.mouseState&=~dt.Hover,this.mouseState&=~dt.Down,this.refreshIconShadow(),this.emit("LEAVE"))}},{key:"onMouseDown",value:function(e){0===e.button&&(this.startPoint.x=e.clientX,this.startPoint.y=e.clientY,window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("mousemove",this.onMove),this.stopBubble(e))}},{key:"onMouseUp",value:function(e){this.mouseState&=~dt.Down,this.refreshIconShadow(),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("mousemove",this.onMove),this.emit("MOVED"),this.stopBubble(e)}},{key:"onMove",value:function(e){this.moved=!0;var t=this.config.observableObject.textPoint.x+e.clientX-this.startPoint.x,n=this.config.observableObject.textPoint.y+e.clientY-this.startPoint.y;this.startPoint.x=e.clientX,this.startPoint.y=e.clientY,this.emit("TRY_MOVING",t,n)}},{key:"onTouchStart",value:function(e){1===e.touches.length&&(this.startPoint.x=e.touches[0].clientX,this.startPoint.y=e.touches[0].clientY,window.addEventListener("touchmove",this.onTouchMove),window.addEventListener("touchend",this.onTouchEnd),this.stopBubble(e)),2===e.touches.length&&(window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd))}},{key:"onTouchMove",value:function(e){this.moved=!0;var t=this.config.observableObject.textPoint.x+e.touches[0].clientX-this.startPoint.x,n=this.config.observableObject.textPoint.y+e.touches[0].clientY-this.startPoint.y;this.startPoint.x=e.touches[0].clientX,this.startPoint.y=e.touches[0].clientY,this.emit("TRY_MOVING",t,n)}},{key:"onTouchEnd",value:function(e){1===e.touches.length&&(window.addEventListener("touchmove",this.onTouchMove),window.addEventListener("touchend",this.onTouchEnd)),0===e.touches.length&&(window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd),this.emit("MOVED"),this.stopBubble(e))}}])&&bt(t.prototype,n),r&&bt(t,r),Object.defineProperty(t,"prototype",{writable:!1}),a}(j.a);function Tt(e){return(Tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function kt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function jt(){return(jt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=xt(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}}).apply(this,arguments)}function xt(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Mt(e)););return e}function Dt(e,t){return(Dt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ct(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Mt(e);if(t){var r=Mt(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Rt(this,n)}}function Rt(e,t){if(t&&("object"===Tt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return At(e)}function At(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Mt(e){return(Mt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Bt={where:function(e){return["SHOW_ACTIVE"===e.type]},to:"SHOW_ACTIVE"},Lt={where:function(e){return["IDLE"===e.type]},to:"IDLE"},Vt={IDLE:[{where:function(e){return["SHOW"===e.type]},to:"SHOW"}],SHOW:[Lt,Bt],SHOW_INACTIVE:[Lt,Bt],SHOW_ACTIVE:[{where:function(e){return["SHOW_INACTIVE"===e.type]},to:"SHOW_INACTIVE"}]},Nt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Dt(e,t)}(i,e);var t,n,o,r=Ct(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),_t(At(t=r.call(this,"IDLE",Vt)),"destroyed",!1),_t(At(t),"logger",void 0),i.prototype.toString=function(){return null!=e?e:"?????"},t.logger=c.createLogger("CPGraphicsEditMode_".concat(e)),t.onShow=t.onShow.bind(At(t)),t.on("SHOW",t.onShow),t.onHide=t.onHide.bind(At(t)),t.on("IDLE",t.onHide),t.onActivate=t.onActivate.bind(At(t)),t.on("SHOW_ACTIVE",t.onActivate),t.onDeactivate=t.onDeactivate.bind(At(t)),t.on("SHOW_INACTIVE",t.onDeactivate),t}return t=i,(n=[{key:"dispatch",value:function(e){return jt(Mt(i.prototype),"dispatch",this).call(this,e)}},{key:"show",value:function(){this.dispatch({type:"SHOW"})}},{key:"hide",value:function(){this.stop(),this.dispatch({type:"IDLE"})}},{key:"start",value:function(){this.dispatch({type:"SHOW_ACTIVE"})}},{key:"stop",value:function(){this.dispatch({type:"SHOW_INACTIVE"})}},{key:"destroy",value:function(){this.hide(),this.destroyed||(this.destroyed=!0,this.onDestroy())}},{key:"getBoundBox",value:function(){var e=this.getBoundRect();return{isInfinite:e.isInfinite,min:{x:e.left,y:e.top,z:0},max:{x:e.left+e.width,y:e.top+e.height,z:0}}}},{key:"onShow",value:function(){}},{key:"onActivate",value:function(){}},{key:"onDeactivate",value:function(){}},{key:"onHide",value:function(){}},{key:"onDestroy",value:function(){}}])&&kt(t.prototype,n),o&&kt(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(u.a);function Gt(e){return(Gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ht(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Wt(e,t){return(Wt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ft(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Yt(e);if(t){var r=Yt(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Ut(this,n)}}function Ut(e,t){if(t&&("object"===Gt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return zt(e)}function zt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Yt(e){return(Yt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Xt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var qt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Wt(e,t)}(i,e);var t,n,o,r=Ft(i);function i(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),Xt(zt(n=r.call(this,"Main")),"modes",new Map),Xt(zt(n),"active",null),n.modes.set("text",e),t&&n.modes.set("drawing",t),n.onChangeEditMode=n.onChangeEditMode.bind(zt(n)),n}return t=i,(n=[{key:"getBoundRect",value:function(){var e={isInfinite:!0};return Array.from(this.modes.values()).forEach((function(t){if(t){var n=t.getBoundRect();n.isInfinite||(e.isInfinite?(e.isInfinite=!1,e.left=n.left,e.top=n.top,e.width=n.width,e.height=n.height):(e.left=Math.min(e.left,n.left),e.top=Math.min(e.top,n.top),e.width=Math.max(e.left+e.width,n.left+n.width)-e.left,e.height=Math.max(e.top+e.height,n.top+n.height)-e.top))}})),e}},{key:"getBoundBox",value:function(){var e={isInfinite:!0};return Array.from(this.modes.values()).forEach((function(t){if(t){var n=t.getBoundBox();n.isInfinite||(e.isInfinite?(e.isInfinite=!1,e.min=n.min,e.min=n.min):(e.min={x:Math.min(e.min.x,n.min.x),y:Math.min(e.min.y,n.min.y),z:Math.min(e.min.z,n.min.z)},e.max={x:Math.max(e.max.x,n.max.x),y:Math.max(e.max.y,n.max.y),z:Math.max(e.max.z,n.max.z)}))}})),e}},{key:"onShow",value:function(){Array.from(this.modes.values()).forEach((function(e){return e.show()}))}},{key:"onHide",value:function(){Array.from(this.modes.values()).forEach((function(e){return e.hide()}))}},{key:"onDestroy",value:function(){Array.from(this.modes.values()).forEach((function(e){return e.destroy()}))}},{key:"onActivate",value:function(){c.bus.on("CommentsDrawingEngine:changeEditMode",this.onChangeEditMode),this.onChangeEditMode("text")}},{key:"onDeactivate",value:function(){var e;null===(e=this.active)||void 0===e||e.stop(),this.active=null,c.bus.off("CommentsDrawingEngine:changeEditMode",this.onChangeEditMode)}},{key:"onChangeEditMode",value:function(e){var t,n;null===(t=this.active)||void 0===t||t.stop(),this.active=this.modes.get(e),null===(n=this.active)||void 0===n||n.start()}}])&&Ht(t.prototype,n),o&&Ht(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(Nt);function Zt(e){return(Zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Jt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Qt(e,t){return(Qt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function $t(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=tn(e);if(t){var r=tn(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Kt(this,n)}}function Kt(e,t){if(t&&("object"===Zt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return en(e)}function en(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tn(e){return(tn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function nn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var on=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Qt(e,t)}(i,e);var t,n,o,r=$t(i);function i(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),nn(en(n=r.call(this)),"logger",void 0),nn(en(n),"icon",null),nn(en(n),"editMode",null),nn(en(n),"dataStore",void 0),nn(en(n),"areaPoint",{x:0,y:0}),nn(en(n),"textPoint",{x:0,y:0}),nn(en(n),"toString",(function(){return"CommentsDrawingEngine.Painters.Base"})),n.logger=c.createLogger("CPGraphicsPainter_".concat(e)),n.dataStore=t,n.onIconMoved=n.onIconMoved.bind(en(n)),n.onIconTryMoving=n.onIconTryMoving.bind(en(n)),n.onIconMoving=n.onIconMoving.bind(en(n)),n.onIconEnter=n.onIconEnter.bind(en(n)),n.onIconLeave=n.onIconLeave.bind(en(n)),n.onIconClick=n.onIconClick.bind(en(n)),n}return t=i,(n=[{key:"iconRect",get:function(){var e={isInfinite:!0};if(this.icon){var t=this.icon.clientBox;e.top=t.top,e.left=t.left,e.width=t.width,e.height=t.height,e.isInfinite=!1}return e}},{key:"paint",value:function(e,t){this.editMode=this.createAndInitEditMode(),this.icon=this.createAndInitIcon(),this.updateState(e),this.updateVisibility(t)}},{key:"destroy",value:function(){var e,t;null===(e=this.icon)||void 0===e||e.destroy(),this.icon=null,null===(t=this.editMode)||void 0===t||t.destroy(),this.editMode=null,this.emit("DESTROYED")}},{key:"updateVisibility",value:function(e){this.icon&&(this.icon.visible=e)}},{key:"updateState",value:function(e){var t=this;this.icon&&(this.icon.state=e);var n=function(){var e;return null===(e=t.editMode)||void 0===e?void 0:e.start()},o=function(){var e;return null===(e=t.editMode)||void 0===e?void 0:e.stop()};if(this.editMode)switch(e){case"WAIT_FOR_POST":this.editMode.show(),this.editMode.start(),this.emit("ICON_MOVING");break;case"PROGRESS_ACTIVE":case"RESOLVE_ACTIVE":this.editMode.show(),c.bus.on("CommentsDrawingEngine:startEdit",n),c.bus.on("CommentsDrawingEngine:stopEdit",o),this.emit("ICON_MOVING");break;default:c.bus.off("CommentsDrawingEngine:startEdit",n),c.bus.off("CommentsDrawingEngine:stopEdit",o),this.editMode.hide()}}},{key:"zoomToFit",value:function(){}},{key:"createIcon",value:function(){var e={};return e.observableObject=this.getObservableObject(),e.overlayView=this.getIconOverlayView(),e.guid=this.dataStore.guid,e.type=this.dataStore.type,new Pt(e)}},{key:"tryCommitIconPosition",value:function(){return!0}},{key:"tryMoveIcon",value:function(e){return!1}},{key:"createAndInitIcon",value:function(){var e=this,t=this.createIcon();return this.dataStore.threadNumber>0&&(t.number="".concat(this.dataStore.threadNumber)),t.on("MOVED",this.onIconMoved),t.on("TRY_MOVING",this.onIconTryMoving),t.on("MOVING",this.onIconMoving),t.on("ENTER",this.onIconEnter),t.on("LEAVE",this.onIconLeave),t.on("CLICK",this.onIconClick),t.on("DESTROY",(function(){t.off("MOVED",e.onIconMoved),t.off("TRY_MOVING",e.onIconTryMoving),t.off("MOVING",e.onIconMoving),t.off("ENTER",e.onIconEnter),t.off("LEAVE",e.onIconLeave),t.off("CLICK",e.onIconClick)})),t}},{key:"createAndInitEditMode",value:function(){var e=this.createTextEditMode(this.dataStore),t=this.createDrawingEditMode(this.dataStore);return t?new qt(e,t):new qt(e)}},{key:"onIconMoved",value:function(){this.tryCommitIconPosition()&&this.emit("ICON_MOVED")}},{key:"onIconMoving",value:function(){this.emit("ICON_MOVING")}},{key:"onIconTryMoving",value:function(e,t){var n={x:e,y:t};if(this.tryMoveIcon(n)){var o=this.dataStore.data;if(o.TextRight-o.TextLeft||o.TextBottom-o.TextTop){var r=o.TextRight-o.TextLeft,i=o.TextBottom-o.TextTop;o.TextLeft=n.x,o.TextTop=n.y,o.TextRight=o.TextLeft+r,o.TextBottom=o.TextTop+i}else o.TextLeft=n.x,o.TextTop=n.y,o.TextRight=n.x+105,o.TextBottom=n.y+50;this.textPoint.x=n.x,this.textPoint.y=n.y,this.emit("SCENE_CHANGED")}}},{key:"onIconEnter",value:function(e,t){}},{key:"onIconLeave",value:function(){}},{key:"onIconClick",value:function(){this.emit("CHANGE_STATE")}}])&&Jt(t.prototype,n),o&&Jt(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(j.a);function rn(e){return(rn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function an(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function cn(e,t){return(cn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function un(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=ln(e);if(t){var r=ln(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return sn(this,n)}}function sn(e,t){if(t&&("object"===rn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return fn(e)}function fn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ln(e){return(ln=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function pn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var hn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&cn(e,t)}(i,e);var t,n,o,r=un(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),pn(fn(t=r.call(this)),"owner",void 0),pn(fn(t),"toString",(function(){return"CommentsDrawingEngine.Icon.ObservableObject"})),t.owner=e,t.onSceneChanged=t.onSceneChanged.bind(fn(t)),t.owner.on("SCENE_CHANGED",t.onSceneChanged),t}return t=i,(n=[{key:"areaPoint",get:function(){return this.owner.areaScreenPoint}},{key:"textPoint",get:function(){return this.owner.textScreenPoint}},{key:"destroy",value:function(){this.owner.off("SCENE_CHANGED",this.onSceneChanged)}},{key:"onSceneChanged",value:function(){this.emit("change")}}])&&an(t.prototype,n),o&&an(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(j.a);function dn(e,t,n,o){var r=o;r||(r=e.closest("svg").createSVGPoint());r.x=t,r.y=n;var i=e.getScreenCTM();return i?r.matrixTransform(i):r}function yn(e){return(yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function vn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function bn(e,t){return(bn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function mn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=En(e);if(t){var r=En(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return wn(this,n)}}function wn(e,t){if(t&&("object"===yn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return gn(e)}function gn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function En(e){return(En=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function On(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Sn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&bn(e,t)}(i,e);var t,n,o,r=mn(i);function i(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),On(gn(n=r.call(this,e.type)),"nodes",[]),On(gn(n),"dataStore",void 0),On(gn(n),"paintInfo",void 0),On(gn(n),"obj",void 0),n.dataStore=e,n.paintInfo=t,n.rectangleFromData(e,t.sceneGroup),n}return t=i,(n=[{key:"getBoundRect",value:function(){var e,t={isInfinite:!1};if(null!==(e=this.obj)&&void 0!==e&&e.node){var n=this.obj.node.getBBox();t.left=n.x,t.top=n.y,t.width=n.width,t.height=n.height}else{var o=this.dataStore.data;t.left=Math.min(o.AreaLeft,o.AreaRight),t.top=Math.min(o.AreaTop,o.AreaBottom),t.width=Math.abs(o.AreaLeft-o.AreaRight),t.height=Math.abs(o.AreaTop-o.AreaBottom)}return t}},{key:"onShow",value:function(){this.nodes.forEach((function(e){return e.setAttribute("display","")}))}},{key:"onHide",value:function(){this.nodes.forEach((function(e){return e.setAttribute("display","none")}))}},{key:"onDestroy",value:function(){this.nodes.forEach((function(e){return e.remove()})),this.nodes=[]}},{key:"setRectangle",value:function(e,t,n){var o=me("rect",{class:"thread-contour","vector-effect":"non-scaling-stroke",display:"none","data-guid":e.guid,fill:"none",stroke:"#267FEB","stroke-width":"4","stroke-opacity":"0.48","stroke-linecap":"round","stroke-linejoin":"round"});if(t.appendChild(o),this.nodes.push(o),n)o.x.baseVal.value=n.x,o.y.baseVal.value=n.y,o.width.baseVal.value=n.width,o.height.baseVal.value=n.height;else{var r=e.data;o.x.baseVal.value=Math.min(r.AreaLeft,r.AreaRight),o.y.baseVal.value=Math.min(r.AreaTop,r.AreaBottom),o.width.baseVal.value=Math.abs(r.AreaLeft-r.AreaRight),o.height.baseVal.value=Math.abs(r.AreaTop-r.AreaBottom)}}},{key:"setWire",value:function(e,t){var n=this;if(e&&e.localName){var o=e.localName;if("g"===o)this.forEveryChild(e,(function(e){return n.setWire(e,t)}));else if("line"===o||"polyline"===o){var r=e.cloneNode(!0);r.hasAttribute("id")&&r.removeAttribute("id");var i=window.getComputedStyle(r)["stroke-width"],a=1;i.match(/^\-?\d+(\.?\d*)px$/)&&(a=parseFloat(i.substring(0,i.length-2))),r.setAttribute("stroke-width","".concat(a+2,"px")),r.style.fill="none",r.style.stroke="#267FEB",r.style.strokeOpacity="0.48",r.style.pointerEvents="none",this.nodes.push(r),t.appendChild(r)}}}},{key:"forEveryChild",value:function(e,t){for(var n=e.children,o=0;o<n.length;o++){var r=n[o];r&&t(r)}}},{key:"rectangleFromData",value:function(e,t){switch(e.type){case"OBJECT":var n=this.dataStore.data.ObjectUniqueID;if(this.obj=this.paintInfo.objects.find((function(e){return e.node.getAttribute("id")===n})),this.obj)if(this.obj.kind===wo.Wire||this.obj.kind===wo.Pin)this.setWire(this.obj.node,t);else{var o=this.obj.node.getBBox();this.setRectangle(e,t,o)}else this.setRectangle(e,t);break;case"POINT":break;case"AREA":this.setRectangle(e,t);break;case"REDLINE":this.setRectangle(e,t);var r=me("g",{class:"redline-thread-drawing","vector-effect":"non-scaling-stroke",display:"none","data-guid":e.guid,stroke:"rgb(236, 64, 37)","stroke-width":"2px","stroke-opacity":"1",fill:"none"});t.appendChild(r),this.nodes.push(r),this.drawRedline(r,e)}}},{key:"drawRedline",value:function(e,t){var n,o,r,i,a;if(null!==(n=t.data)&&void 0!==n&&null!==(o=n.SerializedData)&&void 0!==o&&o.Vertices){var c=e.closest("svg");null==t||null===(r=t.data)||void 0===r||null===(i=r.SerializedData)||void 0===i||null===(a=i.Vertices)||void 0===a||a.forEach((function(t){if(t){var n=me("polyline",{});t.forEach((function(e,t){if(t){var o=c.createSVGPoint();o.x=e.X,o.y=e.Y,n.points.appendItem(o)}})),e.appendChild(n)}}))}}}])&&vn(t.prototype,n),o&&vn(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(Nt);function In(e){return(In="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Pn(e){return function(e){if(Array.isArray(e))return Tn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Tn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Tn(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Tn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function kn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function jn(e,t){return(jn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function xn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Rn(e);if(t){var r=Rn(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Dn(this,n)}}function Dn(e,t){if(t&&("object"===In(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Cn(e)}function Cn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Rn(e){return(Rn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function An(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Mn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&jn(e,t)}(a,e);var t,n,o,i=xn(a);function a(e,t,n,o,r){var c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),An(Cn(c=i.call(this,null!=r?r:"Drawing")),"color","#FF"),An(Cn(c),"lineThicknessData",{id:1,thickness:2}),An(Cn(c),"workspace",void 0),An(Cn(c),"oldCursor",void 0),An(Cn(c),"canvas",void 0),An(Cn(c),"poly",null),An(Cn(c),"points",[]),An(Cn(c),"dataStore",void 0),An(Cn(c),"point",void 0),An(Cn(c),"onChanged",void 0),An(Cn(c),"toString",(function(){return"CommentsDrawingEngine.Painters.EditModes.Drawing"})),c.dataStore=e,c.onChanged=o,c.workspace=t,c.canvas=me("g",{class:"thread-custom-drawing",display:"none","data-guid":e.guid}),n.appendChild(c.canvas),c.onColorChanged=c.onColorChanged.bind(Cn(c)),c.onLineChanged=c.onLineChanged.bind(Cn(c)),c.onDeleteDrawing=c.onDeleteDrawing.bind(Cn(c)),c.onMouseDown=c.onMouseDown.bind(Cn(c)),c.onMouseMove=c.onMouseMove.bind(Cn(c)),c.onMouseUp=c.onMouseUp.bind(Cn(c)),c.onMouseLeave=c.onMouseLeave.bind(Cn(c)),c.onTouchStart=c.onTouchStart.bind(Cn(c)),c.onTouchMove=c.onTouchMove.bind(Cn(c)),c.onTouchEnd=c.onTouchEnd.bind(Cn(c)),c.point=n.closest("svg").createSVGPoint(),c.drawBasicPoints(),c}return t=a,(n=[{key:"xPrecision",get:function(){return 1}},{key:"yPrecision",get:function(){return 1}},{key:"getBoundRect",value:function(){var e,t,n={isInfinite:!0},o=null===(e=this.dataStore)||void 0===e||null===(t=e.drawing)||void 0===t?void 0:t.Items;if(o&&o.length){n.isInfinite=!1;var r=o.map((function(e){return{AreaLeft:Math.min(e.AreaLeft,e.AreaRight),AreaRight:Math.max(e.AreaLeft,e.AreaRight),AreaTop:Math.min(e.AreaTop,e.AreaBottom),AreaBottom:Math.max(e.AreaTop,e.AreaBottom)}})),i=Math.min.apply(Math,Pn(r.map((function(e){return e.AreaLeft})))),a=Math.min.apply(Math,Pn(r.map((function(e){return e.AreaTop})))),c=Math.max.apply(Math,Pn(r.map((function(e){return e.AreaRight})))),u=Math.max.apply(Math,Pn(r.map((function(e){return e.AreaBottom}))));n.left=i,n.top=a,n.width=c-i,n.height=u-a}return n}},{key:"onShow",value:function(){this.canvas.setAttribute("display","")}},{key:"onHide",value:function(){this.canvas.setAttribute("display","none")}},{key:"onDestroy",value:function(){this.canvas.remove()}},{key:"onActivate",value:function(){var e,t;c.bus.on("CommentsDrawingEngine:startColorPicker",this.onColorChanged),c.bus.on("CommentsDrawingEngine:startLinePicker",this.onLineChanged),c.bus.on("CommentsDrawingEngine:deleteDrawing",this.onDeleteDrawing),this.workspace.addEventListener("mousedown",this.onMouseDown,!0),this.workspace.addEventListener("mousemove",this.onMouseMove,!0),this.workspace.addEventListener("touchstart",this.onTouchStart,!0),this.oldCursor=null!==(e=null===(t=window.getComputedStyle(this.workspace,null))||void 0===t?void 0:t.cursor)&&void 0!==e?e:"auto",this.workspace.style.cursor="url('".concat("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAUCAYAAABWMrcvAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAADiSURBVHgBtVNBEcIwEFxQUAnBARLqAAnEATigKEACsYCCSqiEgILiAK7TvclBm9APN7OTabPb3bukwB/qIIiCTtAK3C+BJ1nL8XlbEnV0uSI5DGu7Rj7WTbARPBjtxL1qTuBIqrjquyDo6TypYXPPL2s0Jc4Ow5mNnms0HznOubQmSoNxghFpcpPyjFGTWBlBoFvWJRZ6+ijN6zM9OUtembxnxgD7eQruGG/AZACBpGCiVUjn5JDpRU/ZI12dCzLNq9O3fUMxSiK9Hg7pgOuSqBHsKH4tEYDR4lKy1hYL/khbb0RWQQonlxdXAAAAAElFTkSuQmCC","') 0 20, auto")}},{key:"onDeactivate",value:function(){c.bus.off("CommentsDrawingEngine:startColorPicker",this.onColorChanged),c.bus.off("CommentsDrawingEngine:startLinePicker",this.onLineChanged),c.bus.off("CommentsDrawingEngine:deleteDrawing",this.onDeleteDrawing),this.workspace.removeEventListener("mousedown",this.onMouseDown,!0),this.workspace.removeEventListener("mousemove",this.onMouseMove,!0),this.workspace.removeEventListener("mouseup",this.onMouseUp,!0),this.workspace.removeEventListener("mouseleave",this.onMouseLeave,!0),this.workspace.removeEventListener("touchstart",this.onTouchStart,!0),this.workspace.removeEventListener("touchmove",this.onTouchMove,!0),this.workspace.removeEventListener("touchend",this.onTouchEnd,!0),this.workspace.style.cursor=this.oldCursor}},{key:"onColorChanged",value:function(e){var t,n,o;this.color=null!==(t=null===(n=gf.colorPickerData)||void 0===n||null===(o=n.find((function(t){return t.id===e.id})))||void 0===o?void 0:o.color)&&void 0!==t?t:this.color}},{key:"onLineChanged",value:function(e){var t,n;this.lineThicknessData=null!==(t=null===(n=gf.lineThicknessData)||void 0===n?void 0:n.find((function(t){return t.id===e.id})))&&void 0!==t?t:this.lineThicknessData}},{key:"onDeleteDrawing",value:function(){this.canvas.querySelectorAll("[data-edit]").forEach((function(e){var t=e.didClearItem;t&&(e.dispatchEvent(t),e.remove())})),this.onChanged&&this.onChanged()}},{key:"drawBasicPoints",value:function(){var e,t,n=this,o=this.canvas.closest("svg");null===(e=this.dataStore.drawing)||void 0===e||null===(t=e.Items)||void 0===t||t.forEach((function(e){if(e&&e.Type===r.Polyline){var t,i,a=e,c=null!==(t=gf.lineThicknessData.find((function(t){return t.id===e.LineSize})))&&void 0!==t?t:n.lineThicknessData,u=n.createDrawingPolyline(e.Color,c.thickness);n.canvas.appendChild(u),null===(i=a.Vertices)||void 0===i||i.forEach((function(e){var t=o.createSVGPoint();t.x=e.X*n.xPrecision,t.y=e.Y*n.yPrecision,u.points.appendItem(t)}))}}))}},{key:"drawPoint",value:function(e,t,n){var o=this,i=xe(this.canvas,e,t,this.point);if(1===n)this.points.length=0,this.poly=this.createDrawingPolyline(this.color,this.lineThicknessData.thickness),this.poly.setAttribute("data-edit",""),this.canvas.appendChild(this.poly),this.poly.points.appendItem(i),this.points.push({X:i.x/this.xPrecision,Y:i.y/this.yPrecision});else if(0===n)this.poly&&(this.poly.points.appendItem(i),this.points.push({X:i.x/this.xPrecision,Y:i.y/this.yPrecision}));else{if(this.poly){var a={};a.Color=this.color,a.Type=r.Polyline,a.LineSize=this.lineThicknessData.id,a.Vertices=this.points.slice();var c=this.poly.getBBox();a.AreaTop=c.y/this.yPrecision,a.AreaLeft=c.x/this.xPrecision,a.AreaBottom=(c.y+c.height)/this.yPrecision,a.AreaRight=(c.x+c.width)/this.xPrecision;var u=new CustomEvent("didClearItem");this.poly.didClearItem=u,this.poly.addEventListener("didClearItem",(function(){var e=o.dataStore.drawing.Items,t=e.findIndex((function(e){return e==a}));t>-1&&e.splice(t,1)})),this.dataStore.drawing.Items.push(a),this.onChanged&&this.onChanged()}this.poly=null,this.points.length=0}}},{key:"createDrawingPolyline",value:function(e,t){var n=me("polyline",{"vector-effect":"non-scaling-stroke"});return n.style.stroke=e,n.style.strokeWidth="".concat(t,"px"),n.style.strokeOpacity="1",n.style.fill="none",n}},{key:"stopBubble",value:function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}},{key:"onMouseDown",value:function(e){var t=this;if(0===e.button){var n=e.clientX,o=e.clientY,r=this.workspace;r.addEventListener("mouseup",this.onMouseUp,!0),r.addEventListener("mouseleave",this.onMouseLeave,!0),setTimeout((function(e){t.drawPoint(n,o,1)}),0),this.stopBubble(e),c.bus.emit("CommentsDrawingEngine:startDraw")}}},{key:"onMouseMove",value:function(e){var t=this;if(1===e.buttons){var n=e.clientX,o=e.clientY;setTimeout((function(e){t.drawPoint(n,o,0)}),0)}2!==e.buttons&&this.stopBubble(e)}},{key:"onMouseUp",value:function(e){var t=this,n=this.workspace;n.removeEventListener("mouseup",this.onMouseUp,!0),n.removeEventListener("mouseleave",this.onMouseLeave,!0);var o=e.clientX,r=e.clientY;setTimeout((function(){t.drawPoint(o,r,2)}),0),c.bus.emit("CommentsDrawingEngine:endDraw")}},{key:"onMouseLeave",value:function(e){e.target===this.workspace&&this.onMouseUp(e)}},{key:"onTouchStart",value:function(e){var t=this;if(1===e.touches.length){var n=e.touches[0].clientX,o=e.touches[0].clientY,r=this.workspace;r.addEventListener("touchmove",this.onTouchMove,!0),r.addEventListener("touchend",this.onTouchEnd,!0),setTimeout((function(e){t.drawPoint(n,o,1)}),0),this.stopBubble(e),c.bus.emit("CommentsDrawingEngine:startDraw")}if(2===e.touches.length){var i=this.workspace;i.removeEventListener("touchmove",this.onTouchMove,!0),i.removeEventListener("touchend",this.onTouchEnd,!0)}}},{key:"onTouchMove",value:function(e){var t=this,n=e.touches[0].clientX,o=e.touches[0].clientY;setTimeout((function(e){t.drawPoint(n,o,0)}),0)}},{key:"onTouchEnd",value:function(e){var t=this;if(1===e.touches.length){var n=this.workspace;n.addEventListener("touchmove",this.onTouchMove,!0),n.addEventListener("touchend",this.onTouchEnd,!0)}if(0===e.touches.length){var o=this.workspace;o.removeEventListener("touchmove",this.onTouchMove,!0),o.removeEventListener("touchend",this.onTouchEnd,!0);var r=e.changedTouches[0].clientX,i=e.changedTouches[0].clientY;setTimeout((function(){t.drawPoint(r,i,2)}),0),c.bus.emit("CommentsDrawingEngine:endDraw")}}}])&&kn(t.prototype,n),o&&kn(t,o),Object.defineProperty(t,"prototype",{writable:!1}),a}(Nt),_n=Mn;function Bn(e){return(Bn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ln(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Vn(){return(Vn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=Nn(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}}).apply(this,arguments)}function Nn(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Un(e)););return e}function Gn(e,t){return(Gn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Hn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Un(e);if(t){var r=Un(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Wn(this,n)}}function Wn(e,t){if(t&&("object"===Bn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Fn(e)}function Fn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Un(e){return(Un=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function zn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Yn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Gn(e,t)}(i,e);var t,n,o,r=Hn(i);function i(e,t){var n,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),zn(Fn(o=r.call(this,"Sch",e)),"paintInfo",void 0),zn(Fn(o),"point",void 0),zn(Fn(o),"toString",(function(){return"CommentsDrawingEngine.Painters.Sch"})),o.paintInfo=t,o.setPoints(),o.onSceneTransform=o.onSceneTransform.bind(Fn(o)),o.point=t.sceneGroup.closest("svg").createSVGPoint(),null===(n=o.paintInfo.sceneGroup.parentElement)||void 0===n||n.addEventListener("didTransformChange",o.onSceneTransform),o}return t=i,(n=[{key:"areaScreenPoint",get:function(){return dn(this.paintInfo.sceneGroup,this.areaPoint.x,this.areaPoint.y,this.point)}},{key:"textScreenPoint",get:function(){return dn(this.paintInfo.sceneGroup,this.textPoint.x,this.textPoint.y,this.point)}},{key:"destroy",value:function(){var e;null===(e=this.paintInfo.sceneGroup.parentElement)||void 0===e||e.removeEventListener("didTransformChange",this.onSceneTransform),Vn(Un(i.prototype),"destroy",this).call(this)}},{key:"zoomToFit",value:function(){var e,t,n,o;if(this.editMode){var r=this.editMode.getBoundRect();if(!r.isInfinite){var i=(null===(e=this.paintInfo)||void 0===e||null===(t=e.workspace)||void 0===t?void 0:t.offsetHeight)||0,a=(null===(n=this.paintInfo)||void 0===n||null===(o=n.workspace)||void 0===o?void 0:o.offsetWidth)||0,u=Math.round(.3*i),s=Math.round(.3*a),f={};r.width>s?(f.x=r.left,f.width=r.width):(f.x=Math.round(r.left-s/2),f.width=s),r.height>u?(f.y=r.top,f.height=r.height):(f.y=Math.round(r.top-u/2),f.height=u);var l=this.dataStore.data;l.TextLeft!==l.TextRight&&l.TextTop!==l.TextBottom&&(f.x=Math.min(f.x,l.TextLeft),f.y=Math.min(f.y,l.TextTop),f.width=Math.max(r.left+r.width,l.TextLeft)-f.x,f.height=Math.max(r.top+r.height,l.TextTop)-f.y),c.bus.emit("SCHView:zoomToFit",{rect:f,changeScale:!0,margin:.6})}}}},{key:"getObservableObject",value:function(){return new hn(this)}},{key:"getIconOverlayView",value:function(){return this.paintInfo.overlayView}},{key:"createTextEditMode",value:function(e){switch(e.type){case"POINT":case"AREA":case"REDLINE":case"OBJECT":return new Sn(e,this.paintInfo)}throw new Error("Method not implemented.")}},{key:"createDrawingEditMode",value:function(e){var t=this;return new _n(e,this.paintInfo.workspace,this.paintInfo.sceneGroup,(function(){return t.emit("DRAWINGS_CHANGED")}))}},{key:"tryMoveIcon",value:function(e){var t=xe(this.paintInfo.sceneGroup,e.x,e.y,this.point);return e.x=t.x,e.y=t.y,!0}},{key:"onSceneTransform",value:function(){this.emit("SCENE_CHANGED")}},{key:"setPoints",value:function(){var e=this.dataStore.data;switch(this.dataStore.type){case"POINT":this.areaPoint.x=.5*(e.AreaLeft+e.AreaRight),this.areaPoint.y=.5*(e.AreaTop+e.AreaBottom);break;case"AREA":case"REDLINE":this.areaPoint.x=e.AreaRight,this.areaPoint.y=e.AreaTop;break;case"OBJECT":var t=this.dataStore.data.ObjectUniqueID,n=this.paintInfo.objects.find((function(e){return e.node.getAttribute("id")===t}));if(n)if(n.kind===wo.Wire||n.kind===wo.Pin)this.areaPoint.x=.5*(e.AreaLeft+e.AreaRight),this.areaPoint.y=.5*(e.AreaTop+e.AreaBottom);else{var o=n.node.getBBox();this.areaPoint.x=o.x+o.width,this.areaPoint.y=o.y}else this.areaPoint.x=e.AreaRight,this.areaPoint.y=e.AreaTop}e.TextLeft!==e.TextRight&&e.TextTop!==e.TextBottom?(this.textPoint.x=e.TextLeft,this.textPoint.y=e.TextTop):(this.textPoint.x=this.areaPoint.x,this.textPoint.y=this.areaPoint.y)}}])&&Ln(t.prototype,n),o&&Ln(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(on);function Xn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function qn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Zn=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),qn(this,"svg",void 0),qn(this,"canvas",void 0),qn(this,"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Sch.UiThreadEditOptions"})),this.svg=t}var t,n,o;return t=e,(n=[{key:"disableCustomDraw",get:function(){return!1}}])&&Xn(t.prototype,n),o&&Xn(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}(),Jn=n(100);function Qn(e){return(Qn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Kn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function eo(){return(eo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=to(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}}).apply(this,arguments)}function to(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ao(e)););return e}function no(e,t){return(no=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function oo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=ao(e);if(t){var r=ao(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return ro(this,n)}}function ro(e,t){if(t&&("object"===Qn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return io(e)}function io(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ao(e){return(ao=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function co(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var uo=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&no(e,t)}(i,e);var t,n,o,r=oo(i);function i(){var e;$n(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return co(io(e=r.call.apply(r,[this].concat(n))),"runnig",!1),co(io(e),"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Sch.ActiveThreadSession"})),e}return t=i,(n=[{key:"run",value:function(e){eo(ao(i.prototype),"run",this).call(this,e),this.runnig=!0,c.bus.emit("SCHView:enableSelection",!1)}},{key:"stop",value:function(){var e=this;this.runnig=!1,eo(ao(i.prototype),"stop",this).call(this),Object(Jn.a)((function(){e.runnig||c.bus.emit("SCHView:enableSelection",!0)}))}}])&&Kn(t.prototype,n),o&&Kn(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(H);function so(e){return(so="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fo(e,t,n,o,r,i,a){try{var c=e[i](a),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(o,r)}function lo(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function po(e,t){return(po=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ho(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=bo(e);if(t){var r=bo(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return yo(this,n)}}function yo(e,t){if(t&&("object"===so(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return vo(e)}function vo(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function bo(e){return(bo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function mo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var wo,go="sch-document-viewer-comment-overlay";!function(e){e[e.FirstObjectID=0]="FirstObjectID",e[e.ClipBoardContainer=1]="ClipBoardContainer",e[e.Note=2]="Note",e[e.Probe=3]="Probe",e[e.Rectangle=4]="Rectangle",e[e.Line=5]="Line",e[e.ConnectionLine=6]="ConnectionLine",e[e.BusEntry=7]="BusEntry",e[e.Arc=8]="Arc",e[e.EllipticalArc=9]="EllipticalArc",e[e.RoundRectangle=10]="RoundRectangle",e[e.Image=11]="Image",e[e.Pie=12]="Pie",e[e.TextFrame=13]="TextFrame",e[e.RichTextDocument=14]="RichTextDocument",e[e.Ellipse=15]="Ellipse",e[e.Junction=16]="Junction",e[e.Polygon=17]="Polygon",e[e.Polyline=18]="Polyline",e[e.Wire=19]="Wire",e[e.Bus=20]="Bus",e[e.Bezier=21]="Bezier",e[e.Label=22]="Label",e[e.Hyperlink=23]="Hyperlink",e[e.NetLabel=24]="NetLabel",e[e.Designator=25]="Designator",e[e.SchComponent=26]="SchComponent",e[e.Parameter=27]="Parameter",e[e.ParameterSet=28]="ParameterSet",e[e.ParameterList=29]="ParameterList",e[e.SheetName=30]="SheetName",e[e.SheetFileName=31]="SheetFileName",e[e.Sheet=32]="Sheet",e[e.SchLib=33]="SchLib",e[e.Symbol=34]="Symbol",e[e.NoERC=35]="NoERC",e[e.ErrorMarker=36]="ErrorMarker",e[e.Pin=37]="Pin",e[e.Port=38]="Port",e[e.PowerObject=39]="PowerObject",e[e.SheetEntry=40]="SheetEntry",e[e.SheetSymbol=41]="SheetSymbol",e[e.Template=42]="Template",e[e.TaskHolder=43]="TaskHolder",e[e.MapDefiner=44]="MapDefiner",e[e.ImplementationMap=45]="ImplementationMap",e[e.Implementation=46]="Implementation",e[e.ImplementationsList=47]="ImplementationsList",e[e.CrossSheetConnector=48]="CrossSheetConnector",e[e.CompileMask=49]="CompileMask",e[e.OpenBusComponent=50]="OpenBusComponent",e[e.OpenBusLink=51]="OpenBusLink",e[e.OpenBusDesignator=52]="OpenBusDesignator",e[e.HarnessConnector=53]="HarnessConnector",e[e.HarnessEntry=54]="HarnessEntry",e[e.HarnessConnectorType=55]="HarnessConnectorType",e[e.SignalHarness=56]="SignalHarness",e[e.OpenBusPort=57]="OpenBusPort",e[e.HighLevelCodeSymbol=58]="HighLevelCodeSymbol",e[e.HighLevelCodeEntry=59]="HighLevelCodeEntry",e[e.OpenBusPinGroup=60]="OpenBusPinGroup",e[e.Blanket=61]="Blanket",e[e.RTFLink=62]="RTFLink",e[e.FSMState=63]="FSMState",e[e.FSMTransition=64]="FSMTransition",e[e.CommentThread=65]="CommentThread",e[e.CommentThreadNote=66]="CommentThreadNote",e[e.FSMNote=67]="FSMNote",e[e.DiagramModule=68]="DiagramModule",e[e.DiagramModuleName=69]="DiagramModuleName",e[e.DiagramModuleSource=70]="DiagramModuleSource",e[e.DiagramConnector=71]="DiagramConnector",e[e.DiagramBlock=72]="DiagramBlock",e[e.DiagramHarness=73]="DiagramHarness",e[e.DiagramHarnessName=74]="DiagramHarnessName",e[e.DiagramHarnessSource=75]="DiagramHarnessSource",e[e.DiagramConnectorLink=76]="DiagramConnectorLink",e[e.DiagramPin=77]="DiagramPin",e[e.LastObjectId=78]="LastObjectId"}(wo||(wo={}));var Eo=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&po(e,t)}(u,e);var t,n,o,r,i,a=ho(u);function u(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),mo(vo(e=a.call(this,"Sch")),"acceptedObjectKinds",new Set([wo.Bus,wo.Pin,wo.Port,wo.PowerObject,wo.Wire,wo.SheetSymbol,wo.SheetEntry,wo.SignalHarness,wo.HarnessEntry,wo.SchComponent])),mo(vo(e),"viewShown",!1),mo(vo(e),"paintInfo",null),mo(vo(e),"documentIds",new Set),mo(vo(e),"primitivesMap",new Map),mo(vo(e),"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Sch"})),e.setupViewDisplayEvents(),e}return t=u,(n=[{key:"test",value:function(e){return"SCH"===(null==e?void 0:e.documentType)||this.documentIds.has(e.data.DocumentUniqueID)}},{key:"createCreationSession",value:function(){if(!this.paintInfo)throw new Error("No paint info to get creation session.");return new je(this.paintInfo)}},{key:"createGraphicsPainter",value:function(e){if(!this.paintInfo)throw new Error("No paint info to create painter.");return new Yn(e,this.paintInfo)}},{key:"createUiThreadEditOptions",value:function(){var e,t;return new Zn(null!==(e=null===(t=this.paintInfo)||void 0===t?void 0:t.sceneGroup.closest("svg"))&&void 0!==e?e:void 0)}},{key:"createActiveThreadSession",value:function(){return new uo}},{key:"viewIsShown",value:function(){return this.viewShown}},{key:"setupMetadata",value:function(){var e,t,n,o=this,r=c.response;return null!=r&&r.metadata?(null===(e=r.metadata.schDocuments)||void 0===e||e.forEach((function(e){return o.documentIds.add(e.id)})),null===(t=r.metadata.components)||void 0===t||t.forEach((function(e){var t;o.addPrimitiveInfo(e,e.kind),null===(t=e.subParts)||void 0===t||t.filter((function(e){return e.schId})).forEach((function(t){return o.addPrimitiveInfo(t.schId,e.kind)}))})),null===(n=r.metadata.primitives)||void 0===n||n.forEach((function(e){return o.addPrimitiveInfo(e,e.kind)})),Promise.resolve()):Promise.resolve()}},{key:"createOverlay",value:function(){var e={},t={id:"",name:""};c.bus.emit("SCHView:documentInfo",t),e.documentId=t.id,e.documentName=t.name;var n=this.workspace;if(!n)throw new Error("Workspace was not found.");e.workspace=n;var o={};c.bus.emit("SCHView:renderDocumentData",o);var r=o.renderDocumentData;e.documentWidth=r.documentWidth,e.documentHeight=r.documentHeight;var i=this.primitivesMap.get(t.id),a="#".concat(t.id,">#DocumentItemsGroup [id]"),u=document.querySelectorAll(a),s=Array.from(u).map((function(e){var t,n=e.getAttribute("id");if(!n)return{node:e,kind:wo.FirstObjectID};var o=null==i||null===(t=i.get(n))||void 0===t?void 0:t.kind;return o?{node:e,kind:o}:{node:e,kind:wo.FirstObjectID}})).filter((function(e){return e.kind!==wo.FirstObjectID})).sort((function(e,t){var n=e.kind===wo.SchComponent?0:1,o=t.kind===wo.SchComponent?0:1;return n<o?-1:n>o?1:0}));e.objects=s;var f=r.overlay;e.sceneGroup=me("g",{"data-owner":"comment-panel"}),f.appendChild(e.sceneGroup);var l=document.getElementById(go);l&&l.remove();var p=new yt(go);p.mount(e.sceneGroup.closest("svg")),p.$el.style.overflow="visible",e.overlayView=p,this.paintInfo=e}},{key:"destroyOverlay",value:function(){var e,t;null===(e=this.paintInfo)||void 0===e||e.sceneGroup.remove(),null===(t=this.paintInfo)||void 0===t||t.overlayView.destroy(),this.paintInfo=null}},{key:"coordXToDocument",value:function(e){return e?Math.round(1e5*e):0}},{key:"coordYToDocument",value:function(e){var t,n,o=null!==(t=null===(n=this.paintInfo)||void 0===n?void 0:n.documentHeight)&&void 0!==t?t:0;return e?Math.round(1e5*(o-e)):0}},{key:"coordXToScene",value:function(e){return Math.round((null!=e?e:0)/1e5)}},{key:"coordYToScene",value:function(e){var t,n,o=null!==(t=null===(n=this.paintInfo)||void 0===n?void 0:n.documentHeight)&&void 0!==t?t:0;return Math.round(o-(null!=e?e:0)/1e5)}},{key:"canBePaint",value:function(e){var t;return"ACTIVE"===this.getState()&&(null===(t=this.paintInfo)||void 0===t?void 0:t.documentId)===e.documentId}},{key:"activateGraphics",value:(r=regeneratorRuntime.mark((function e(t,n,o){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.isViewEnabled()){e.next=4;break}return o(null),e.abrupt("return");case 4:return e.next=6,this.activateView();case 6:return e.next=8,this.activateDocument(t.documentId);case 8:t.expand(),n&&t.zoomToFit(),o(t),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),this.logger.LogError("Activate graphics error.",e.t0),o(null);case 17:case"end":return e.stop()}}),e,this,[[0,13]])})),i=function(){var e=this,t=arguments;return new Promise((function(n,o){var i=r.apply(e,t);function a(e){fo(i,n,o,a,c,"next",e)}function c(e){fo(i,n,o,a,c,"throw",e)}a(void 0)}))},function(e,t,n){return i.apply(this,arguments)})},{key:"isViewEnabled",value:function(){var e=c.views.SCHView;return e&&!e.hidden}},{key:"activateView",value:function(){var e=this;return new Promise((function(t){"ACTIVE"===e.getState()?t():(e.on("ACTIVE",(function n(){e.off("ACTIVE",n),t()})),c.bus.emit("View:set","SCHView"))}))}},{key:"activateDocument",value:function(e){return new Promise((function(t){var n={id:"",name:""};c.bus.emit("SCHView:documentInfo",n),e===n.id?t():(c.bus.on("SCHView:documentChanged",(function e(){c.bus.off("SCHView:documentChanged",e),t()})),c.bus.emit("SCHView:showDocument",e))}))}},{key:"setupViewDisplayEvents",value:function(){var e=this,t=!1,n=!1,o=null;c.bus.on("SCHView:shown",(function(r){o=r,n=!0,t&&(e.viewShown=!0,e.emit("viewShown",o))})),c.bus.on("SCHView:hidden",(function(){n=!1,t&&(e.viewShown=!1,e.emit("viewHidden"))})),c.bus.on("SCHView:documentChanged",(function(r){!t&&n?(e.viewShown=!0,e.emit("viewShown",o)):e.viewShown&&(e.emit("viewHidden"),e.emit("viewShown",o)),t=!0}))}},{key:"addPrimitiveInfo",value:function(e,t){if(e.schDocId&&e.schId){this.primitivesMap.has(e.schDocId)||this.primitivesMap.set(e.schDocId,new Map);var n=t?t>>8&255:0;if(!this.acceptedObjectKinds.has(n))return;var o=this.primitivesMap.get(e.schDocId);if(o){if(o.has(e.schId))return;o.set(e.schId,{kind:n})}}}}])&&lo(t.prototype,n),o&&lo(t,o),Object.defineProperty(t,"prototype",{writable:!1}),u}(ie);function Oo(e){return(Oo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function So(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Io(e,t){return(Io=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Po(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=jo(e);if(t){var r=jo(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return To(this,n)}}function To(e,t){if(t&&("object"===Oo(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ko(e)}function ko(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function jo(e){return(jo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function xo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Do=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Io(e,t)}(c,e);var t,n,r,i=Po(c);function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),xo(ko(t=i.call(this,{name:"PCBDWF",supportedTypes:["AREA","POINT"],workspace:e.workspace})),"rect",void 0),xo(ko(t),"domPoint",void 0),xo(ko(t),"paintInfo",void 0),xo(ko(t),"toString",(function(){return"CommentPanel.CreationSession.PCBDWF"})),t.paintInfo=e,t.on("before",(function(){e.workspace.style.cursor="crosshair"})),t.on("after",(function(){var n;null===(n=t.rect)||void 0===n||n.remove(),e.workspace.style.cursor="auto"})),t.on("drawRect",(function(e){return t.drawRect(e)})),t}return t=c,(n=[{key:"createData",value:function(e){var t={coordType:"scene"};return t.guid=a,t.drawing={Items:[]},t.status=o.Active,t.threadNumber=-1,t.documentName=this.paintInfo.documentName,t.documentType="PCBDWF",t.data={},t.data.DocumentUniqueID=this.paintInfo.documentName,t.data.ObjectUniqueID=this.paintInfo.pageId,t.data.PageUniqueID=this.paintInfo.pageId,t.data.TextLeft=0,t.data.TextTop=0,t.data.TextRight=0,t.data.TextBottom=0,e.width||e.height?(t.type="AREA",this.setRectData(t,e)):(t.type="POINT",this.setPointData(t,e)),Promise.resolve(t)}},{key:"drawRect",value:function(e){this.rect||(this.rect=me("rect",{class:"comment-area-selection-rect",fill:"none",stroke:"#267FEB","stroke-width":"4","stroke-opacity":"0.48","stroke-linecap":"round","stroke-linejoin":"round","vector-effect":"non-scaling-stroke"}),this.paintInfo.sceneGroup.appendChild(this.rect));var t=this.screenToSVG(e.x,e.y,this.paintInfo.sceneGroup.getScreenCTM()),n=this.screenToSVG(e.x+e.width,e.y+e.height,this.paintInfo.sceneGroup.getScreenCTM());this.rect.width.baseVal.value=Math.abs(t.x-n.x),this.rect.height.baseVal.value=Math.abs(t.y-n.y),this.rect.x.baseVal.value=Math.min(t.x,n.x),this.rect.y.baseVal.value=Math.min(t.y,n.y)}},{key:"screenToSVG",value:function(e,t,n){var o,r;this.domPoint=null!==(o=this.domPoint)&&void 0!==o?o:null===(r=this.paintInfo.sceneGroup.closest("svg"))||void 0===r?void 0:r.createSVGPoint(),this.domPoint.x=e,this.domPoint.y=t;var i=n;return this.domPoint.matrixTransform(i.inverse())}},{key:"setPointData",value:function(e,t){var n=this.screenToSVG(t.x,t.y,this.paintInfo.sceneGroup.getScreenCTM());e.data.AreaLeft=Math.round(n.x)+5,e.data.AreaTop=Math.round(n.y)+5,e.data.AreaRight=Math.round(n.x)-5,e.data.AreaBottom=Math.round(n.y)-5}},{key:"setRectData",value:function(e,t){var n=this.screenToSVG(t.x,t.y,this.paintInfo.sceneGroup.getScreenCTM()),o=this.screenToSVG(t.x+t.width,t.y+t.height,this.paintInfo.sceneGroup.getScreenCTM());e.data.AreaLeft=Math.round(n.x),e.data.AreaTop=Math.round(n.y),e.data.AreaRight=Math.round(o.x),e.data.AreaBottom=Math.round(o.y)}}])&&So(t.prototype,n),r&&So(t,r),Object.defineProperty(t,"prototype",{writable:!1}),c}(ve);function Co(e){return(Co="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ro(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ao(e,t){return(Ao=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Mo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Lo(e);if(t){var r=Lo(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return _o(this,n)}}function _o(e,t){if(t&&("object"===Co(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Bo(e)}function Bo(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Lo(e){return(Lo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Vo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var No=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ao(e,t)}(i,e);var t,n,o,r=Mo(i);function i(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),Vo(Bo(n=r.call(this,e.type)),"nodes",[]),Vo(Bo(n),"dataStore",void 0),Vo(Bo(n),"paintInfo",void 0),Vo(Bo(n),"obj",void 0),n.dataStore=e,n.paintInfo=t,n.rectangleFromData(e,t.sceneGroup),n}return t=i,(n=[{key:"getBoundRect",value:function(){var e,t={isInfinite:!1};if(null!==(e=this.obj)&&void 0!==e&&e.node){var n=this.obj.node.getBBox();t.left=n.x,t.top=n.y,t.width=n.width,t.height=n.height}else{var o=this.dataStore.data;t.left=Math.min(o.AreaLeft,o.AreaRight),t.top=Math.min(o.AreaTop,o.AreaBottom),t.width=Math.abs(o.AreaLeft-o.AreaRight),t.height=Math.abs(o.AreaTop-o.AreaBottom)}return t}},{key:"onShow",value:function(){this.nodes.forEach((function(e){return e.setAttribute("display","")}))}},{key:"onHide",value:function(){this.nodes.forEach((function(e){return e.setAttribute("display","none")}))}},{key:"onDestroy",value:function(){this.nodes.forEach((function(e){return e.remove()})),this.nodes=[]}},{key:"setRectangle",value:function(e,t,n){var o=me("rect",{class:"thread-contour","vector-effect":"non-scaling-stroke",display:"none","data-guid":e.guid,fill:"none",stroke:"#267FEB","stroke-width":"4","stroke-opacity":"0.48","stroke-linecap":"round","stroke-linejoin":"round"});if(t.appendChild(o),this.nodes.push(o),n)o.x.baseVal.value=n.x,o.y.baseVal.value=n.y,o.width.baseVal.value=n.width,o.height.baseVal.value=n.height;else{var r=e.data;o.x.baseVal.value=Math.min(r.AreaLeft,r.AreaRight),o.y.baseVal.value=Math.min(r.AreaTop,r.AreaBottom),o.width.baseVal.value=Math.abs(r.AreaLeft-r.AreaRight),o.height.baseVal.value=Math.abs(r.AreaTop-r.AreaBottom)}}},{key:"setWire",value:function(e,t){var n=this;if(e&&e.localName){var o=e.localName;if("g"===o)this.forEveryChild(e,(function(e){return n.setWire(e,t)}));else if("line"===o||"polyline"===o){var r=e.cloneNode(!0);r.hasAttribute("id")&&r.removeAttribute("id");var i=window.getComputedStyle(r)["stroke-width"],a=1;i.match(/^\-?\d+(\.?\d*)px$/)&&(a=parseFloat(i.substring(0,i.length-2))),r.setAttribute("stroke-width","".concat(a+2,"px")),r.style.fill="none",r.style.stroke="#267FEB",r.style.strokeOpacity="0.48",r.style.pointerEvents="none",this.nodes.push(r),t.appendChild(r)}}}},{key:"forEveryChild",value:function(e,t){for(var n=e.children,o=0;o<n.length;o++){var r=n[o];r&&t(r)}}},{key:"rectangleFromData",value:function(e,t){switch(e.type){case"POINT":break;case"AREA":this.setRectangle(e,t);break;case"REDLINE":this.setRectangle(e,t);var n=me("g",{class:"redline-thread-drawing","vector-effect":"non-scaling-stroke",display:"none","data-guid":e.guid,stroke:"rgb(236, 64, 37)","stroke-width":"2px","stroke-opacity":"1",fill:"none"});t.appendChild(n),this.nodes.push(n),this.drawRedline(n,e)}}},{key:"drawRedline",value:function(e,t){var n,o,r,i,a;if(null!==(n=t.data)&&void 0!==n&&null!==(o=n.SerializedData)&&void 0!==o&&o.Vertices){var c=e.closest("svg");null==t||null===(r=t.data)||void 0===r||null===(i=r.SerializedData)||void 0===i||null===(a=i.Vertices)||void 0===a||a.forEach((function(t){if(t){var n=me("polyline",{});t.forEach((function(e,t){if(t){var o=c.createSVGPoint();o.x=e.X,o.y=e.Y,n.points.appendItem(o)}})),e.appendChild(n)}}))}}}])&&Ro(t.prototype,n),o&&Ro(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(Nt);function Go(e){return(Go="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ho(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Wo(){return(Wo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=Fo(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}}).apply(this,arguments)}function Fo(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=qo(e)););return e}function Uo(e,t){return(Uo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function zo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=qo(e);if(t){var r=qo(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Yo(this,n)}}function Yo(e,t){if(t&&("object"===Go(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Xo(e)}function Xo(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function qo(e){return(qo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Zo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Jo=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Uo(e,t)}(i,e);var t,n,o,r=zo(i);function i(e,t){var n,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),Zo(Xo(o=r.call(this,"PCBDWF",e)),"paintInfo",void 0),Zo(Xo(o),"point",void 0),Zo(Xo(o),"toString",(function(){return"CommentPanel.Painters.PCBDWF"})),o.paintInfo=t,o.setPoints(),o.onSceneTransform=o.onSceneTransform.bind(Xo(o)),o.point=t.sceneGroup.closest("svg").createSVGPoint(),null===(n=o.paintInfo.sceneGroup.parentElement)||void 0===n||n.addEventListener("didTransformChange",o.onSceneTransform),o}return t=i,(n=[{key:"areaScreenPoint",get:function(){return dn(this.paintInfo.sceneGroup,this.areaPoint.x,this.areaPoint.y,this.point)}},{key:"textScreenPoint",get:function(){return dn(this.paintInfo.sceneGroup,this.textPoint.x,this.textPoint.y,this.point)}},{key:"destroy",value:function(){var e;null===(e=this.paintInfo.sceneGroup.parentElement)||void 0===e||e.removeEventListener("didTransformChange",this.onSceneTransform),Wo(qo(i.prototype),"destroy",this).call(this)}},{key:"zoomToFit",value:function(){var e,t,n,o;if(this.editMode){var r=this.editMode.getBoundRect();if(!r.isInfinite){var i=(null===(e=this.paintInfo)||void 0===e||null===(t=e.workspace)||void 0===t?void 0:t.offsetHeight)||0,a=(null===(n=this.paintInfo)||void 0===n||null===(o=n.workspace)||void 0===o?void 0:o.offsetWidth)||0,u=Math.round(.3*i),s=Math.round(.3*a),f={};r.width>s?(f.x=r.left,f.width=r.width):(f.x=Math.round(r.left-s/2),f.width=s),r.height>u?(f.y=r.top,f.height=r.height):(f.y=Math.round(r.top-u/2),f.height=u);var l=this.dataStore.data;l.TextLeft!==l.TextRight&&l.TextTop!==l.TextBottom&&(f.x=Math.min(f.x,l.TextLeft),f.y=Math.min(f.y,l.TextTop),f.width=Math.max(r.left+r.width,l.TextLeft)-f.x,f.height=Math.max(r.top+r.height,l.TextTop)-f.y),c.bus.emit("PCBDWFView:zoomToFit",{rect:f,changeScale:!0,margin:.6})}}}},{key:"getObservableObject",value:function(){return new hn(this)}},{key:"getIconOverlayView",value:function(){return this.paintInfo.overlayView}},{key:"createTextEditMode",value:function(e){switch(e.type){case"POINT":case"AREA":case"REDLINE":case"OBJECT":return new No(e,this.paintInfo)}throw new Error("Method not implemented.")}},{key:"createDrawingEditMode",value:function(e){var t=this;return new _n(e,this.paintInfo.workspace,this.paintInfo.sceneGroup,(function(){return t.emit("DRAWINGS_CHANGED")}))}},{key:"tryMoveIcon",value:function(e){var t=xe(this.paintInfo.sceneGroup,e.x,e.y,this.point);return e.x=t.x,e.y=t.y,!0}},{key:"onSceneTransform",value:function(){this.emit("SCENE_CHANGED")}},{key:"setPoints",value:function(){var e=this.dataStore.data;switch(this.dataStore.type){case"POINT":this.areaPoint.x=.5*(e.AreaLeft+e.AreaRight),this.areaPoint.y=.5*(e.AreaTop+e.AreaBottom);break;case"AREA":case"REDLINE":this.areaPoint.x=e.AreaRight,this.areaPoint.y=e.AreaTop}e.TextLeft!==e.TextRight&&e.TextTop!==e.TextBottom?(this.textPoint.x=e.TextLeft,this.textPoint.y=e.TextTop):(this.textPoint.x=this.areaPoint.x,this.textPoint.y=this.areaPoint.y)}}])&&Ho(t.prototype,n),o&&Ho(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(on);function Qo(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function $o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ko=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),$o(this,"svg",void 0),$o(this,"canvas",void 0),$o(this,"toString",(function(){return"CommentPanel.ViewEngines.PCBDWF.UiThreadEditOptions"})),this.svg=t}var t,n,o;return t=e,(n=[{key:"disableCustomDraw",get:function(){return!1}}])&&Qo(t.prototype,n),o&&Qo(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}(),er=n(26);function tr(e){return(tr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function nr(e,t,n,o,r,i,a){try{var c=e[i](a),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(o,r)}function or(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function rr(e,t){return(rr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ir(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=ur(e);if(t){var r=ur(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return ar(this,n)}}function ar(e,t){if(t&&("object"===tr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return cr(e)}function cr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ur(e){return(ur=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function sr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var fr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&rr(e,t)}(u,e);var t,n,o,r,i,a=ir(u);function u(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),sr(cr(e=a.call(this,"PCBDWF")),"viewShown",!1),sr(cr(e),"isEnabled",!1),sr(cr(e),"paintInfo",null),sr(cr(e),"documentIds",new Set),sr(cr(e),"toString",(function(){return"CommentPanel.ViewEngines.PCBDWF"}));var t=er.a.getLicenseDetails(er.a.names.killSwitchDraftsmanComment).isEnabled;return e.isEnabled=t,e.setupViewDisplayEvents(),e}return t=u,(n=[{key:"test",value:function(e){return this.isEnabled&&("PCBDWF"===(null==e?void 0:e.documentType)||this.documentIds.has(e.data.DocumentUniqueID))}},{key:"createCreationSession",value:function(){if(!this.paintInfo)throw new Error("No paint info to get creation session.");return new Do(this.paintInfo)}},{key:"createGraphicsPainter",value:function(e){if(!this.paintInfo)throw new Error("No paint info to create painter.");return new Jo(e,this.paintInfo)}},{key:"createUiThreadEditOptions",value:function(){var e,t;return new Ko(null!==(e=null===(t=this.paintInfo)||void 0===t?void 0:t.sceneGroup.closest("svg"))&&void 0!==e?e:void 0)}},{key:"viewIsShown",value:function(){return this.viewShown}},{key:"createOverlay",value:function(){var e={},t={};c.bus.emit("PCBDWFEngine:documentInfo",t),e.documentId=t.current.uniqueId,e.pageId=t.current.pageId,e.documentName=t.current.name;var n=this.workspace;if(!n)throw new Error("Workspace was not found.");e.workspace=n;var o={};c.bus.emit("PCBDWFEngine:renderDocumentData",o);var r=o.renderDocumentData;if(r){e.documentWidth=r.documentWidth,e.documentHeight=r.documentHeight;var i=r.overlay;e.sceneGroup=me("g",{"data-owner":"comment-panel"}),i.appendChild(e.sceneGroup);var a=document.getElementById("pcbdwf-document-viewer-comment-overlay");a&&a.remove();var u=new yt("pcbdwf-document-viewer-comment-overlay");u.mount(e.sceneGroup.closest("svg")),u.$el.style.overflow="visible",e.overlayView=u,this.paintInfo=e}}},{key:"destroyOverlay",value:function(){var e,t;null===(e=this.paintInfo)||void 0===e||e.sceneGroup.remove(),null===(t=this.paintInfo)||void 0===t||t.overlayView.destroy(),this.paintInfo=null}},{key:"coordXToDocument",value:function(e){return e?Math.round(1e5*e):0}},{key:"coordYToDocument",value:function(e){var t,n,o=null!==(t=null===(n=this.paintInfo)||void 0===n?void 0:n.documentHeight)&&void 0!==t?t:0;return e?Math.round(1e5*(o-e)):0}},{key:"coordXToScene",value:function(e){return Math.round((null!=e?e:0)/1e5)}},{key:"coordYToScene",value:function(e){var t,n,o=null!==(t=null===(n=this.paintInfo)||void 0===n?void 0:n.documentHeight)&&void 0!==t?t:0;return Math.round(o-(null!=e?e:0)/1e5)}},{key:"canBePaint",value:function(e){var t;return"ACTIVE"===this.getState()&&(null===(t=this.paintInfo)||void 0===t?void 0:t.documentId)===e.uniqueId}},{key:"activateGraphics",value:(r=regeneratorRuntime.mark((function e(t,n,o){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.isViewEnabled()){e.next=4;break}return o(null),e.abrupt("return");case 4:return e.next=6,this.activateView();case 6:return e.next=8,this.activateDocument(t.uniqueId);case 8:t.expand(),n&&t.zoomToFit(),o(t),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),this.logger.LogError("Activate graphics error.",e.t0),o(null);case 17:case"end":return e.stop()}}),e,this,[[0,13]])})),i=function(){var e=this,t=arguments;return new Promise((function(n,o){var i=r.apply(e,t);function a(e){nr(i,n,o,a,c,"next",e)}function c(e){nr(i,n,o,a,c,"throw",e)}a(void 0)}))},function(e,t,n){return i.apply(this,arguments)})},{key:"isViewEnabled",value:function(){var e=c.views.PCBDWFView;return e&&!e.hidden}},{key:"activateView",value:function(){var e=this;return new Promise((function(t){"ACTIVE"===e.getState()?t():(e.on("ACTIVE",(function n(){e.off("ACTIVE",n),t()})),c.bus.emit("View:set","PCBDWFView"))}))}},{key:"activateDocument",value:function(e){return new Promise((function(t){var n={current:{id:""}};c.bus.emit("PCBDWFEngine:documentInfo",n),e===n.current.id?t():(c.bus.on("PCBDWFView:documentChanged",(function e(){c.bus.off("PCBDWFView:documentChanged",e),t()})),c.bus.emit("PCBDWFView:showDocument",e))}))}},{key:"setupViewDisplayEvents",value:function(){var e=this,t=!1,n=!1,o=null;c.bus.on("PCBDWFView:shown",(function(r){o=r,n=!0,t&&(e.viewShown=!0,e.emit("viewShown",o))})),c.bus.on("PCBDWFView:hidden",(function(){n=!1,t&&(e.viewShown=!1,e.emit("viewHidden"))})),c.bus.on("PCBDWFView:documentChanged",(function(r){!t&&n?(e.viewShown=!0,e.emit("viewShown",o)):e.viewShown&&(e.emit("viewHidden"),e.emit("viewShown",o)),t=!0}))}}])&&or(t.prototype,n),o&&or(t,o),Object.defineProperty(t,"prototype",{writable:!1}),u}(ie);function lr(e){return(lr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function pr(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function hr(e,t){return(hr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function dr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=br(e);if(t){var r=br(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return yr(this,n)}}function yr(e,t){if(t&&("object"===lr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return vr(e)}function vr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function br(e){return(br=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function mr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var wr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&hr(e,t)}(i,e);var t,n,o,r=dr(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),mr(vr(t=r.call(this)),"viewIsShown",!1),mr(vr(t),"workspace",null),mr(vr(t),"documentId",""),mr(vr(t),"viewName",void 0),mr(vr(t),"hasCustomDrawing",!0),mr(vr(t),"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Pcb.BaseState"})),t.viewName=e,t.setupViewDisplayEvents(e),t}return t=i,(n=[{key:"setupViewDisplayEvents",value:function(e){var t=this,n=!1,o=!1;c.bus.on(e+":shown",(function(e){t.workspace=e,o=!0,n&&(t.viewIsShown=!0,t.emit("VIEW_SHOWN",t))})),c.bus.on(e+":hidden",(function(){o=!1,n&&(t.viewIsShown=!1,t.emit("VIEW_HIDDEN"))})),c.bus.on("PcbEngine:didDocumentAttach",(function(e){!n&&o?(t.viewIsShown=!0,t.documentId=e,t.emit("VIEW_SHOWN",t)):t.viewIsShown?(t.emit("VIEW_HIDDEN"),t.documentId=e,t.emit("VIEW_SHOWN",t)):(t.documentId=e,n=!0)}))}}])&&pr(t.prototype,n),o&&pr(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(j.a),gr=n(7),Er=function(e){return 255&e.kind};function Or(e){return(Or="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Sr(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ir(e,t){return(Ir=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Pr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=jr(e);if(t){var r=jr(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Tr(this,n)}}function Tr(e,t){if(t&&("object"===Or(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return kr(e)}function kr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function jr(e){return(jr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function xr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Dr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ir(e,t)}(u,e);var t,n,r,i=Pr(u);function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),xr(kr(t=i.call(this,{name:"Pcb2D",supportedTypes:["OBJECT","AREA","POINT"],workspace:e.workspace})),"nodeItem",null),xr(kr(t),"paintInfo",void 0),xr(kr(t),"s_currentObject",null),xr(kr(t),"toString",(function(){return"CommentsDrawingEngine.CreationSession.Pcb2D"})),t.paintInfo=e,t.on("before",(function(){e.workspace.style.cursor="crosshair"})),t.on("after",(function(){e.workspace.style.cursor="auto",t.cancelled&&c.bus.emit("PcbEngine:enableSelection",!0),t.setNodeItem(null)})),t.on("drawRect",(function(e){var n=t.scene.viewportToWorld([e.x,e.y]),o=t.scene.viewportToWorld([e.x+e.width,e.y+e.height]),r={left:n[0],top:n[1],right:o[0],bottom:o[1]},i=t.draw({boundBox:r,primitive:null});t.setNodeItem(i)})),t}return t=u,(n=[{key:"scene",get:function(){return this.paintInfo.scene}},{key:"currentObject",get:function(){return this.s_currentObject},set:function(e){this.s_currentObject!=e&&(this.s_currentObject=e,null===e?this.setNodeItem(null):this.setNodeItem(this.draw(e)))}},{key:"startHighlight",value:function(e){var t=this.findTargetInfoByPoint(e.x,e.y);t?this.currentObject&&this.currentObject.primitive!==t.primitive?(this.paintInfo.workspace.style.cursor="pointer",this.currentObject=t):this.currentObject||(this.paintInfo.workspace.style.cursor="pointer",this.currentObject=t):(this.paintInfo.workspace.style.cursor="crosshair",this.currentObject=null)}},{key:"stopHighlight",value:function(){this.paintInfo.workspace.style.cursor="crosshair",this.currentObject=null}},{key:"createData",value:function(e){var t={coordType:"scene"};if(t.guid=a,t.drawing={Items:[]},t.status=o.Active,t.threadNumber=-1,t.documentName=this.paintInfo.documentName,t.documentType="PCB",t.data={},t.data.DocumentUniqueID=this.paintInfo.documentId,t.data.TextLeft=0,t.data.TextTop=0,t.data.TextRight=0,t.data.TextBottom=0,this.currentObject){t.sceneNodeId=this.currentObject.primitive.pcbId,t.objectType=we($a,Er(this.currentObject.primitive));var n=this.currentObject.primitive.pcbUniqueId;if(n){t.type="OBJECT",t.data.ObjectUniqueID=n;var r=this.currentObject.boundBox;r?(t.data.AreaLeft=r.left,t.data.AreaTop=r.top,t.data.AreaRight=r.right,t.data.AreaBottom=r.bottom):this.setPointData(t,e)}else t.type="POINT",this.setPointData(t,e)}else e.width||e.height?(t.type="AREA",this.setRectData(t,e)):(t.type="POINT",this.setPointData(t,e));return Promise.resolve(t)}},{key:"setNodeItem",value:function(e){this.nodeItem&&this.scene.removeItem(this.nodeItem),this.nodeItem=e,this.paintInfo.renderer.invalidate()}},{key:"draw",value:function(e){try{var t=e.primitive;if(null!=t&&t.pcbId&&Er(t)!=$a.Component){var n=this.scene.getNodeItemById(t.pcbId);if(n)return this.scene.cloneNodeItemToLayer(n,this.paintInfo.layerId,this.paintInfo.materialId,0)}if(e.boundBox){for(var o,r=e.boundBox,i=[[r.left,r.top,0],[r.right,r.top,0],[r.right,r.bottom,0],[r.left,r.bottom,0],[r.left,r.top,0]],a=[],c=0;c<i.length-1;c++){var u=i[c],s=i[c+1];a.push({from:u,to:s,color:this.paintInfo.materialColor,width:4,dash:0})}var f=new gr.NodeContainer;return(o=f.lines).push.apply(o,a),this.scene.addNode(this.paintInfo.layerId,f)}return null}catch(e){return null}}},{key:"setPointData",value:function(e,t){var n=this.scene.viewportToWorld([t.x,t.y]);e.data.AreaLeft=n[0]+5,e.data.AreaTop=n[1]+5,e.data.AreaRight=n[0]-5,e.data.AreaBottom=n[1]-5}},{key:"setRectData",value:function(e,t){var n=this.scene.viewportToWorld([t.x,t.y]),o=this.scene.viewportToWorld([t.x+t.width,t.y+t.height]);e.data.AreaLeft=n[0],e.data.AreaTop=n[1],e.data.AreaRight=o[0],e.data.AreaBottom=o[1]}},{key:"findTargetInfoByPoint",value:function(e,t){var n,o,r,i=this,a=null===(n=this.paintInfo.layerManager)||void 0===n||null===(o=n.getLayers())||void 0===o?void 0:o.filter((function(e){return e.isVisible||"Multi-Layer"===e.searchName}));if(!a)return null;var c=this.scene.viewportToWorld([e,t]);if(!c)return null;var u=[];this.paintInfo.metadata.components.forEach((function(e){a.find((function(t){return t.metaId===e.layerId}))&&e.boundRect&&i.pointInRectangle(c[0],c[1],e.boundRect)&&u.push({primitive:e,node:null})})),null===(r=this.scene.getNodeItemsAtPoint(c,a.map((function(e){return e.id}))))||void 0===r||r.forEach((function(e){var t=i.paintInfo.metadata.primitives.get(e.GetId());t&&u.push({primitive:t,node:e})}));var s=this.scene.flipped;return u.length?(u.sort((function(e,t){return s?i.getStackIndex(t,a)-i.getStackIndex(e,a):i.getStackIndex(e,a)-i.getStackIndex(t,a)})),{primitive:u[0].primitive,boundBox:this.getBoundBox(u[0])}):null}},{key:"getBoundBox",value:function(e){if(e.primitive.boundRect){var t=e.primitive.boundRect;return{left:t[0]/1e6,top:t[3]/1e6,right:t[2]/1e6,bottom:t[1]/1e6}}if(e.node){var n=this.scene.getBoundingBoxForItem(e.node);if(n)return{left:Math.min(n[0],n[3]),top:Math.max(n[1],n[4]),right:Math.max(n[0],n[3]),bottom:Math.min(n[1],n[4])}}return null}},{key:"pointInRectangle",value:function(e,t,n){return e>=n[0]/1e6&&e<=n[2]/1e6&&t>=n[1]/1e6&&t<=n[3]/1e6}},{key:"getStackIndex",value:function(e,t){var n=t.find((function(t){return t.metaId===e.primitive.layerId}));return n?1e4*n.stackIndex+this.getPrimitiveStackIndex(e.primitive):Number.MAX_VALUE}},{key:"getPrimitiveStackIndex",value:function(e){var t=255&e.kind;return t===$a.Pad?99:t===$a.Component?100:t}}])&&Sr(t.prototype,n),r&&Sr(t,r),Object.defineProperty(t,"prototype",{writable:!1}),u}(ve);function Cr(e){return(Cr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Rr(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ar(e,t){return(Ar=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Mr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Lr(e);if(t){var r=Lr(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return _r(this,n)}}function _r(e,t){if(t&&("object"===Cr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Br(e)}function Br(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Lr(e){return(Lr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Vr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Nr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ar(e,t)}(i,e);var t,n,o,r=Mr(i);function i(e,t,n){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),Vr(Br(o=r.call(this,null!=n?n:"GerberText")),"nodes",[]),Vr(Br(o),"dataStore",void 0),Vr(Br(o),"paintInfo",void 0),Vr(Br(o),"toString",(function(){return"CommentsDrawingEngine.Painters.EditModes.GerberText"})),o.dataStore=e,o.paintInfo=t,o}return t=i,(n=[{key:"getBoundRect",value:function(){var e={isInfinite:!1},t=this.dataStore.data;return e.left=Math.min(t.AreaLeft,t.AreaRight),e.top=Math.max(t.AreaTop,t.AreaBottom),e.width=Math.abs(t.AreaLeft-t.AreaRight),e.height=Math.abs(t.AreaTop-t.AreaBottom),e}},{key:"onShow",value:function(){this.draw()}},{key:"onHide",value:function(){this.clear()}},{key:"onDestroy",value:function(){this.clear()}},{key:"draw",value:function(){switch(this.dataStore.type){case"AREA":case"REDLINE":this.drawRect()}this.paintInfo.renderer.invalidate()}},{key:"drawRect",value:function(){for(var e,t=this.dataStore.data,n=[[t.AreaLeft,t.AreaTop,0],[t.AreaRight,t.AreaTop,0],[t.AreaRight,t.AreaBottom,0],[t.AreaLeft,t.AreaBottom,0],[t.AreaLeft,t.AreaTop,0]],o=[],r=0;r<n.length-1;r++){var i=n[r],a=n[r+1];o.push({from:i,to:a,color:this.paintInfo.materialColor,width:4,dash:0})}var c=new gr.NodeContainer;(e=c.lines).push.apply(e,o);var u=this.paintInfo.scene.addNode(this.paintInfo.layerId,c);u&&this.nodes.push(u)}},{key:"clear",value:function(){var e=this;this.nodes.filter((function(e){return e})).forEach((function(t){return e.paintInfo.scene.removeItem(t)})),this.nodes=[],this.paintInfo.renderer.invalidate()}}])&&Rr(t.prototype,n),o&&Rr(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(Nt);function Gr(e){return(Gr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Hr(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Wr(e,t){return(Wr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Fr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Yr(e);if(t){var r=Yr(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Ur(this,n)}}function Ur(e,t){if(t&&("object"===Gr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return zr(e)}function zr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Yr(e){return(Yr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Xr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var qr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Wr(e,t)}(i,e);var t,n,o,r=Fr(i);function i(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),Xr(zr(n=r.call(this,e,t,"Pcb2DText")),"dataStore",void 0),Xr(zr(n),"paintInfo",void 0),Xr(zr(n),"toString",(function(){return"CommentsDrawingEngine.Painters.EditModes.Pcb2DText"})),n.dataStore=e,n.paintInfo=t,n}return t=i,(n=[{key:"draw",value:function(){switch(this.dataStore.type){case"OBJECT":var e=this.dataStore.data.ObjectUniqueID,t=this.paintInfo.metadata.primitivesByUniqueId.get(e);if(t)if(Er(t)===$a.Component){var n=t;n.boundBox&&(this.dataStore.data.AreaLeft=n.boundBox[0],this.dataStore.data.AreaTop=n.boundBox[1],this.dataStore.data.AreaRight=n.boundBox[2],this.dataStore.data.AreaBottom=n.boundBox[3]),this.drawRect()}else this.drawNode(t.pcbId);else this.drawRect();break;case"POINT":this.drawNode(this.dataStore.sceneNodeId);break;case"AREA":case"REDLINE":this.drawRect()}this.paintInfo.renderer.invalidate()}},{key:"drawNode",value:function(e){if(e){var t=this.paintInfo.scene.getNodeItemById(e);if(t){var n=this.paintInfo.scene.cloneNodeItemToLayer(t,this.paintInfo.layerId,this.paintInfo.materialId,0);n&&this.nodes.push(n)}}}}])&&Hr(t.prototype,n),o&&Hr(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(Nr);function Zr(e){return(Zr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Jr(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Qr(e,t){return(Qr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function $r(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=ti(e);if(t){var r=ti(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Kr(this,n)}}function Kr(e,t){if(t&&("object"===Zr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ei(e)}function ei(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ti(e){return(ti=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ni=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Qr(e,t)}(i,e);var t,n,o,r=$r(i);function i(e,t,n,o){var a,c,u,s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),a=r.call(this,e,t,n,o,"PcbOverlayDrawing"),c=ei(a),s=function(){return"CommentsDrawingEngine.Painters.EditModes.PcbOverlayDrawing"},(u="toString")in c?Object.defineProperty(c,u,{value:s,enumerable:!0,configurable:!0,writable:!0}):c[u]=s,a}return t=i,(n=[{key:"xPrecision",get:function(){return 100}},{key:"yPrecision",get:function(){return-100}}])&&Jr(t.prototype,n),o&&Jr(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(Mn);function oi(e){return(oi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ri(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function ii(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function ai(){return(ai="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=ci(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}}).apply(this,arguments)}function ci(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=pi(e)););return e}function ui(e,t){return(ui=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function si(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=pi(e);if(t){var r=pi(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return fi(this,n)}}function fi(e,t){if(t&&("object"===oi(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return li(e)}function li(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function pi(e){return(pi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function hi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var di=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ui(e,t)}(i,e);var t,n,o,r=si(i);function i(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),hi(li(n=r.call(this,"Pcb2D",e)),"paintInfo",void 0),hi(li(n),"toString",(function(){return"CommentsDrawingEngine.Painters.Pcb2D"})),n.paintInfo=t,n.setPoints(),n.onSceneTransform=n.onSceneTransform.bind(li(n)),n.paintInfo.renderer.on("transformScene",n.onSceneTransform),n}return t=i,(n=[{key:"areaScreenPoint",get:function(){var e=this.paintInfo.scene.worldToViewport([this.areaPoint.x,this.areaPoint.y]);return{x:e[0],y:e[1]}}},{key:"textScreenPoint",get:function(){var e=this.paintInfo.scene.worldToViewport([this.textPoint.x,this.textPoint.y]);return{x:e[0],y:e[1]}}},{key:"destroy",value:function(){this.paintInfo.renderer.off("transformScene",this.onSceneTransform),ai(pi(i.prototype),"destroy",this).call(this)}},{key:"zoomToFit",value:function(){if(this.editMode){var e=this.editMode.getBoundRect();if(!e.isInfinite){var t=this.dataStore.data,n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ri(Object(n),!0).forEach((function(t){hi(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ri(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e),o=n.left,r=n.top,i=n.left+n.width,a=n.top-n.width;t.TextLeft!==t.TextRight&&t.TextTop!==t.TextBottom&&(o=Math.min(o,t.TextLeft),i=Math.max(i,t.TextLeft),r=Math.max(r,t.TextTop),a=Math.min(a,t.TextTop)),this.paintInfo.scene.zoomToFit([o,a,0],[i,r,0],.6,.3)}}}},{key:"getObservableObject",value:function(){return new hn(this)}},{key:"getIconOverlayView",value:function(){return this.paintInfo.overlayView}},{key:"createTextEditMode",value:function(e){switch(e.type){case"POINT":case"AREA":case"OBJECT":return new qr(e,this.paintInfo)}throw new Error("Method not implemented for type ".concat(e.type,"."))}},{key:"createDrawingEditMode",value:function(e){var t=this;return new ni(e,this.paintInfo.workspace,this.paintInfo.sceneGroup,(function(){return t.emit("DRAWINGS_CHANGED")}))}},{key:"tryMoveIcon",value:function(e){var t=this.paintInfo.scene.viewportToWorld([e.x,e.y]);return e.x=t[0],e.y=t[1],!0}},{key:"onSceneTransform",value:function(){this.emit("SCENE_CHANGED")}},{key:"setPoints",value:function(){var e=this.dataStore.data;switch(this.dataStore.type){case"POINT":this.areaPoint.x=.5*(e.AreaLeft+e.AreaRight),this.areaPoint.y=.5*(e.AreaTop+e.AreaBottom);break;case"AREA":case"REDLINE":this.areaPoint.x=e.AreaRight,this.areaPoint.y=e.AreaTop;break;case"OBJECT":var t=this.dataStore.data.ObjectUniqueID,n=this.paintInfo.metadata.primitivesByUniqueId.get(t);if(n)if(Er(n)===$a.Component){var o=n;o.boundBox?(this.areaPoint.x=o.boundBox[2]/1e6,this.areaPoint.y=o.boundBox[1]/1e6):(this.areaPoint.x=e.AreaRight,this.areaPoint.y=e.AreaTop)}else this.areaPoint.x=.5*(e.AreaLeft+e.AreaRight),this.areaPoint.y=.5*(e.AreaTop+e.AreaBottom);else this.areaPoint.x=e.AreaRight,this.areaPoint.y=e.AreaTop}e.TextLeft!==e.TextRight&&e.TextTop!==e.TextBottom?(this.textPoint.x=e.TextLeft,this.textPoint.y=e.TextTop):(this.textPoint.x=this.areaPoint.x,this.textPoint.y=this.areaPoint.y)}}])&&ii(t.prototype,n),o&&ii(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(on),yi=n(132),vi=n(308);function bi(e){return(bi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function mi(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function wi(e,t){return(wi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function gi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Si(e);if(t){var r=Si(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Ei(this,n)}}function Ei(e,t){if(t&&("object"===bi(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Oi(e)}function Oi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Si(e){return(Si=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ii(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Pi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&wi(e,t)}(i,e);var t,n,o,r=gi(i);function i(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),Ii(Oi(e=r.call(this,"PCBView")),"paintInfo",null),Ii(Oi(e),"metadata",new Map),Ii(Oi(e),"materialId",0),Ii(Oi(e),"scene",void 0),Ii(Oi(e),"acceptedPrimitivesToSelect",new Set([$a.Arc,$a.Via,$a.Track,$a.Pad,$a.Component])),Ii(Oi(e),"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Pcb.2DState"})),c.bus.on("GraphiteEngine:createdScene2D",(function(t){e.scene=t;e.materialId=t.addMaterial(new yi.a([38,127,235,225],vi.a.None))})),e}return t=i,(n=[{key:"svg",get:function(){var e,t;return null!==(e=null===(t=this.paintInfo)||void 0===t?void 0:t.sceneGroup.closest("svg"))&&void 0!==e?e:void 0}},{key:"canvas",get:function(){var e,t;return null!==(e=null===(t=this.paintInfo)||void 0===t?void 0:t.canvas)&&void 0!==e?e:void 0}},{key:"setupDocumentMetadata",value:function(e,t){var n,o,r,i=this,a={};a.components=null!==(n=null===(o=t.components)||void 0===o?void 0:o.filter((function(e){return e.pcbId})))&&void 0!==n?n:[],a.primitivesByUniqueId=new Map,a.components.forEach((function(e){return e.pcbUniqueId&&a.primitivesByUniqueId.set(e.pcbUniqueId,e)}));var c=new Map;null===(r=t.primitives)||void 0===r||r.forEach((function(e){e.pcbId&&i.acceptedPrimitivesToSelect.has(Er(e))&&(c.set(e.pcbId,e),e.pcbUniqueId&&a.primitivesByUniqueId.set(e.pcbUniqueId,e))})),a.primitives=c,this.metadata.set(e,a)}},{key:"createOverlay",value:function(){var e,t,n={},o={id:"",name:""};c.bus.emit("PCBView:documentInfo",o),n.documentId=o.id,n.documentName=o.name,n.metadata=null!==(e=this.metadata.get(n.documentId))&&void 0!==e?e:{components:[],primitives:new Map,primitivesByUniqueId:new Map},n.layerManager=c.engines.PcbEngine.layerManager;var r=this.workspace;if(!r)throw new Error("Workspace was not found.");n.workspace=r;var i=r.querySelector("canvas");if(!i)throw new Error("Canvas was not found.");n.canvas=i;var a={renderDocumentData:null};c.bus.emit("PcbEngine:renderDocumentData",a);var u=a.renderDocumentData,s=u.overlay;n.sceneGroup=null!==(t=s.querySelector("#pcb2d-overlay-scene-for-comments"))&&void 0!==t?t:me("g",{"data-owner":"comment-panel",id:"gerber-overlay-scene-for-comments"}),s.appendChild(n.sceneGroup);var f=document.getElementById("pcb2d-document-viewer-comment-overlay");f&&f.remove();var l=new yt("pcb2d-document-viewer-comment-overlay");l.mount(u.overlay.parentElement),n.overlayView=l,n.renderer=u.renderer,n.scene=this.scene,n.layerId=n.scene.layerMap.GetLayersCount()-1,n.materialColor=[38,127,235,225],n.materialId=this.materialId,this.paintInfo=n}},{key:"destoyOverlay",value:function(){var e=this.paintInfo;e&&(e.sceneGroup.remove(),e.overlayView.destroy()),this.paintInfo=null}},{key:"createCreationSession",value:function(){if(!this.paintInfo)throw new Error("No paint info to get creation session.");return new Dr(this.paintInfo)}},{key:"createGraphicsPainter",value:function(e){if(!this.paintInfo)throw new Error("No paint info to get painter.");return new di(e,this.paintInfo)}},{key:"canBePaint",value:function(){return!0}}])&&mi(t.prototype,n),o&&mi(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(wr);function Ti(e,t){var n=window.vec3.create(),o=window.vec3.create(),r=function(e){return window.vec3.set(n,e[0],e[1],e[2])},i=function(e){return window.vec3.set(o,e[3],e[4],e[5])},a=!1,c=window.vec3.create(),u=window.vec3.create();return t.filter((function(e){return e})).forEach((function(t){var s=e.getBoundingBoxForItem(t);s&&(a?(window.vec3.min(c,c,window.vec3.min(n,r(s),i(s))),window.vec3.max(u,u,window.vec3.max(o,r(s),i(s)))):(a=!0,window.vec3.min(c,r(s),i(s)),window.vec3.max(u,r(s),i(s))))})),[c,u]}function ki(e){return(ki="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ji(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var o,r,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(o=n.next()).done)&&(i.push(o.value),!t||i.length!==t);a=!0);}catch(e){c=!0,r=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw r}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return xi(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return xi(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xi(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function Di(e,t,n,o,r,i,a){try{var c=e[i](a),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(o,r)}function Ci(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ri(e,t){return(Ri=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ai(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Bi(e);if(t){var r=Bi(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Mi(this,n)}}function Mi(e,t){if(t&&("object"===ki(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _i(e)}function _i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Bi(e){return(Bi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Li(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Vi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ri(e,t)}(f,e);var t,n,r,i,u,s=Ai(f);function f(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),Li(_i(t=s.call(this,{name:"Pcb3D",supportedTypes:["OBJECT","POINT"],workspace:e.workspace})),"paintInfo",void 0),Li(_i(t),"toString",(function(){return"CommentsDrawingEngine.CreationSession.Pcb3D"})),t.paintInfo=e,t.on("before",(function(){e.workspace.style.cursor="crosshair",c.bus.emit("PcbEngine:enableSelection",!1)})),t.on("after",(function(){e.workspace.style.cursor="auto",t.cancelled&&c.bus.emit("PcbEngine:enableSelection",!0)})),t}return t=f,(n=[{key:"doStopBubble",value:function(e){return!1}},{key:"createData",value:(i=regeneratorRuntime.mark((function e(t){var n,r,i,c,u,s,f,l,p,h,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.width&&!t.height){e.next=2;break}return e.abrupt("return",Promise.resolve(null));case 2:if(null!==(n=this.findTargetByScreenPoint(t.x,t.y))){e.next=5;break}return e.abrupt("return",Promise.resolve(null));case 5:if((r={}).coordType="scene",r.guid=a,r.drawing={Items:[]},r.status=o.Active,r.threadNumber=-1,r.documentName=this.paintInfo.documentName,r.documentType="PCB3D",r.data={},r.data.DocumentUniqueID=this.paintInfo.documentId,r.data.TextLeft=0,r.data.TextTop=0,r.data.TextRight=0,r.data.TextBottom=0,!n.primitives.length){e.next=30;break}return e.next=22,this.paintInfo.selectionSession.draw(n.primitives);case 22:u=e.sent,s=Ti(this.paintInfo.scene,u),f=ji(s,2),i=f[0],c=f[1],r.objectType=we($a,n.kind),e.next=36;break;case 30:if(l=this.paintInfo.scene.getNodeItemById(n.sceneId)){e.next=33;break}return e.abrupt("return",Promise.resolve(null));case 33:p=this.paintInfo.scene.getBoundingBoxForItem(l),i=this.paintInfo.scene.viewportIntersectWithZ([t.x,t.y],p[2]),c=this.paintInfo.scene.viewportIntersectWithZ([t.x,t.y],p[5]);case 36:return n.documentId?(r.type="OBJECT",r.data.ObjectUniqueID=n.documentId,r.data.AreaLeft=i[0],r.data.AreaTop=c[1],r.data.AreaRight=c[0],r.data.AreaBottom=i[1]):(h=(i[0]+c[0])/2,d=(i[1]+c[1])/2,r.type="POINT",r.data.AreaLeft=h-5,r.data.AreaTop=d+5,r.data.AreaRight=h+5,r.data.AreaBottom=d-5),r.sceneNodeId=n.sceneId,e.abrupt("return",Promise.resolve(r));case 39:case"end":return e.stop()}}),e,this)})),u=function(){var e=this,t=arguments;return new Promise((function(n,o){var r=i.apply(e,t);function a(e){Di(r,n,o,a,c,"next",e)}function c(e){Di(r,n,o,a,c,"throw",e)}a(void 0)}))},function(e){return u.apply(this,arguments)})},{key:"findTargetByScreenPoint",value:function(e,t){var n=this.paintInfo.scene.unproject([e,t]);if(n){var o=this.firstItemIdByRay(n);if(o){var r,i=this.paintInfo.metadata.primitivesBySceneId.get(o);if(i)return{sceneId:o,documentId:i.pcbUniqueId,kind:Er(i),primitives:[i]};var a=this.paintInfo.metadata.componentsBySceneId.get(o);return a?{sceneId:a.pcbId,documentId:a.pcbUniqueId,kind:Er(a),primitives:null!==(r=this.paintInfo.metadata.components.get(a))&&void 0!==r?r:[]}:{sceneId:o,documentId:"",kind:$a.No,primitives:[]}}}return null}},{key:"firstItemIdByRay",value:function(e){var t=window.vec4.create(),n=this.paintInfo.scene.getEye();window.vec3.sub(t,e,n),window.vec3.normalize(t,t);var o=this.paintInfo.scene.getNodeItemsAtRay(n,t);if(o&&o.length)for(var r=0;r<o.length;r++){var i=o[r];if(this.is3DItemDisplayed(i))return i.GetId()}return null}},{key:"is3DItemDisplayed",value:function(e){if(!e)return!1;if(e.GetMeshesCount()>0)return!0;for(var t=e.GetLayersCount(),n=0;n<t;n++){var o=e.GetLayerGeometry(n);if(o){var r=this.paintInfo.scene.layerMap.GetLayer(o.GetLayerIndex());if(null!=r&&r.show3d)return!0}}return!1}}])&&Ci(t.prototype,n),r&&Ci(t,r),Object.defineProperty(t,"prototype",{writable:!1}),f}(ve),Ni=n(108);function Gi(e){return(Gi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Hi(e,t,n,o,r,i,a){try{var c=e[i](a),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(o,r)}function Wi(e){return function(){var t=this,n=arguments;return new Promise((function(o,r){var i=e.apply(t,n);function a(e){Hi(i,o,r,a,c,"next",e)}function c(e){Hi(i,o,r,a,c,"throw",e)}a(void 0)}))}}function Fi(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ui(){return(Ui="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=zi(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}}).apply(this,arguments)}function zi(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ji(e)););return e}function Yi(e,t){return(Yi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Xi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Ji(e);if(t){var r=Ji(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return qi(this,n)}}function qi(e,t){if(t&&("object"===Gi(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Zi(e)}function Zi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ji(e){return(Ji=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Qi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var $i={where:function(e){return["READY"===e.type]},to:"READY"},Ki={where:function(e){return["DRAW"===e.type]},to:"DRAW"},ea={where:function(e){return["CLEAR"===e.type]},to:"CLEAR"},ta={where:function(e){return["COMPLETE"===e.type]},to:"COMPLETE"},na={IDLE:[$i,Ki],READY:[Ki],DRAW:[$i,{where:function(e){return["BREAK"===e.type]},to:"BREAK"},ea,ta],BREAK:[ta],COMPLETE:[ea],CLEAR:[$i]},oa=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Yi(e,t)}(s,e);var t,n,o,r,i,a,u=Xi(s);function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),Qi(Zi(t=u.call(this,"IDLE",na)),"renderer",void 0),Qi(Zi(t),"currentVariant",null),Qi(Zi(t),"logger",void 0),t.renderer=e,t.logger=c.createLogger("CP_PcbDrawSelectionSession"),t.on("READY",(function(){return t.logger.LogDebug("READY")})),t.on("DRAW",(function(){return t.logger.LogDebug("DRAW")})),t.on("BREAK",(function(){return t.logger.LogDebug("BREAK")})),t.on("COMPLETE",(function(){return t.logger.LogDebug("COMPLETE")})),t.on("CLEAR",(function(){return t.logger.LogDebug("CLEAR")})),t.doDraw=t.doDraw.bind(Zi(t)),t.doClear=t.doClear.bind(Zi(t)),t.on("DRAW",t.doDraw),t.on("CLEAR",t.doClear),t.onVariantChanged=t.onVariantChanged.bind(Zi(t)),c.bus.on("Variants:changed",t.onVariantChanged),t.dispatch({type:"READY"}),t}return t=s,(n=[{key:"selected",get:function(){return"COMPLETE"===this.state}},{key:"draw",value:(a=Wi(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.gotoReady(!0);case 2:return e.next=4,new Promise((function(e,o){n.dispatch({type:"DRAW",resolve:e,reject:o,primitives:t})}));case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"clear",value:(i=Wi(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.gotoReady(!0);case 2:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"destoy",value:function(){c.bus.off("Variants:changed",this.onVariantChanged),this.clear()}},{key:"dispatch",value:function(e){return Ui(Ji(s.prototype),"dispatch",this).call(this,e)}},{key:"gotoReady",value:function(e){var t=this;return new Promise((function(n){"READY"===t.state?Object(Jn.a)((function(){return n()})):(t.on("READY",(function e(){t.off("READY",e),setTimeout((function(){return n()}),0)})),"DRAW"===t.state&&(t.on("COMPLETE",(function n(){t.off("COMPLETE",n),Object(Jn.a)((function(){return t.dispatch({type:"CLEAR",deselect:e})}))})),t.dispatch({type:"BREAK"})),"COMPLETE"===t.state&&t.dispatch({type:"CLEAR",deselect:e}))}))}},{key:"doClear",value:function(e){var t=this;try{e.deselect&&this.renderer.setSelected(!1),this.renderer.clearSelection(e.deselect)}catch(e){this.logger.LogError("Clear error.",e)}Object(Jn.a)((function(){return t.dispatch({type:"READY"})}))}},{key:"doDraw",value:(r=Wi(regeneratorRuntime.mark((function e(t){var n,o,r,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Ni.b,o=function e(){Object(Jn.a)((function(){return n.isCancellationRequested=!0})),i.off("BREAK",e)},this.on("BREAK",o),e.prev=3,this.renderer.setSelected(!0),e.next=7,this.renderer.addSelection(t.primitives,n);case 7:r=e.sent,this.dispatch({type:"COMPLETE"}),t.resolve(r),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(3),e.t0 instanceof Ni.a?(Object(Jn.a)((function(){return i.dispatch({type:"COMPLETE"})})),t.resolve()):(Object(Jn.a)((function(){return i.dispatch({type:"CLEAR",deselect:!0})})),t.reject(e.t0));case 15:return e.prev=15,this.off("BREAK",o),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[3,12,15,18]])}))),function(e){return r.apply(this,arguments)})},{key:"onVariantChanged",value:function(e){this.currentVariant=null==e?void 0:e.projectVariant}}])&&Fi(t.prototype,n),o&&Fi(t,o),Object.defineProperty(t,"prototype",{writable:!1}),s}(u.a);function ra(e){return(ra="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ia(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function aa(e,t){return(aa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ca(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=fa(e);if(t){var r=fa(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return ua(this,n)}}function ua(e,t){if(t&&("object"===ra(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return sa(e)}function sa(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fa(e){return(fa=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function la(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var pa=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&aa(e,t)}(i,e);var t,n,o,r=ca(i);function i(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),la(sa(n=r.call(this,"Pcb3DText")),"dataStore",void 0),la(sa(n),"paintInfo",void 0),la(sa(n),"toString",(function(){return"CommentsDrawingEngine.Painters.EditModes.Pcb3DText"})),n.dataStore=e,n.paintInfo=t,n}return t=i,(n=[{key:"getBoundRect",value:function(){throw new Error("Method not implemented.")}},{key:"onShow",value:function(){if(!this.paintInfo.selectionSession.selected)switch(this.dataStore.type){case"OBJECT":var e=this.paintInfo.metadata.primitivesByDocumentId.get(this.dataStore.data.ObjectUniqueID);if(e)if(Er(e)===$a.Component){var t=e,n=this.paintInfo.metadata.components.get(t);n&&this.paintInfo.selectionSession.draw(n)}else this.paintInfo.selectionSession.draw([e])}}},{key:"onHide",value:function(){this.paintInfo.selectionSession.clear()}}])&&ia(t.prototype,n),o&&ia(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(Nt),ha=n(280);function da(e){return(da="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ya(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var o,r,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(o=n.next()).done)&&(i.push(o.value),!t||i.length!==t);a=!0);}catch(e){c=!0,r=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw r}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return va(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return va(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function va(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function ba(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function ma(){return(ma="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=wa(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}}).apply(this,arguments)}function wa(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ia(e)););return e}function ga(e,t){return(ga=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ea(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Ia(e);if(t){var r=Ia(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Oa(this,n)}}function Oa(e,t){if(t&&("object"===da(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Sa(e)}function Sa(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ia(e){return(Ia=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Pa(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ta,ka=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ga(e,t)}(i,e);var t,n,o,r=Ea(i);function i(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),Pa(Sa(n=r.call(this,"Pcb3D",e)),"paintInfo",void 0),Pa(Sa(n),"layerKind",Ta.Top),Pa(Sa(n),"min",[0,0,0]),Pa(Sa(n),"max",[0,0,0]),Pa(Sa(n),"areaPoint",{x:0,y:0,z:0}),Pa(Sa(n),"textPoint",{x:0,y:0,z:0}),Pa(Sa(n),"toString",(function(){return"CommentsDrawingEngine.Painters.Pcb3D"})),n.paintInfo=t,n.setPoints(),n.onSceneTransform=n.onSceneTransform.bind(Sa(n)),n.paintInfo.renderer.on("transformScene",n.onSceneTransform),n}return t=i,(n=[{key:"areaScreenPoint",get:function(){var e=this.paintInfo.scene.project([this.areaPoint.x,this.areaPoint.y,this.areaPoint.z]);return{x:e[0],y:e[1]}}},{key:"textScreenPoint",get:function(){var e=this.paintInfo.scene.project([this.textPoint.x,this.textPoint.y,this.textPoint.z]);return{x:e[0],y:e[1]}}},{key:"destroy",value:function(){this.paintInfo.renderer.off("transformScene",this.onSceneTransform),ma(Ia(i.prototype),"destroy",this).call(this)}},{key:"zoomToFit",value:function(){var e=this.layerKind===Ta.Top?ha.a.Front:ha.a.Back;this.paintInfo.scene.zoomToFitFixedView(e,this.min,this.max,.6)}},{key:"getObservableObject",value:function(){return new hn(this)}},{key:"getIconOverlayView",value:function(){return this.paintInfo.overlayView}},{key:"createTextEditMode",value:function(e){return new pa(e,this.paintInfo)}},{key:"createDrawingEditMode",value:function(){return null}},{key:"onSceneTransform",value:function(){this.emit("SCENE_CHANGED")}},{key:"setPoints",value:function(){var e,t=this,n=this.dataStore.data;switch(this.dataStore.type){case"POINT":this.areaPoint.x=.5*(n.AreaLeft+n.AreaRight),this.areaPoint.y=.5*(n.AreaTop+n.AreaBottom),this.min[0]=n.AreaLeft,this.min[1]=n.AreaBottom,this.max[0]=n.AreaRight,this.max[1]=n.AreaTop;break;case"OBJECT":var o,r=this.paintInfo.metadata.primitivesByDocumentId.get(this.dataStore.data.ObjectUniqueID);if(r)if(Er(r)===$a.Component){var i=r,a=this.paintInfo.metadata.components.get(i);a&&(o=this.paintInfo.scene.getNodeItemsByIds(a.filter((function(e){return Er(e)!==$a.Text})).map((function(e){return e.pcbId}))),this.layerKind=i.layerId)}else{var c=this.paintInfo.metadata.componentsBySceneId.get(r.pcbId);null!=c&&c.layerId&&(this.layerKind=c.layerId);var u=this.paintInfo.scene.getNodeItemById(r.pcbId);u&&(o=[u])}if(null!==(e=o)&&void 0!==e&&e.length){var s=ya(Ti(this.paintInfo.scene,o),2),f=s[0],l=s[1];this.areaPoint.x=f[0]+(l[0]-f[0])/2,this.areaPoint.y=f[1]+(l[1]-f[1])/2,this.areaPoint.z=this.layerKind===Ta.Top?f[2]:l[2],f.forEach((function(e,n){return t.min[n]=e})),l.forEach((function(e,n){return t.max[n]=e}))}else this.areaPoint.x=.5*(n.AreaLeft+n.AreaRight),this.areaPoint.y=.5*(n.AreaTop+n.AreaBottom),this.min[0]=n.AreaLeft,this.min[1]=n.AreaBottom,this.max[0]=n.AreaRight,this.max[1]=n.AreaTop}this.textPoint.x=this.areaPoint.x,this.textPoint.y=this.areaPoint.y,this.textPoint.z=this.areaPoint.z,this.min[2]=this.paintInfo.boxForLayers[2],this.max[2]=this.paintInfo.boxForLayers[5]}}])&&ba(t.prototype,n),o&&ba(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(on);function ja(e){return(ja="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xa(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Da(e,t){return(Da=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ca(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Ma(e);if(t){var r=Ma(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Ra(this,n)}}function Ra(e,t){if(t&&("object"===ja(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Aa(e)}function Aa(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ma(e){return(Ma=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.Top=1]="Top",e[e.Bottom=32]="Bottom"}(Ta||(Ta={}));var Ba=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Da(e,t)}(i,e);var t,n,o,r=Ca(i);function i(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),_a(Aa(e=r.call(this,"PCBView3D")),"paintInfo",null),_a(Aa(e),"metadata",new Map),_a(Aa(e),"acceptedPrimitivesToSelect",new Set([$a.Pad,$a.Track,$a.Via])),_a(Aa(e),"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Pcb.3DState"})),e.hasCustomDrawing=!1,e}return t=i,(n=[{key:"svg",get:function(){var e,t;return null!==(e=null===(t=this.paintInfo)||void 0===t?void 0:t.overlayView.$el)&&void 0!==e?e:void 0}},{key:"canvas",get:function(){var e,t;return null!==(e=null===(t=this.paintInfo)||void 0===t?void 0:t.canvas)&&void 0!==e?e:void 0}},{key:"createMetaInfo",value:function(){var e={};return e.components=new Map,e.componentsBySceneId=new Map,e.primitivesBySceneId=new Map,e.primitivesByDocumentId=new Map,e}},{key:"setupDocumentMetadata",value:function(e,t){var n=this,o=Date.now();try{!function(){var o=n.createMetaInfo();if(n.metadata.set(e,o),t.components)for(var r=function(e){var n=t.components[e];if(!n.pcbUniqueId)return"continue";o.primitivesByDocumentId.set(n.pcbUniqueId,n),o.componentsBySceneId.set(n.pcbId,n);var r=[];n.primitives&&t.primitives&&(n.primitives.map((function(e){return t.primitives.length>e?t.primitives[e]:null})).filter((function(e){return e&&e.pcbId})).forEach((function(e){e&&(r.push(e),o.componentsBySceneId.set(e.pcbId,n))})),o.components.set(n,r))},i=0;i<t.components.length;i++)r(i);t.primitives&&t.primitives.forEach((function(e){n.acceptedPrimitivesToSelect.has(Er(e))&&(e.pcbUniqueId&&o.primitivesByDocumentId.set(e.pcbUniqueId,e),o.primitivesBySceneId.set(e.pcbId,e))}))}()}finally{var r=Date.now();console.log("".concat(this,".setupDocumentMetadata: ").concat(r-o," ms."))}}},{key:"createOverlay",value:function(){var e,t={},n={id:"",name:""};c.bus.emit("PCBView:documentInfo",n),t.documentId=n.id,t.documentName=n.name,t.metadata=null!==(e=this.metadata.get(t.documentId))&&void 0!==e?e:this.createMetaInfo();var o=this.workspace;if(!o)throw new Error("Workspace was not found.");t.workspace=o;var r=o.querySelector("canvas");if(!r)throw new Error("Canvas was not found.");t.canvas=r;var i=document.getElementById("pcb3d-document-viewer-comment-overlay");i&&i.remove();var a=new yt("pcb3d-document-viewer-comment-overlay");a.mount(o),a.$destroy(),t.overlayView=a;var u=c.engines.PcbEngine;t.renderer=u.pcbRenderer,t.scene=u.pcbRenderer.scene3d,t.boxForLayers=t.scene.getBoxForLayers(),t.selectionSession=new oa(t.renderer),this.paintInfo=t}},{key:"destoyOverlay",value:function(){var e=this.paintInfo;e&&(e.selectionSession.destoy(),e.overlayView.destroy()),this.paintInfo=null}},{key:"createCreationSession",value:function(){if(!this.paintInfo)throw new Error("No paint info to get creation session.");return new Vi(this.paintInfo)}},{key:"createGraphicsPainter",value:function(e){if(!this.paintInfo)throw new Error("No paint info to get painter.");return new ka(e,this.paintInfo)}},{key:"canBePaint",value:function(e){return"OBJECT"===e.type||"POINT"===e.type}}])&&xa(t.prototype,n),o&&xa(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(wr);function La(e){return(La="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Va(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Na(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ga(){return(Ga="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=Ha(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}}).apply(this,arguments)}function Ha(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ya(e)););return e}function Wa(e,t){return(Wa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Fa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Ya(e);if(t){var r=Ya(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Ua(this,n)}}function Ua(e,t){if(t&&("object"===La(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return za(e)}function za(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ya(e){return(Ya=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Xa(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var qa=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Wa(e,t)}(i,e);var t,n,o,r=Fa(i);function i(){var e;Va(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return Xa(za(e=r.call.apply(r,[this].concat(n))),"runnig",!1),Xa(za(e),"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Pcb.ActiveThreadSession"})),e}return t=i,(n=[{key:"run",value:function(e){Ga(Ya(i.prototype),"run",this).call(this,e),this.runnig=!0,c.bus.emit("PcbEngine:enableSelection",!1)}},{key:"stop",value:function(){var e=this;this.runnig=!1,Ga(Ya(i.prototype),"stop",this).call(this),Object(Jn.a)((function(){e.runnig||c.bus.emit("PcbEngine:enableSelection",!0)}))}}])&&Na(t.prototype,n),o&&Na(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(H);function Za(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ja(e,t,n){return t&&Za(e.prototype,t),n&&Za(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Qa(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var $a,Ka=Ja((function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Qa(this,"disableCustomDraw",void 0),Qa(this,"svg",void 0),Qa(this,"canvas",void 0),Qa(this,"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Pcb.UiThreadEditOptions"})),this.svg=t,this.canvas=n,this.disableCustomDraw=o}));function ec(e){return(ec="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tc(e,t,n,o,r,i,a){try{var c=e[i](a),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(o,r)}function nc(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function oc(e,t){return(oc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function rc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=cc(e);if(t){var r=cc(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return ic(this,n)}}function ic(e,t){if(t&&("object"===ec(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ac(e)}function ac(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function cc(e){return(cc=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function uc(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.No=0]="No",e[e.Arc=1]="Arc",e[e.Pad=2]="Pad",e[e.Via=3]="Via",e[e.Track=4]="Track",e[e.Text=5]="Text",e[e.Fill=6]="Fill",e[e.Connection=7]="Connection",e[e.Net=8]="Net",e[e.Component=9]="Component",e[e.Poly=10]="Poly",e[e.Region=11]="Region",e[e.ComponentBody=12]="ComponentBody",e[e.Dimension=13]="Dimension",e[e.Coordinate=14]="Coordinate",e[e.Class=15]="Class",e[e.Rule=16]="Rule",e[e.FromTo=17]="FromTo",e[e.DifferentialPair=18]="DifferentialPair",e[e.Violation=19]="Violation",e[e.Embedded=20]="Embedded",e[e.EmbeddedBoard=21]="EmbeddedBoard",e[e.SplitPlane=22]="SplitPlane",e[e.Trace=23]="Trace",e[e.SpareVia=24]="SpareVia",e[e.Board=25]="Board",e[e.BoardOutline=26]="BoardOutline"}($a||($a={}));var sc=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&oc(e,t)}(u,e);var t,n,o,r,i,a=rc(u);function u(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),uc(ac(e=a.call(this,"Pcb")),"currentActiveState",null),uc(ac(e),"documentIds",new Set),uc(ac(e),"states",new Set),uc(ac(e),"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Pcb"}));var t=function(t){var n=new t;n.on("VIEW_SHOWN",(function(t){return e.onStateViewShown(t)})),n.on("VIEW_HIDDEN",(function(){return e.onStateViewHidden()})),e.states.add(n)};return t(Pi),t(Ba),e}return t=u,(n=[{key:"test",value:function(e){return"PCB"===(null==e?void 0:e.documentType)||this.documentIds.has(e.data.DocumentUniqueID)}},{key:"createCreationSession",value:function(){if(!this.currentActiveState)throw new Error("No active state to get creation session.");return this.currentActiveState.createCreationSession()}},{key:"createGraphicsPainter",value:function(e){if(!this.currentActiveState)throw new Error("No active state to get painter.");return this.currentActiveState.createGraphicsPainter(e)}},{key:"createUiThreadEditOptions",value:function(){var e,t,n,o,r,i,a=null!==(e=null===(t=this.currentActiveState)||void 0===t?void 0:t.svg)&&void 0!==e?e:void 0,c=null!==(n=null===(o=this.currentActiveState)||void 0===o?void 0:o.canvas)&&void 0!==n?n:void 0;return new Ka(a,c,null!==(r=!(null!==(i=this.currentActiveState)&&void 0!==i&&i.hasCustomDrawing))&&void 0!==r&&r)}},{key:"createActiveThreadSession",value:function(){return new qa}},{key:"viewIsShown",value:function(){var e;return!(null===(e=this.currentActiveState)||void 0===e||!e.viewIsShown)}},{key:"setupMetadata",value:function(){var e,t=c.response;return null!=t&&t.metadata&&null!==(e=t.metadata.pcbDocument)&&void 0!==e&&e.id&&this.setupDocument(t.metadata.pcbDocument.id,t.metadata),Promise.resolve()}},{key:"createOverlay",value:function(){if(!this.currentActiveState)throw new Error("Create overlay for empty state.");this.logger.LogDebug("Create overlay [".concat(this.currentActiveState,":").concat(this.currentActiveState.documentId,"]")),this.currentActiveState.createOverlay()}},{key:"destroyOverlay",value:function(){this.currentActiveState&&(this.logger.LogDebug("Destroy overlay [".concat(this.currentActiveState,":").concat(this.currentActiveState.documentId,"]")),this.currentActiveState.destoyOverlay())}},{key:"coordXToDocument",value:function(e){return e?Math.round(1e6*e):0}},{key:"coordYToDocument",value:function(e){return e?Math.round(1e6*e):0}},{key:"coordXToScene",value:function(e){return e?e/1e6:0}},{key:"coordYToScene",value:function(e){return e?e/1e6:0}},{key:"canBePaint",value:function(e){var t,n;return"ACTIVE"===this.getState()&&(null===(t=this.currentActiveState)||void 0===t?void 0:t.documentId)===e.documentId&&(null===(n=this.currentActiveState)||void 0===n?void 0:n.canBePaint(e))}},{key:"activateGraphics",value:(r=regeneratorRuntime.mark((function e(t,n,o){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!this.currentActiveState){e.next=17;break}if(!this.currentActiveState.canBePaint(t)){e.next=13;break}if(n){e.next=8;break}return e.next=6,this.activateView();case 6:e.next=11;break;case 8:return r="PCB"===t.documentType?"PCBView":"PCBView3D",e.next=11,this.activateView(r);case 11:e.next=15;break;case 13:return e.next=15,this.activateView("PCBView");case 15:e.next=20;break;case 17:return i="PCB"===t.documentType?"PCBView":"PCBView3D",e.next=20,this.activateView(i);case 20:t.expand(),n&&t.zoomToFit(),o(t),e.next=29;break;case 25:e.prev=25,e.t0=e.catch(0),this.logger.LogError("Activate graphics error.",e.t0),o(null);case 29:case"end":return e.stop()}}),e,this,[[0,25]])})),i=function(){var e=this,t=arguments;return new Promise((function(n,o){var i=r.apply(e,t);function a(e){tc(i,n,o,a,c,"next",e)}function c(e){tc(i,n,o,a,c,"throw",e)}a(void 0)}))},function(e,t,n){return i.apply(this,arguments)})},{key:"activateView",value:function(e){var t=this;return new Promise((function(n){"ACTIVE"!==t.getState()||e&&t.currentActiveState&&e!==t.currentActiveState.viewName?(t.on("ACTIVE",(function e(){t.off("ACTIVE",e),n()})),c.bus.emit("View:set",null!=e?e:"PCBView")):n()}))}},{key:"onStateViewShown",value:function(e){this.onStateViewHidden(),this.currentActiveState=e;try{this.emit("viewShown",this.currentActiveState.workspace)}catch(e){this.logger.LogError("Activate for state ".concat(this.currentActiveState," error."),e)}}},{key:"onStateViewHidden",value:function(){if(null!==this.currentActiveState){try{this.emit("viewHidden")}catch(e){this.logger.LogError("Deactivate for state ".concat(this.currentActiveState," error."),e)}this.currentActiveState=null}}},{key:"setupDocument",value:function(e,t){this.logger.LogDebug("Setup for document "+e),this.documentIds.add(e),this.states.forEach((function(n){return n.setupDocumentMetadata(e,t)}))}}])&&nc(t.prototype,n),o&&nc(t,o),Object.defineProperty(t,"prototype",{writable:!1}),u}(ie);function fc(e){return(fc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function lc(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function pc(e,t){return(pc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function hc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=vc(e);if(t){var r=vc(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return dc(this,n)}}function dc(e,t){if(t&&("object"===fc(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return yc(e)}function yc(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function vc(e){return(vc=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function bc(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var mc=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&pc(e,t)}(c,e);var t,n,r,i=hc(c);function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),bc(yc(t=i.call(this,{name:"Gerber",supportedTypes:["AREA","POINT"],workspace:e.workspace})),"nodeItem",null),bc(yc(t),"paintInfo",void 0),bc(yc(t),"toString",(function(){return"CommentsDrawingEngine.CreationSession.Gerber"})),t.paintInfo=e,t.on("before",(function(){e.workspace.style.cursor="crosshair"})),t.on("after",(function(){e.workspace.style.cursor="auto",t.setNodeItem(null)})),t.on("drawRect",(function(e){return t.drawRect(e)})),t}return t=c,(n=[{key:"scene",get:function(){return this.paintInfo.scene}},{key:"createData",value:function(e){var t={coordType:"scene"};return t.guid=a,t.drawing={Items:[]},t.status=o.Active,t.threadNumber=-1,t.documentName=this.paintInfo.documentName,t.documentType="Gerber",t.data={},t.data.DocumentUniqueID=this.paintInfo.documentId,t.data.TextLeft=0,t.data.TextTop=0,t.data.TextRight=0,t.data.TextBottom=0,e.width||e.height?(t.type="AREA",this.setRectData(t,e)):(t.type="POINT",this.setPointData(t,e)),Promise.resolve(t)}},{key:"setNodeItem",value:function(e){this.nodeItem&&this.scene.removeItem(this.nodeItem),this.nodeItem=e,this.paintInfo.renderer.invalidate()}},{key:"drawRect",value:function(e){for(var t,n=this.scene.viewportToWorld([e.x,e.y]),o=this.scene.viewportToWorld([e.x+e.width,e.y+e.height]),r={left:n[0],top:n[1],right:o[0],bottom:o[1]},i=[[r.left,r.top,0],[r.right,r.top,0],[r.right,r.bottom,0],[r.left,r.bottom,0],[r.left,r.top,0]],a=[],c=0;c<i.length-1;c++){var u=i[c],s=i[c+1];a.push({from:u,to:s,color:this.paintInfo.materialColor,width:4,dash:0})}var f=new gr.NodeContainer;(t=f.lines).push.apply(t,a);var l=this.scene.addNode(this.paintInfo.layerId,f);this.setNodeItem(l)}},{key:"setPointData",value:function(e,t){var n=this.scene.viewportToWorld([t.x,t.y]);e.data.AreaLeft=n[0]+5,e.data.AreaTop=n[1]+5,e.data.AreaRight=n[0]-5,e.data.AreaBottom=n[1]-5}},{key:"setRectData",value:function(e,t){var n=this.scene.viewportToWorld([t.x,t.y]),o=this.scene.viewportToWorld([t.x+t.width,t.y+t.height]);e.data.AreaLeft=n[0],e.data.AreaTop=n[1],e.data.AreaRight=o[0],e.data.AreaBottom=o[1]}}])&&lc(t.prototype,n),r&&lc(t,r),Object.defineProperty(t,"prototype",{writable:!1}),c}(ve);function wc(e){return(wc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function gc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Ec(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Oc(){return(Oc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=Sc(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}}).apply(this,arguments)}function Sc(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=jc(e)););return e}function Ic(e,t){return(Ic=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Pc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=jc(e);if(t){var r=jc(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Tc(this,n)}}function Tc(e,t){if(t&&("object"===wc(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return kc(e)}function kc(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function jc(e){return(jc=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function xc(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Dc=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ic(e,t)}(i,e);var t,n,o,r=Pc(i);function i(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),xc(kc(n=r.call(this,"Gerber",e)),"paintInfo",void 0),xc(kc(n),"toString",(function(){return"CommentsDrawingEngine.Painters.Gerber"})),n.paintInfo=t,n.setPoints(),n.onSceneTransform=n.onSceneTransform.bind(kc(n)),n.paintInfo.renderer.on("transformScene",n.onSceneTransform),n}return t=i,(n=[{key:"areaScreenPoint",get:function(){var e=this.paintInfo.scene.worldToViewport([this.areaPoint.x,this.areaPoint.y]);return{x:e[0],y:e[1]}}},{key:"textScreenPoint",get:function(){var e=this.paintInfo.scene.worldToViewport([this.textPoint.x,this.textPoint.y]);return{x:e[0],y:e[1]}}},{key:"destroy",value:function(){this.paintInfo.renderer.off("transformScene",this.onSceneTransform),Oc(jc(i.prototype),"destroy",this).call(this)}},{key:"zoomToFit",value:function(){if(this.editMode){var e=this.editMode.getBoundRect();if(!e.isInfinite){var t=this.dataStore.data,n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gc(Object(n),!0).forEach((function(t){xc(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e),o=n.left,r=n.top,i=n.left+n.width,a=n.top-n.height;t.TextLeft!==t.TextRight&&t.TextTop!==t.TextBottom&&(o=Math.min(o,t.TextLeft),i=Math.max(i,t.TextLeft),r=Math.max(r,t.TextTop),a=Math.min(a,t.TextTop)),this.paintInfo.scene.zoomToFit([o,a,0],[i,r,0],.6,.3)}}}},{key:"getObservableObject",value:function(){return new hn(this)}},{key:"getIconOverlayView",value:function(){return this.paintInfo.overlayView}},{key:"createTextEditMode",value:function(e){switch(e.type){case"POINT":case"AREA":return new Nr(e,this.paintInfo)}throw new Error("Method not implemented for type ".concat(e.type,"."))}},{key:"createDrawingEditMode",value:function(e){var t=this;return new ni(e,this.paintInfo.workspace,this.paintInfo.sceneGroup,(function(){return t.emit("DRAWINGS_CHANGED")}))}},{key:"tryMoveIcon",value:function(e){var t=this.paintInfo.scene.viewportToWorld([e.x,e.y]);return e.x=t[0],e.y=t[1],!0}},{key:"onSceneTransform",value:function(){this.emit("SCENE_CHANGED")}},{key:"setPoints",value:function(){var e=this.dataStore.data;switch(this.dataStore.type){case"POINT":this.areaPoint.x=.5*(e.AreaLeft+e.AreaRight),this.areaPoint.y=.5*(e.AreaTop+e.AreaBottom);break;case"AREA":case"REDLINE":this.areaPoint.x=e.AreaRight,this.areaPoint.y=e.AreaTop}e.TextLeft!==e.TextRight&&e.TextTop!==e.TextBottom?(this.textPoint.x=e.TextLeft,this.textPoint.y=e.TextTop):(this.textPoint.x=this.areaPoint.x,this.textPoint.y=this.areaPoint.y)}}])&&Ec(t.prototype,n),o&&Ec(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(on);function Cc(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Rc(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ac=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Rc(this,"svg",void 0),Rc(this,"canvas",void 0),Rc(this,"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Gerber.UiThreadEditOptions"})),this.svg=t,this.canvas=n}var t,n,o;return t=e,(n=[{key:"disableCustomDraw",get:function(){return!1}}])&&Cc(t.prototype,n),o&&Cc(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Mc(e){return(Mc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _c(e,t,n,o,r,i,a){try{var c=e[i](a),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(o,r)}function Bc(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Lc(e,t){return(Lc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Vc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Hc(e);if(t){var r=Hc(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Nc(this,n)}}function Nc(e,t){if(t&&("object"===Mc(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Gc(e)}function Gc(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Hc(e){return(Hc=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Wc(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Fc=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Lc(e,t)}(u,e);var t,n,o,r,i,a=Vc(u);function u(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),Wc(Gc(e=a.call(this,"Gerber")),"defaultDocumentId",void 0),Wc(Gc(e),"viewShown",!1),Wc(Gc(e),"paintInfo",null),Wc(Gc(e),"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Gerber"})),e.setupViewDisplayEvents(),e}return t=u,(n=[{key:"test",value:function(e){var t,n=null==e||null===(t=e.data)||void 0===t?void 0:t.DocumentUniqueID;return"Gerber"===(null==e?void 0:e.documentType)||n===this.defaultDocumentId||(null==n?void 0:n.endsWith("_GERBER"))}},{key:"createCreationSession",value:function(){if(!this.paintInfo)throw new Error("No paint info to get creation session.");return new mc(this.paintInfo)}},{key:"createGraphicsPainter",value:function(e){if(!this.paintInfo)throw new Error("No paint info to create painter.");return new Dc(e,this.paintInfo)}},{key:"createUiThreadEditOptions",value:function(){var e,t,n,o,r=null!==(e=null===(t=this.paintInfo)||void 0===t?void 0:t.sceneGroup.closest("svg"))&&void 0!==e?e:void 0,i=null!==(n=null===(o=this.paintInfo)||void 0===o?void 0:o.canvas)&&void 0!==n?n:void 0;return new Ac(r,i)}},{key:"viewIsShown",value:function(){return this.viewShown}},{key:"setupMetadata",value:function(){var e=this,t=c.engines.GerberEngine;return null==t||t.allDocuments.forEach((function(t,n){0===n&&(e.defaultDocumentId=t.id)})),Promise.resolve()}},{key:"createOverlay",value:function(){var e,t={},n={id:this.defaultDocumentId,name:""};c.bus.emit("GerberView:documentInfo",n),t.documentId=n.id,t.documentName=n.name;var o=this.workspace;if(!o)throw new Error("Workspace was not found.");t.workspace=o;var r=o.querySelector("canvas");if(!r)throw new Error("Canvas was not found.");t.canvas=r;var i={renderDocumentData:null};c.bus.emit("PcbEngine:renderDocumentData",i);var a=i.renderDocumentData,u=a.overlay;t.sceneGroup=null!==(e=u.querySelector("#gerber-overlay-scene-for-comments"))&&void 0!==e?e:me("g",{"data-owner":"comment-panel",id:"gerber-overlay-scene-for-comments"}),u.appendChild(t.sceneGroup);var s=document.getElementById("gerber-document-viewer-comment-overlay");s&&s.remove();var f=new yt("gerber-document-viewer-comment-overlay");f.mount(a.overlay.parentElement),t.overlayView=f,t.renderer=a.renderer,t.scene=a.scene2d,t.layerId=t.scene.layerMap.GetLayersCount()-1,t.materialColor=[38,127,235,225],t.materialId=t.scene.addMaterial(new gr.Material(t.materialColor,gr.HatchStyle.None)),this.paintInfo=t}},{key:"destroyOverlay",value:function(){var e=this.paintInfo;if(e){e.sceneGroup.remove(),e.overlayView.destroy();var t=e.scene.getMaterialMap().GetMaterial(e.materialId);t&&e.scene.removeMaterial(t)}this.paintInfo=null}},{key:"coordXToDocument",value:function(e){return e?Math.round(1e6*e):0}},{key:"coordYToDocument",value:function(e){return e?Math.round(1e6*e):0}},{key:"coordXToScene",value:function(e){return e?e/1e6:0}},{key:"coordYToScene",value:function(e){return e?e/1e6:0}},{key:"canBePaint",value:function(e){return"ACTIVE"===this.getState()&&(e.documentId.endsWith("_GERBER")||this.defaultDocumentId===e.documentId)}},{key:"activateGraphics",value:(r=regeneratorRuntime.mark((function e(t,n,o){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.isViewEnabled()){e.next=4;break}return o(null),e.abrupt("return");case 4:return e.next=6,this.activateView();case 6:t.expand(),n&&t.zoomToFit(),o(t),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),this.logger.LogError("Activate graphics error.",e.t0),o(null);case 15:case"end":return e.stop()}}),e,this,[[0,11]])})),i=function(){var e=this,t=arguments;return new Promise((function(n,o){var i=r.apply(e,t);function a(e){_c(i,n,o,a,c,"next",e)}function c(e){_c(i,n,o,a,c,"throw",e)}a(void 0)}))},function(e,t,n){return i.apply(this,arguments)})},{key:"isViewEnabled",value:function(){var e=c.views.GerberView;return e&&!e.hidden}},{key:"activateView",value:function(){var e=this;return new Promise((function(t){"ACTIVE"===e.getState()?t():(e.on("ACTIVE",(function n(){e.off("ACTIVE",n),t()})),c.bus.emit("View:set","GerberView"))}))}},{key:"setupViewDisplayEvents",value:function(){var e=this,t=!1,n=!1,o=null;c.bus.on("GerberView:shown",(function(r){o=r,n=!0,t&&(e.viewShown=!0,e.emit("viewShown",o))})),c.bus.on("GerberView:hidden",(function(){n=!1,t&&(e.viewShown=!1,e.emit("viewHidden"))})),c.bus.on("GerberView:documentChanged",(function(r){!t&&n?(e.viewShown=!0,e.emit("viewShown",o)):e.viewShown&&(e.emit("viewHidden"),e.emit("viewShown",o)),t=!0}))}}])&&Bc(t.prototype,n),o&&Bc(t,o),Object.defineProperty(t,"prototype",{writable:!1}),u}(ie);function Uc(e){return(Uc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function zc(e,t,n,o,r,i,a){try{var c=e[i](a),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(o,r)}function Yc(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Xc(e,t){return(Xc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function qc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Qc(e);if(t){var r=Qc(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Zc(this,n)}}function Zc(e,t){if(t&&("object"===Uc(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Jc(e)}function Jc(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Qc(e){return(Qc=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var $c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Xc(e,t)}(f,e);var t,n,r,i,u,s=qc(f);function f(e){var t,n,o,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),t=s.call(this,{name:"LSM",supportedTypes:["OBJECT"],workspace:e.workspace}),n=Jc(t),r=void 0,(o="paintInfo")in n?Object.defineProperty(n,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[o]=r,t.paintInfo=e,t.onSelect=t.onSelect.bind(Jc(t)),t.on("before",(function(){c.bus.on("Lsm:select",t.onSelect)})),t.on("after",(function(){c.bus.off("Lsm:select",t.onSelect)})),t}return t=f,(n=[{key:"onSelect",value:function(e){var t=null,n=null;if(e)switch(e.name){case"layer":(n={}).name=e.name,n.id=e.item.id;break;case"via":(n={}).name=e.name,n.id=e.item.name}n&&((t={}).coordType="scene",t.guid=a,t.drawing={Items:[]},t.status=o.Active,t.threadNumber=-1,t.documentName=this.paintInfo.documentId,t.documentType="LSM",t.type="OBJECT",t.objectType=n.name,t.data={},t.data.DocumentUniqueID=this.paintInfo.documentName,t.data.ObjectUniqueID=n.id,t.data.TextLeft=0,t.data.TextTop=0,t.data.TextRight=0,t.data.TextBottom=0,t.data.AreaLeft=0,t.data.AreaTop=0,t.data.AreaRight=0,t.data.AreaBottom=0,c.engines.LsmEngine.scrollIntoView(t.documentName,t.data.DocumentUniqueID,t.objectType,t.data.ObjectUniqueID,50)),this.emit("executed",t)}},{key:"doStopBubble",value:function(e){return!1}},{key:"doCreateData",value:(i=regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})),u=function(){var e=this,t=arguments;return new Promise((function(n,o){var r=i.apply(e,t);function a(e){zc(r,n,o,a,c,"next",e)}function c(e){zc(r,n,o,a,c,"throw",e)}a(void 0)}))},function(){return u.apply(this,arguments)})}])&&Yc(t.prototype,n),r&&Yc(t,r),Object.defineProperty(t,"prototype",{writable:!1}),f}(ve);function Kc(e){return(Kc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function eu(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function tu(e,t){return(tu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function nu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=iu(e);if(t){var r=iu(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return ou(this,n)}}function ou(e,t){if(t&&("object"===Kc(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ru(e)}function ru(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function iu(e){return(iu=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function au(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var cu=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tu(e,t)}(i,e);var t,n,o,r=nu(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),au(ru(t=r.call(this,e.type)),"engine",void 0),au(ru(t),"pcbId",void 0),au(ru(t),"stackName",void 0),au(ru(t),"objId",void 0),au(ru(t),"view",void 0),t.engine=c.engines.LsmEngine,t.view=c.views.LSMView,t.pcbId=e.documentName,t.stackName=e.data.DocumentUniqueID,t.objId=e.data.ObjectUniqueID,t}return t=i,(n=[{key:"getBoundRect",value:function(){var e={isInfinite:!0};return e}},{key:"onShow",value:function(){this.emitSelection(this.objId)}},{key:"onHide",value:function(){this.view&&this.view.active&&this.emitSelection(null)}},{key:"onDestroy",value:function(){this.view&&this.view.active&&this.emitSelection(null)}},{key:"emitSelection",value:function(e){var t=this.engine.findStackByPcbId(this.pcbId,this.stackName),n=this.engine.createSelectionData(t,e);n||(n=this.engine.createSelectionData(t,null)),c.bus.emit("Lsm:select",n)}}])&&eu(t.prototype,n),o&&eu(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(Nt);function uu(e){return(uu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function su(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function fu(e,t){return(fu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function lu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=du(e);if(t){var r=du(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return pu(this,n)}}function pu(e,t){if(t&&("object"===uu(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return hu(e)}function hu(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function du(e){return(du=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function yu(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var vu=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&fu(e,t)}(i,e);var t,n,o,r=lu(i);function i(e,t){var n,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),yu(hu(o=r.call(this,"Lsm",e)),"paintInfo",void 0),yu(hu(o),"engine",void 0),yu(hu(o),"point",void 0),yu(hu(o),"toString",(function(){return"CommentsDrawingEngine.Painters.Lsm"})),o.paintInfo=t,o.engine=c.engines.LsmEngine,o.point=t.svg.closest("svg").createSVGPoint(),o.onSceneTransform=o.onSceneTransform.bind(hu(o)),null===(n=o.paintInfo.svg)||void 0===n||n.addEventListener("didTransformChange",o.onSceneTransform),o}return t=i,(n=[{key:"areaScreenPoint",get:function(){return dn(this.paintInfo.sceneGroup,this.areaPoint.x,this.areaPoint.y,this.point)}},{key:"textScreenPoint",get:function(){return dn(this.paintInfo.sceneGroup,this.textPoint.x,this.textPoint.y,this.point)}},{key:"zoomToFit",value:function(){this.engine.scrollIntoView(this.dataStore.documentName,this.dataStore.data.DocumentUniqueID,this.dataStore.objectType,this.dataStore.data.ObjectUniqueID,50)}},{key:"createTextEditMode",value:function(e){return new cu(e)}},{key:"createDrawingEditMode",value:function(){return null}},{key:"getObservableObject",value:function(){return new hn(this)}},{key:"getIconOverlayView",value:function(){return this.paintInfo.overlayView}},{key:"onSceneTransform",value:function(){this.emit("SCENE_CHANGED")}},{key:"createIcon",value:function(){var e={};e.observableObject=this.getObservableObject(),e.overlayView=this.getIconOverlayView(),e.guid=this.dataStore.guid,e.type=this.dataStore.type,e.scrollable=!0;var t=this.engine.getItemCellInfo(this.dataStore.documentName,this.dataStore.data.DocumentUniqueID,this.dataStore.objectType,this.dataStore.data.ObjectUniqueID,"I");return t&&(this.areaPoint.x=t.x,this.areaPoint.y=t.y,this.textPoint.x=this.areaPoint.x,this.textPoint.y=this.areaPoint.y,e.iconAlign=t.iconAlign),new Pt(e)}}])&&su(t.prototype,n),o&&su(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(on);function bu(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function mu(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var wu=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),mu(this,"svg",void 0),mu(this,"canvas",void 0),mu(this,"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Lsm.UiThreadEditOptions"})),this.svg=t}var t,n,o;return t=e,(n=[{key:"disableCustomDraw",get:function(){return!0}}])&&bu(t.prototype,n),o&&bu(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();function gu(e){return(gu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Eu(e,t,n,o,r,i,a){try{var c=e[i](a),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(o,r)}function Ou(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Su(e,t){return(Su=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Iu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=ku(e);if(t){var r=ku(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Pu(this,n)}}function Pu(e,t){if(t&&("object"===gu(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Tu(e)}function Tu(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ku(e){return(ku=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ju(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var xu,Du,Cu=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Su(e,t)}(u,e);var t,n,o,r,i,a=Iu(u);function u(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),ju(Tu(e=a.call(this,"Lsm")),"paintInfo",null),ju(Tu(e),"viewShown",!1),ju(Tu(e),"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Sch"})),e.onWorkSpaceClick=e.onWorkSpaceClick.bind(Tu(e)),e.setupViewDisplayEvents(),e}return t=u,(n=[{key:"test",value:function(e){return"LSM"===(null==e?void 0:e.documentType)}},{key:"createCreationSession",value:function(){if(!this.paintInfo)throw new Error("No paint info to get creation session.");return new $c(this.paintInfo)}},{key:"createGraphicsPainter",value:function(e){if(!this.paintInfo)throw new Error("No paint info to create painter.");return new vu(e,this.paintInfo)}},{key:"createUiThreadEditOptions",value:function(){var e,t;return new wu(null!==(e=null===(t=this.paintInfo)||void 0===t?void 0:t.workspace.querySelector("svg"))&&void 0!==e?e:void 0)}},{key:"createOverlay",value:function(){var e={},t={id:"",name:"",stackId:""};c.bus.emit("LSMView:documentInfo",t),e.documentId=t.id,e.documentName=t.name,e.documentStackId=t.stackId;var n=this.workspace;if(!n)throw new Error("Workspace was not found.");e.workspace=n,document.addEventListener("click",this.onWorkSpaceClick);var o=n.querySelector("svg");if(o){e.svg=o,e.sceneGroup=o.querySelector("#scene")||me("g",{"data-owner":"comment-panel"});var r=document.getElementById("lsm-document-viewer-comment-overlay");r&&r.remove();var i=new yt("lsm-document-viewer-comment-overlay");i.mount(e.svg),i.$el.style.overflow="visible",e.overlayView=i}this.paintInfo=e}},{key:"destroyOverlay",value:function(){var e;document.removeEventListener("click",this.onWorkSpaceClick),null===(e=this.paintInfo)||void 0===e||e.overlayView.destroy(),this.paintInfo=null}},{key:"viewIsShown",value:function(){return this.viewShown}},{key:"canBePaint",value:function(){return"ACTIVE"===this.getState()}},{key:"activateGraphics",value:(r=regeneratorRuntime.mark((function e(t,n,o){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.isViewEnabled()){e.next=4;break}return o(null),e.abrupt("return");case 4:return e.next=6,this.activateView();case 6:t.expand(),n&&t.zoomToFit(),o(t),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),this.logger.LogError("Activate graphics error.",e.t0),o(null);case 15:case"end":return e.stop()}}),e,this,[[0,11]])})),i=function(){var e=this,t=arguments;return new Promise((function(n,o){var i=r.apply(e,t);function a(e){Eu(i,n,o,a,c,"next",e)}function c(e){Eu(i,n,o,a,c,"throw",e)}a(void 0)}))},function(e,t,n){return i.apply(this,arguments)})},{key:"isViewEnabled",value:function(){return c.views.LSMView}},{key:"activateView",value:function(){var e=this;return new Promise((function(t){"ACTIVE"===e.getState()?t():(e.on("ACTIVE",(function n(){e.off("ACTIVE",n),t()})),c.bus.emit("View:set","LSMView"))}))}},{key:"setupViewDisplayEvents",value:function(){var e=this,t=!1,n=!1,o=null;c.bus.on("LSMView:shown",(function(r){o=r,n=!0,t&&(e.viewShown=!0,e.emit("viewShown",o))})),c.bus.on("LSMView:hidden",(function(){n=!1,t&&(e.viewShown=!1,e.emit("viewHidden"))})),c.bus.on("LSMView:documentChanged",(function(r){!t&&n?(e.viewShown=!0,e.emit("viewShown",o)):e.viewShown&&(e.emit("viewHidden"),e.emit("viewShown",o)),t=!0}))}},{key:"onWorkSpaceClick",value:function(e){var t=document.elementsFromPoint(e.clientX,e.clientY);if(t){var n=t.find((function(e){return e.getAttribute("data-comment-guid")}));if(!n)return;var o=n.getAttribute("data-comment-guid");if(!o)return;var r=this.getByGuid(o);if(!r)return;var i=r.getState();"PROGRESS"===i||"RESOLVE"===i?c.bus.emit("CommentsDrawingEngine:changeActiveState",o):"PROGRESS_ACTIVE"!==i&&"RESOLVE_ACTIVE"!==i||c.bus.emit("CommentsDrawingEngine:changeActiveState",null)}}}])&&Ou(t.prototype,n),o&&Ou(t,o),Object.defineProperty(t,"prototype",{writable:!1}),u}(ie);function Ru(e){return(Ru="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Au(e,t,n,o,r,i,a){try{var c=e[i](a),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(o,r)}function Mu(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _u(e,t){return(_u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Bu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Nu(e);if(t){var r=Nu(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Lu(this,n)}}function Lu(e,t){if(t&&("object"===Ru(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Vu(e)}function Vu(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Nu(e){return(Nu=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Gu(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.Global=-2]="Global",e[e.None=-1]="None",e[e.Shape=0]="Shape",e[e.Vertex=1]="Vertex"}(xu||(xu={})),function(e){e[e.Global=-1]="Global",e[e.Wireframe=0]="Wireframe",e[e.Shaded=1]="Shaded",e[e.ShadedWithBoundaries=2]="ShadedWithBoundaries"}(Du||(Du={}));var Hu=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_u(e,t)}(s,e);var t,n,r,i,c,u=Bu(s);function s(e,t,n){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),Gu(Vu(o=u.call(this,{name:"Cadex",supportedTypes:["OBJECT"],workspace:e.workspace})),"paintInfo",void 0),Gu(Vu(o),"cadexViewState",void 0),Gu(Vu(o),"documentType",void 0),o.paintInfo=e,o.cadexViewState=t,o.documentType=n;var r=t.scene.globalSelectionMode;return o.on("before",(function(){return t.scene.globalSelectionMode=xu.Shape})),o.on("after",(function(){return t.scene.globalSelectionMode=r})),o}return t=s,(n=[{key:"doStopBubble",value:function(e){return!1}},{key:"doExecute",value:(i=regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=function(e){if(e.added&&e.added.length>0){var t=e.added[0].object,r=t.modelId;if(r||0===r){var i=n.cadexViewState.model.modelObjectsList.find((function(e){return e.id===r})),c=n.cadexViewState.model.modelObjectsList.find((function(e){return e.id===(null==i?void 0:i.parentId)}));if(i&&i.instance.uuid){var u,s=t.boundingBox,f={};return f.guid=a,f.drawing={Items:[]},f.status=o.Active,f.threadNumber=-1,f.type="OBJECT",f.documentName=null!==(u=null==c?void 0:c.text)&&void 0!==u?u:"Undefined",f.documentType=n.documentType,f.objectType=i.text,f.data={},f.data.ObjectUniqueID=i.instance.uuid.toString(),f.data.DocumentUniqueID=n.cadexViewState.model.name,f.data.AreaLeft=s.minCorner.x,f.data.AreaTop=s.minCorner.y,f.data.AreaNear=s.minCorner.z,f.data.AreaRight=s.maxCorner.x,f.data.AreaBottom=s.maxCorner.y,f.data.AreaFar=s.maxCorner.z,n.emit("executed",f),void n.cadexViewState.scene.select([],!0,!1,!1)}}}n.cadexViewState.scene.select([],!0,!1,!0),n.emit("executed",null)},this.cadexViewState.scene.addEventListener("selectionChanged",t),e.prev=2,e.next=5,new Promise((function(e){return n.once("executed",(function(t){return e(t)}))}));case 5:return e.abrupt("return",e.sent);case 6:return e.prev=6,this.cadexViewState.scene.removeEventListener("selectionChanged",t),e.finish(6);case 9:case"end":return e.stop()}}),e,this,[[2,,6,9]])})),c=function(){var e=this,t=arguments;return new Promise((function(n,o){var r=i.apply(e,t);function a(e){Au(r,n,o,a,c,"next",e)}function c(e){Au(r,n,o,a,c,"throw",e)}a(void 0)}))},function(){return c.apply(this,arguments)})}])&&Mu(t.prototype,n),r&&Mu(t,r),Object.defineProperty(t,"prototype",{writable:!1}),s}(ve);function Wu(e){return(Wu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Fu(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Uu(e,t){return(Uu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function zu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=qu(e);if(t){var r=qu(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Yu(this,n)}}function Yu(e,t){if(t&&("object"===Wu(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Xu(e)}function Xu(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function qu(e){return(qu=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Zu(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ju=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Uu(e,t)}(i,e);var t,n,o,r=zu(i);function i(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),Zu(Xu(n=r.call(this,"CadexText")),"dataStore",void 0),Zu(Xu(n),"paintInfo",void 0),Zu(Xu(n),"toString",(function(){return"CommentsDrawingEngine.Painters.EditModes.CadexText"})),n.dataStore=e,n.paintInfo=t,n}return t=i,(n=[{key:"getBoundRect",value:function(){throw new Error("Method not implemented.")}},{key:"onShow",value:function(){this.updateSelection(!0)}},{key:"onHide",value:function(){this.updateSelection(!1)}},{key:"updateSelection",value:function(e){var t,n;if(this.paintInfo.viewState&&null!==(t=this.dataStore)&&void 0!==t&&null!==(n=t.data)&&void 0!==n&&n.ObjectUniqueID){var o,r=this.paintInfo.viewState.getCadexModelInstanceById(this.dataStore.data.ObjectUniqueID);r&&(e?this.paintInfo.viewState.scene.select(r.view3dObjects,!0,!1,!0):null===(o=this.paintInfo.viewState)||void 0===o||o.scene.deselect(r.view3dObjects,!0))}}}])&&Fu(t.prototype,n),o&&Fu(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(Nt);function Qu(e){return(Qu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $u(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ku(e,t){return(Ku=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function es(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=os(e);if(t){var r=os(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return ts(this,n)}}function ts(e,t){if(t&&("object"===Qu(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ns(e)}function ns(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function os(e){return(os=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function rs(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var is=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ku(e,t)}(i,e);var t,n,o,r=es(i);function i(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),rs(ns(n=r.call(this,"Cadex",e)),"paintInfo",void 0),rs(ns(n),"globalPoint",void 0),n.paintInfo=t,n.setPoints(e),n.paintInfo.viewState.viewPort.addEventListener("cameraChanged",n.onSceneTransform.bind(ns(n))),n}return t=i,(n=[{key:"areaScreenPoint",get:function(){var e,t;return{x:null===(e=this.paintInfo.viewState)||void 0===e?void 0:e.viewPort.globalCoordsToScreen(this.globalPoint).x,y:(null===(t=this.paintInfo.viewState)||void 0===t?void 0:t.viewPort.globalCoordsToScreen(this.globalPoint).y)+32}}},{key:"textScreenPoint",get:function(){var e,t;return{x:null===(e=this.paintInfo.viewState)||void 0===e?void 0:e.viewPort.globalCoordsToScreen(this.globalPoint).x,y:(null===(t=this.paintInfo.viewState)||void 0===t?void 0:t.viewPort.globalCoordsToScreen(this.globalPoint).y)+32}}},{key:"getObservableObject",value:function(){return new hn(this)}},{key:"getIconOverlayView",value:function(){return this.paintInfo.overlayView}},{key:"createTextEditMode",value:function(e){return new Ju(e,this.paintInfo)}},{key:"createDrawingEditMode",value:function(e){return null}},{key:"setPoints",value:function(e){var t=function(e,t){return e+(t-e)/2};this.globalPoint=new window.cadex.ModelData_Point,this.globalPoint.x=t(e.data.AreaLeft,e.data.AreaRight),this.globalPoint.y=t(e.data.AreaTop,e.data.AreaBottom),this.globalPoint.z=t(e.data.AreaNear,e.data.AreaFar)}},{key:"onSceneTransform",value:function(){this.emit("SCENE_CHANGED")}}])&&$u(t.prototype,n),o&&$u(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(on);function as(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function cs(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var us=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),cs(this,"svg",void 0),cs(this,"canvas",void 0),cs(this,"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Cadex.UiThreadEditOptions"})),this.svg=t,this.canvas=n}var t,n,o;return t=e,(n=[{key:"disableCustomDraw",get:function(){return!0}}])&&as(t.prototype,n),o&&as(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();function ss(e){return(ss="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fs(e,t,n,o,r,i,a){try{var c=e[i](a),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(o,r)}function ls(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function ps(e,t){return(ps=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function hs(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=vs(e);if(t){var r=vs(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return ds(this,n)}}function ds(e,t){if(t&&("object"===ss(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ys(e)}function ys(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function vs(e){return(vs=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function bs(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ms=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ps(e,t)}(u,e);var t,n,o,r,i,a=hs(u);function u(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),bs(ys(e=a.call(this,"Cadex")),"overlayId","aov365_cadex_model_viewer_3D_comment_overlay"),bs(ys(e),"viewShown",!1),bs(ys(e),"paintInfo",null),bs(ys(e),"cadexViewState",void 0),e.setupViewDisplayEvents(),e}return t=u,(n=[{key:"test",value:function(e){return"CadEx"===(null==e?void 0:e.documentType)}},{key:"createCreationSession",value:function(){if(!this.paintInfo)throw new Error("No paint info to get creation session.");return new Hu(this.paintInfo,this.cadexViewState,"CadEx")}},{key:"createUiThreadEditOptions",value:function(){var e,t,n,o,r=null!==(e=null===(t=this.paintInfo)||void 0===t?void 0:t.sceneGroup.closest("svg"))&&void 0!==e?e:void 0,i=null!==(n=null===(o=this.paintInfo)||void 0===o?void 0:o.canvas)&&void 0!==n?n:void 0;return new us(r,i)}},{key:"viewIsShown",value:function(){return this.viewShown}},{key:"activateGraphics",value:(r=regeneratorRuntime.mark((function e(t,n,o){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.isViewEnabled()){e.next=4;break}return o(null),e.abrupt("return");case 4:return e.next=6,this.activateView();case 6:t.expand(),n&&this.cadexViewState.viewPort.fitAll(!0),o(t),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),this.logger.LogError("Activate graphics error.",e.t0),o(null);case 15:case"end":return e.stop()}}),e,this,[[0,11]])})),i=function(){var e=this,t=arguments;return new Promise((function(n,o){var i=r.apply(e,t);function a(e){fs(i,n,o,a,c,"next",e)}function c(e){fs(i,n,o,a,c,"throw",e)}a(void 0)}))},function(e,t,n){return i.apply(this,arguments)})},{key:"isViewEnabled",value:function(){var e=c.views.CadexView;return e&&!e.hidden}},{key:"activateView",value:function(){var e=this;return new Promise((function(t){"ACTIVE"===e.getState()?t():(e.on("ACTIVE",(function n(){e.off("ACTIVE",n),t()})),c.bus.emit("View:set","CadexView"))}))}},{key:"setupViewDisplayEvents",value:function(){var e=this,t=!1,n=!1,o=null;c.bus.on("CadexView:shown",(function(r,i){e.logger.LogDebug("Attach [".concat(r,"] to overlay")),e.cadexViewState=r.currentModel,o=i,n=!0,t&&(e.viewShown=!0,e.emit("viewShown",o))})),c.bus.on("CadexView:hidden",(function(){n=!1,t&&(e.viewShown=!1,e.emit("viewHidden"))})),c.bus.on("CadexView:documentChanged",(function(r){!t&&n?(e.viewShown=!0,e.emit("viewShown",o)):e.viewShown&&(e.emit("viewHidden"),e.emit("viewShown",o)),t=!0}))}},{key:"createOverlay",value:function(){var e,t,n,o={},r=document.getElementById(this.overlayId);r&&r.remove(),(r=document.createElementNS("http://www.w3.org/2000/svg","svg")).id=this.overlayId;var i=this.workspace;if(!i)throw new Error("Workspace was not found.");o.sceneGroup=r,o.workspace=i,o.documentId=null!==(e=this.cadexViewState.model.name)&&void 0!==e?e:"",o.canvas=null===(t=this.cadexViewState)||void 0===t||null===(n=t.screenshot)||void 0===n?void 0:n.canvas,o.viewState=this.cadexViewState,i.appendChild(r);var a=new yt(this.overlayId);a.mount(r),o.overlayView=a,this.paintInfo=o}},{key:"createGraphicsPainter",value:function(e){if(!this.paintInfo)throw new Error("No paint info to get painter.");return new is(e,this.paintInfo)}},{key:"canBePaint",value:function(){return"ACTIVE"===this.getState()}},{key:"destroyOverlay",value:function(){var e=this.paintInfo;e&&(e.sceneGroup.remove(),e.overlayView.destroy()),this.paintInfo=null}}])&&ls(t.prototype,n),o&&ls(t,o),Object.defineProperty(t,"prototype",{writable:!1}),u}(ie);function ws(e){return(ws="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function gs(e,t,n,o,r,i,a){try{var c=e[i](a),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(o,r)}function Es(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Os(e,t){return(Os=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ss(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Ts(e);if(t){var r=Ts(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Is(this,n)}}function Is(e,t){if(t&&("object"===ws(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Ps(e)}function Ps(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ts(e){return(Ts=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ks=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Os(e,t)}(f,e);var t,n,r,i,u,s=Ss(f);function f(e){var t,n,o,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),t=s.call(this,{name:"FBOM",supportedTypes:["OBJECT"],workspace:e.workspace}),n=Ps(t),r=void 0,(o="paintInfo")in n?Object.defineProperty(n,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[o]=r,t.paintInfo=e,t.onSelect=t.onSelect.bind(Ps(t)),t.on("before",(function(){e.workspace.style.cursor="url('".concat("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjIiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAyMiAyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgZmlsdGVyPSJ1cmwoI2ZpbHRlcjBfZF8xMjYwNl8xMjA4MikiPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTYuODcgMTNDNi42MzE2NiAxMyA2LjQwMTE0IDEzLjA4NTEgNi4yMiAxMy4yNEwzIDE2VjRDMyAzLjQ2OTU3IDMuMjEwNzEgMi45NjA4NiAzLjU4NTc5IDIuNTg1NzlDMy45NjA4NiAyLjIxMDcxIDQuNDY5NTcgMiA1IDJIMTdDMTcuNTMwNCAyIDE4LjAzOTEgMi4yMTA3MSAxOC40MTQyIDIuNTg1NzlDMTguNzg5MyAyLjk2MDg2IDE5IDMuNDY5NTcgMTkgNFYxMUMxOSAxMS41MzA0IDE4Ljc4OTMgMTIuMDM5MSAxOC40MTQyIDEyLjQxNDJDMTguMDM5MSAxMi43ODkzIDE3LjUzMDQgMTMgMTcgMTNINi44N1oiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik0xMC41IDRIMTEuNVY3SDE0LjVWOEgxMS41VjExSDEwLjVWOEg3LjVWN0gxMC41VjRaIiBmaWxsPSJibGFjayIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTYuODcgMTNDNi42MzE2NiAxMyA2LjQwMTE0IDEzLjA4NTEgNi4yMiAxMy4yNEwzIDE2VjRDMyAzLjQ2OTU3IDMuMjEwNzEgMi45NjA4NiAzLjU4NTc5IDIuNTg1NzlDMy45NjA4NiAyLjIxMDcxIDQuNDY5NTcgMiA1IDJIMTdDMTcuNTMwNCAyIDE4LjAzOTEgMi4yMTA3MSAxOC40MTQyIDIuNTg1NzlDMTguNzg5MyAyLjk2MDg2IDE5IDMuNDY5NTcgMTkgNFYxMUMxOSAxMS41MzA0IDE4Ljc4OTMgMTIuMDM5MSAxOC40MTQyIDEyLjQxNDJDMTguMDM5MSAxMi43ODkzIDE3LjUzMDQgMTMgMTcgMTNINi44N1pNNCAxNEw1Ljg1IDEyLjI0QzYuMDMxMTQgMTIuMDg1MSA2LjI2MTY2IDEyIDYuNSAxMkgxN0MxNy4yNjUyIDEyIDE3LjUxOTYgMTEuODk0NiAxNy43MDcxIDExLjcwNzFDMTcuODk0NiAxMS41MTk2IDE4IDExLjI2NTIgMTggMTFWNEMxOCAzLjczNDc4IDE3Ljg5NDYgMy40ODA0MyAxNy43MDcxIDMuMjkyODlDMTcuNTE5NiAzLjEwNTM2IDE3LjI2NTIgMyAxNyAzSDVDNC43MzQ3OCAzIDQuNDgwNDMgMy4xMDUzNiA0LjI5Mjg5IDMuMjkyODlDNC4xMDUzNiAzLjQ4MDQzIDQgMy43MzQ3OCA0IDRWMTRaIiBmaWxsPSJibGFjayIvPgo8L2c+CjxkZWZzPgo8ZmlsdGVyIGlkPSJmaWx0ZXIwX2RfMTI2MDZfMTIwODIiIHg9IjAiIHk9IjAiIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMCIgZmlsdGVyVW5pdHM9InVzZXJTcGFjZU9uVXNlIiBjb2xvci1pbnRlcnBvbGF0aW9uLWZpbHRlcnM9InNSR0IiPgo8ZmVGbG9vZCBmbG9vZC1vcGFjaXR5PSIwIiByZXN1bHQ9IkJhY2tncm91bmRJbWFnZUZpeCIvPgo8ZmVDb2xvck1hdHJpeCBpbj0iU291cmNlQWxwaGEiIHR5cGU9Im1hdHJpeCIgdmFsdWVzPSIwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAxMjcgMCIgcmVzdWx0PSJoYXJkQWxwaGEiLz4KPGZlT2Zmc2V0IGR5PSIxIi8+CjxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjEuNSIvPgo8ZmVDb2xvck1hdHJpeCB0eXBlPSJtYXRyaXgiIHZhbHVlcz0iMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMC4zNSAwIi8+CjxmZUJsZW5kIG1vZGU9Im5vcm1hbCIgaW4yPSJCYWNrZ3JvdW5kSW1hZ2VGaXgiIHJlc3VsdD0iZWZmZWN0MV9kcm9wU2hhZG93XzEyNjA2XzEyMDgyIi8+CjxmZUJsZW5kIG1vZGU9Im5vcm1hbCIgaW49IlNvdXJjZUdyYXBoaWMiIGluMj0iZWZmZWN0MV9kcm9wU2hhZG93XzEyNjA2XzEyMDgyIiByZXN1bHQ9InNoYXBlIi8+CjwvZmlsdGVyPgo8L2RlZnM+Cjwvc3ZnPgo=","') 0 20, auto"),c.bus.emit("FBOMEngine:disableSelect",!0),c.bus.on("FBOMEngine:select",t.onSelect)})),t.on("after",(function(){e.workspace.style.cursor="auto",c.bus.off("FBOMEngine:select",t.onSelect),c.bus.emit("FBOMEngine:disableSelect",!1)})),t}return t=f,(n=[{key:"onSelect",value:function(e){if(this.logger.LogDebug("FbomCreationSession:onSelect "+e.rowId),e.rowId){var t={coordType:"scene"};t.guid=a,t.drawing={Items:[]},t.status=o.Active,t.threadNumber=-1,t.documentName=this.paintInfo.documentName,t.documentType="FBOM",t.type="OBJECT",t.objectType="row",t.data={},t.data.DocumentUniqueID=this.paintInfo.documentId,t.data.ObjectUniqueID=e.rowId,t.data.TextLeft=0,t.data.TextTop=0,t.data.TextRight=0,t.data.TextBottom=0,t.data.AreaLeft=0,t.data.AreaTop=0,t.data.AreaRight=0,t.data.AreaBottom=0,this.emit("executed",t)}}},{key:"doStopBubble",value:function(e){return!1}},{key:"doCreateData",value:(i=regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})),u=function(){var e=this,t=arguments;return new Promise((function(n,o){var r=i.apply(e,t);function a(e){gs(r,n,o,a,c,"next",e)}function c(e){gs(r,n,o,a,c,"throw",e)}a(void 0)}))},function(){return u.apply(this,arguments)})}])&&Es(t.prototype,n),r&&Es(t,r),Object.defineProperty(t,"prototype",{writable:!1}),f}(ve);function js(e){return(js="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xs(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ds(e,t){return(Ds=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Cs(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Ms(e);if(t){var r=Ms(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Rs(this,n)}}function Rs(e,t){if(t&&("object"===js(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return As(e)}function As(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ms(e){return(Ms=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Bs=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ds(e,t)}(i,e);var t,n,o,r=Cs(i);function i(e){var t,n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),_s(As(n=r.call(this)),"config",void 0),_s(As(n),"iconElement",void 0),_s(As(n),"toString",(function(){return"CommentsDrawingEngine.CellIcon"})),n.config=e,n.onChange=n.onChange.bind(As(n)),n.config.observableObject.on("change",n.onChange),n.iconElement=i.createIcon(),n.iconElement.setAttribute("data-comment-guid",e.guid),n.iconElement.setAttribute("data-skip-selection",""),null!==(t=e.cell)&&void 0!==t&&t.firstElementChild&&(e.cell.firstElementChild.appendChild(n.iconElement),n.initEvents()),n.onChange(),n}return t=i,o=[{key:"createIcon",value:function(){var e=window.document.createElement("div");e.style.position="absolute",e.style.height="24px",e.style.width="16px";var t=me("svg",{height:16,width:16}),n=me("polygon",{class:"main-icon-interaction-group",points:"12,0 0,12 0,0",fill:"#FFFFFF",stroke:"none",opacity:"1"});return e.appendChild(t),t.appendChild(n),e}}],(n=[{key:"initEvents",value:function(){var e,t,n;this.onClick=this.onClick.bind(this),null===(e=this.iconElement)||void 0===e||e.addEventListener("click",this.onClick,!0),this.onMouseEnter=this.onMouseEnter.bind(this),null===(t=this.iconElement)||void 0===t||t.addEventListener("mouseenter",this.onMouseEnter,!0),this.onMouseLeave=this.onMouseLeave.bind(this),null===(n=this.iconElement)||void 0===n||n.addEventListener("mouseleave",this.onMouseLeave,!0)}},{key:"number",set:function(e){}},{key:"visible",set:function(e){this.iconElement&&(this.iconElement.style.visibility=e?"visible":"hidden")}},{key:"state",set:function(e){var t,n=null===(t=this.iconElement)||void 0===t?void 0:t.querySelector("polygon");n&&(n.style.fill=i.ACTIVE_STATES.includes(e)?"#267FEB":"#FFFFFF",n.style.opacity=i.RESOLVE_STATES.includes(e)?"0.48":"1")}},{key:"clientBox",get:function(){var e,t;return null!==(e=null===(t=this.iconElement)||void 0===t?void 0:t.getBoundingClientRect())&&void 0!==e?e:{top:0,left:0,width:0,height:0}}},{key:"destroy",value:function(){var e;this.config.observableObject.off("change",this.onChange),this.config.observableObject.destroy(),null===(e=this.iconElement)||void 0===e||e.remove(),this.iconElement=null,this.emit("DESTROY")}},{key:"onChange",value:function(){this.emit("MOVING")}},{key:"stopBubble",value:function(e){e.stopPropagation(),e.preventDefault()}},{key:"onClick",value:function(e){this.stopBubble(e),this.emit("CLICK")}},{key:"onMouseEnter",value:function(e){var t;if(this.iconElement){var n=null===(t=this.iconElement)||void 0===t?void 0:t.getBoundingClientRect(),o=n.x+n.width,r=n.y+n.height/2;this.emit("ENTER",o,r)}}},{key:"onMouseLeave",value:function(e){this.emit("LEAVE")}}])&&xs(t.prototype,n),o&&xs(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(j.a);function Ls(e){return(Ls="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Vs(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ns(e,t){return(Ns=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Gs(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Fs(e);if(t){var r=Fs(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Hs(this,n)}}function Hs(e,t){if(t&&("object"===Ls(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Ws(e)}function Ws(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Fs(e){return(Fs=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}_s(Bs,"ACTIVE_STATES",["WAIT_FOR_POST","PROGRESS_ACTIVE","RESOLVE_ACTIVE"]),_s(Bs,"RESOLVE_STATES",["RESOLVE","RESOLVE_ACTIVE","REMOVE"]);var Us=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ns(e,t)}(i,e);var t,n,o,r=Gs(i);function i(e,t){var n,o,a,c,u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),o=r.call(this,e.type),a=Ws(o),u=void 0,(c="row")in a?Object.defineProperty(a,c,{value:u,enumerable:!0,configurable:!0,writable:!0}):a[c]=u,o.row=null===(n=t.table)||void 0===n?void 0:n.querySelector("#row-".concat(e.data.ObjectUniqueID)),o}return t=i,(n=[{key:"getBoundRect",value:function(){var e={isInfinite:!0};return e}},{key:"onShow",value:function(){this.updateSelection(!0)}},{key:"onHide",value:function(){this.updateSelection(!1)}},{key:"onDestroy",value:function(){this.updateSelection(!1)}},{key:"updateSelection",value:function(e){if(this.row)for(var t=this.row.childElementCount,n="1px solid ".concat(e?"#64D2FF":"transparent"),o=0;o<t;++o){var r=this.row.children[o];0===o&&(r.style.borderLeft=n),r.style.borderTop=n,o===t-1&&(r.style.borderRight=n),r.style.borderBottom=n}}}])&&Vs(t.prototype,n),o&&Vs(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(Nt);function zs(e){return(zs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ys(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Xs(e,t){return(Xs=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function qs(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Qs(e);if(t){var r=Qs(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Zs(this,n)}}function Zs(e,t){if(t&&("object"===zs(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Js(e)}function Js(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Qs(e){return(Qs=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function $s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ks=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Xs(e,t)}(i,e);var t,n,o,r=qs(i);function i(e,t){var n,o,a,c,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),$s(Js(u=r.call(this,"Fbom",e)),"paintInfo",void 0),$s(Js(u),"point",void 0),$s(Js(u),"toString",(function(){return"CommentsDrawingEngine.Painters.Fbom"})),u.paintInfo=t;var s=null===(n=t.table)||void 0===n?void 0:n.getBoundingClientRect();return u.point=new DOMPoint,u.point.x=null==s?void 0:s.x,u.point.y=null==s?void 0:s.y,u.onSceneTransform=u.onSceneTransform.bind(Js(u)),null===(o=t.table)||void 0===o||o.addEventListener("didTransformChange",u.onSceneTransform),null===(a=t.table)||void 0===a||null===(c=a.parentNode)||void 0===c||c.addEventListener("scroll",u.onSceneTransform),u}return t=i,(n=[{key:"areaScreenPoint",get:function(){var e=this.paintInfo.sceneGroup;return DOMPoint.fromPoint(null==e?void 0:e.getBoundingClientRect())}},{key:"textScreenPoint",get:function(){var e=this.paintInfo.sceneGroup;return DOMPoint.fromPoint(null==e?void 0:e.getBoundingClientRect())}},{key:"zoomToFit",value:function(){var e;null===(e=this.getCurrentRowElement())||void 0===e||e.scrollIntoView({behavior:"smooth",block:"center",inline:"start"})}},{key:"createTextEditMode",value:function(e){return new Us(e,this.paintInfo)}},{key:"createDrawingEditMode",value:function(){return null}},{key:"getObservableObject",value:function(){return new hn(this)}},{key:"getIconOverlayView",value:function(){return this.paintInfo.overlayView}},{key:"getCurrentRowElement",value:function(){var e;return null===(e=this.paintInfo.table)||void 0===e?void 0:e.querySelector("#row-".concat(this.dataStore.data.ObjectUniqueID))}},{key:"onSceneTransform",value:function(){this.emit("SCENE_CHANGED")}},{key:"onIconEnter",value:function(e,t){this.emit("SHOW_TOOLTIP",e,t)}},{key:"onIconLeave",value:function(){this.emit("HIDE_TOOLTIP")}},{key:"createIcon",value:function(){var e,t={};return t.observableObject=this.getObservableObject(),t.guid=this.dataStore.guid,t.type=this.dataStore.type,t.cell=(null===(e=this.getCurrentRowElement())||void 0===e?void 0:e.firstElementChild)||null,new Bs(t)}}])&&Ys(t.prototype,n),o&&Ys(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(on);function ef(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function tf(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var nf=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),tf(this,"svg",void 0),tf(this,"canvas",void 0),tf(this,"html",void 0),tf(this,"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Fbom.UiThreadEditOptions"})),this.html=t}var t,n,o;return t=e,(n=[{key:"disableCustomDraw",get:function(){return!0}}])&&ef(t.prototype,n),o&&ef(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();function of(e){return(of="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function rf(e,t,n,o,r,i,a){try{var c=e[i](a),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(o,r)}function af(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function cf(e,t){return(cf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function uf(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=lf(e);if(t){var r=lf(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return sf(this,n)}}function sf(e,t){if(t&&("object"===of(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ff(e)}function ff(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function lf(e){return(lf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function pf(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var hf=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&cf(e,t)}(u,e);var t,n,o,r,i,a=uf(u);function u(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),pf(ff(e=a.call(this,"Fbom")),"paintInfo",null),pf(ff(e),"viewShown",!1),pf(ff(e),"isEnabled",!1),pf(ff(e),"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Fbom"})),er.a.getLicenseDetails(er.a.names.killSwitchBomComment).isEnabled&&(e.isEnabled=!0,e.onWorkSpaceClick=e.onWorkSpaceClick.bind(ff(e)),e.setupViewDisplayEvents()),e}return t=u,(n=[{key:"test",value:function(e){return this.isEnabled&&"FBOM"===(null==e?void 0:e.documentType)}},{key:"createCreationSession",value:function(){if(!this.paintInfo)throw new Error("No paint info to get creation session.");return new ks(this.paintInfo)}},{key:"createGraphicsPainter",value:function(e){if(!this.paintInfo)throw new Error("No paint info to create painter.");return new Ks(e,this.paintInfo)}},{key:"createUiThreadEditOptions",value:function(){var e;return new nf(null===(e=this.paintInfo)||void 0===e?void 0:e.sceneGroup)}},{key:"createOverlay",value:function(){var e,t={},n=c.response.metadata.bomDocument;t.documentId=n.fileName,t.documentName="BOM";var o=this.workspace;if(!o)throw new Error("Workspace was not found.");t.workspace=o,document.addEventListener("click",this.onWorkSpaceClick);var r=null===(e=this.workspace)||void 0===e?void 0:e.querySelector("table");r&&(t.table=r,t.sceneGroup=r),this.paintInfo=t}},{key:"destroyOverlay",value:function(){document.removeEventListener("click",this.onWorkSpaceClick),this.paintInfo=null}},{key:"viewIsShown",value:function(){return this.viewShown}},{key:"canBePaint",value:function(){return"ACTIVE"===this.getState()}},{key:"activateGraphics",value:(r=regeneratorRuntime.mark((function e(t,n,o){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.isViewEnabled()){e.next=4;break}return o(null),e.abrupt("return");case 4:return e.next=6,this.activateView();case 6:t.expand(),n&&t.zoomToFit(),o(t),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),this.logger.LogError("Activate graphics error.",e.t0),o(null);case 15:case"end":return e.stop()}}),e,this,[[0,11]])})),i=function(){var e=this,t=arguments;return new Promise((function(n,o){var i=r.apply(e,t);function a(e){rf(i,n,o,a,c,"next",e)}function c(e){rf(i,n,o,a,c,"throw",e)}a(void 0)}))},function(e,t,n){return i.apply(this,arguments)})},{key:"isViewEnabled",value:function(){return c.views.FBOM}},{key:"activateView",value:function(){var e=this;return new Promise((function(t){"ACTIVE"===e.getState()?t():(e.on("ACTIVE",(function n(){e.off("ACTIVE",n),t()})),c.bus.emit("View:set","FBOM"))}))}},{key:"setupViewDisplayEvents",value:function(){var e=this,t=!1,n=!1,o=null;c.bus.on("FBOM:shown",(function(r){o=r,n=!0,t&&(e.viewShown=!0,e.emit("viewShown",o))})),c.bus.on("FBOM:hidden",(function(){n=!1,t&&(e.viewShown=!1,e.emit("viewHidden"))})),c.bus.on("FBOM:documentChanged",(function(r){!t&&n?(e.viewShown=!0,e.emit("viewShown",o)):e.viewShown&&(e.emit("viewHidden"),e.emit("viewShown",o)),t=!0}))}},{key:"onWorkSpaceClick",value:function(e){var t=document.elementsFromPoint(e.clientX,e.clientY);if(t){var n=t.find((function(e){return e.getAttribute("data-comment-guid")}));if(!n)return;var o=n.getAttribute("data-comment-guid");if(!o)return;var r=this.getByGuid(o);if(!r)return;var i=r.getState();"PROGRESS"===i||"RESOLVE"===i?c.bus.emit("CommentsDrawingEngine:changeActiveState",o):"PROGRESS_ACTIVE"!==i&&"RESOLVE_ACTIVE"!==i||c.bus.emit("CommentsDrawingEngine:changeActiveState",null)}}}])&&af(t.prototype,n),o&&af(t,o),Object.defineProperty(t,"prototype",{writable:!1}),u}(ie);function df(e,t,n,o,r,i,a){try{var c=e[i](a),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(o,r)}function yf(e){return function(){var t=this,n=arguments;return new Promise((function(o,r){var i=e.apply(t,n);function a(e){df(i,o,r,a,c,"next",e)}function c(e){df(i,o,r,a,c,"throw",e)}a(void 0)}))}}function vf(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function bf(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function mf(e,t,n){return t&&bf(e.prototype,t),n&&bf(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function wf(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var gf,Ef=function(){function e(){vf(this,e),wf(this,"ignoreDefaults",!1),wf(this,"toString",(function(){return"CommentsDrawingEngine.DefaultViewEngineCreator"}))}return mf(e,[{key:"createViewEngines",value:function(){var e=[];return e.push(new Eo),e.push(new fr),e.push(new sc),e.push(new Fc),e.push(new Cu),e.push(new ms),e.push(new hf),e}}]),e}(),Of=function(){function e(){vf(this,e),wf(this,"_viewEngines",[]),wf(this,"logger",void 0),wf(this,"graphicsMap",new Map),wf(this,"toString",(function(){return"CommentsDrawingEngine"})),this.logger=c.createLogger("CommentsDrawingEngine")}var t;return mf(e,[{key:"name",get:function(){return"CommentsDrawingEngine"}},{key:"comment",get:function(){return"Provides methods to add and draw graphical presentation of comments."}},{key:"dependencies",get:function(){return[]}},{key:"metaInfo",get:function(){return this}},{key:"viewEngines",get:function(){return this._viewEngines.slice()}},{key:"events",get:function(){return["CommentsDrawingEngine:create","CommentsDrawingEngine:add","CommentsDrawingEngine:find","CommentsDrawingEngine:remove","CommentsDrawingEngine:commit","CommentsDrawingEngine:activate","CommentsDrawingEngine:changeActiveState","CommentsDrawingEngine:resolve","CommentsDrawingEngine:didCreate","CommentsDrawingEngine:didAdd","CommentsDrawingEngine:showTooltip","CommentsDrawingEngine:hideTooltip","CommentsDrawingEngine:changeEditMode","CommentsDrawingEngine:deleteDrawing","CommentsDrawingEngine:startColorPicker","CommentsDrawingEngine:startLinePicker","CommentsDrawingEngine:startDraw","CommentsDrawingEngine:endDraw","CommentsDrawingEngine:startEdit","CommentsDrawingEngine:stopEdit","CommentsDrawingEngine:commitEdit","CommentsDrawingEngine:visibilityChange","CommentsDrawingEngine:filterChange","CommentsDrawingEngine:documentClick","CommentsDrawingEngine:cancelEdit"]}},{key:"setup",value:function(e){return Promise.resolve()}},{key:"setupComment",value:(t=yf(regeneratorRuntime.mark((function e(t,n){var o,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f.setup(),this.createViewEngines(t),o=this._viewEngines.map((function(e){return e.setup()})),e.next=5,Promise.all(o);case 5:this.onCreateThreadGraphics=this.onCreateThreadGraphics.bind(this),c.bus.on("CommentsDrawingEngine:create",this.onCreateThreadGraphics),this.onAddThreadGraphics=this.onAddThreadGraphics.bind(this),c.bus.on("CommentsDrawingEngine:add",this.onAddThreadGraphics),c.bus.on("CommentsDrawingEngine:find",(function(e){return e.graphics=r.graphicsMap.get(e.id)})),gf=n;case 11:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"createViewEngines",value:function(e){var t,n=this,o=null!==(t=null==e?void 0:e.createViewEngines())&&void 0!==t?t:[];null!=e&&e.ignoreDefaults||(o=(new Ef).createViewEngines().concat(o)),o.forEach((function(e){return n._viewEngines.push(e)}))}},{key:"storeGraphics",value:function(e){var t=this;if(e){var n=e.guid;this.graphicsMap.set(n,e),e.on("REMOVE",(function(){return t.graphicsMap.delete(n)}))}}},{key:"onCreateThreadGraphics",value:function(){var e=this;Object(Jn.a)(yf(regeneratorRuntime.mark((function t(){var n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=e._viewEngines.find((function(e){return"ACTIVE"===e.state}))){t.next=4;break}throw new Error("Active view engine has not found");case 4:return t.next=6,n.createGraphics();case 6:o=t.sent,e.storeGraphics(o),c.bus.emit("CommentsDrawingEngine:didCreate",{data:o}),t.next=15;break;case 11:t.prev=11,t.t0=t.catch(0),e.logger.LogError("Create new thread error",t.t0),c.bus.emit("CommentsDrawingEngine:didCreate",{error:t.t0,data:null});case 15:case"end":return t.stop()}}),t,null,[[0,11]])}))))}},{key:"onAddThreadGraphics",value:function(e,t){var n=this,o=function(){try{return JSON.parse(e.Drawing)}catch(e){return n.logger.LogError("Parce drawings error. ".concat(e.message)),{Items:[]}}};Object(Jn.a)(yf(regeneratorRuntime.mark((function r(){var i,a,u;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,(i={}).coordType="document",i.data=n.deserialize(e.Data),i.drawing=o(),i.guid=e.Guid,i.type=e.Properties.Type||"REDLINE",i.status=e.Status,i.threadNumber=e.ThreadNumber,i.documentName=e.Properties.DocumentName,i.documentType=e.Properties.DocumentType,i.objectType=e.Properties.ObjectType,a=n._viewEngines.find((function(e){return e.test(i)}))){r.next=16;break}return n.logger.LogWarn("View engine has not found for [".concat(i.threadNumber,"|").concat(i.documentType,"|").concat(i.guid,"]")),r.abrupt("return");case 16:if(!n.graphicsMap.get(i.guid)){r.next=19;break}return r.abrupt("return");case 19:return r.next=21,a.addGraphics(i,t);case 21:u=r.sent,n.storeGraphics(u),c.bus.emit("CommentsDrawingEngine:didAdd",{data:u}),r.next=30;break;case 26:r.prev=26,r.t0=r.catch(0),n.logger.LogError("Add thread error",r.t0),c.bus.emit("CommentsDrawingEngine:didAdd",{error:r.t0,data:null});case 30:case"end":return r.stop()}}),r,null,[[0,26]])}))))}},{key:"deserialize",value:function(e){var t=e.split("|").map((function(e){var t=e.split("=");if(t.length<1)return null;var n=t[0];return t.splice(0,1),[n,t.join("=")]})).filter((function(e){return null!=e})),n=new Map(t),o=function(e,t){return n.has(e)?n.get(e):t},r=function(e,t){var n=o(e,""),r=Number(n);return Number.isNaN(r)?t:r};return{DocumentUniqueID:o("DocumentUniqueID",""),ObjectUniqueID:o("ObjectUniqueID",""),PageUniqueID:o("PageUniqueID",""),AreaLeft:r("AreaLeft",0),AreaTop:r("AreaTop",0),AreaNear:r("AreaNear",0),AreaRight:r("AreaRight",0),AreaBottom:r("AreaBottom",0),AreaFar:r("AreaFar",0),TextLeft:r("TextLeft",0),TextTop:r("TextTop",0),TextNear:r("TextNear",0),TextRight:r("TextRight",0),TextBottom:r("TextBottom",0),TextFar:r("TextFar",0),Text:o("Text",""),SerializedData:function(e){try{return JSON.parse(e)}catch(e){return null}}(o("SerializedData","")),Collapsed:!1}}}]),e}(),Sf={type:"Engine",name:"CommentsEngineModule",description:"Presents a drawing engine for comments.",create:function(){return new Of}};window.__CORE__&&window.__CORE__.addModule(Sf)}});