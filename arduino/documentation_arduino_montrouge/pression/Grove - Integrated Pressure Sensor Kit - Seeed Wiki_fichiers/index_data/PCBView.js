!function(e){function n(n){for(var i,a,u=n[0],c=n[1],l=n[2],d=0,f=[];d<u.length;d++)a=u[d],Object.prototype.hasOwnProperty.call(r,a)&&r[a]&&f.push(r[a][0]),r[a]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(e[i]=c[i]);for(s&&s(n);f.length;)f.shift()();return o.push.apply(o,l||[]),t()}function t(){for(var e,n=0;n<o.length;n++){for(var t=o[n],i=!0,u=1;u<t.length;u++){var c=t[u];0!==r[c]&&(i=!1)}i&&(o.splice(n--,1),e=a(a.s=t[0]))}return e}var i={},r={33:0},o=[];function a(n){if(i[n])return i[n].exports;var t=i[n]={i:n,l:!1,exports:{}};return e[n].call(t.exports,t,t.exports,a),t.l=!0,t.exports}a.m=e,a.c=i,a.d=function(e,n,t){a.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,n){if(1&n&&(e=a(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(a.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)a.d(t,i,function(n){return e[n]}.bind(null,i));return t},a.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(n,"a",n),n},a.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},a.p="";var u=window.webpackJsonp=window.webpackJsonp||[],c=u.push.bind(u);u.push=n,u=u.slice();for(var l=0;l<u.length;l++)n(u[l]);var s=c;o.push([1076,2]),t()}({1076:function(e,n,t){e.exports=t(1077)},1077:function(e,n,t){"use strict";t.r(n);var i=t(32);function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,n,t,i,r,o,a){try{var u=e[o](a),c=u.value}catch(e){return void t(e)}u.done?n(c):Promise.resolve(c).then(i,r)}function a(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function u(e,n){return(u=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function c(e){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,i=d(e);if(n){var r=d(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return l(this,t)}}function l(e,n){if(n&&("object"===r(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return s(e)}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var p=window.__APP__.createModule,v=window.__APP__.analytics,w=["PcbEngine:documentMove","PcbEngine:documentZoom","PcbEngine:resetDocumentView","PcbEngine:documentClick"];e=p({type:"View",description:"PCB View module for show 2D designs.",create:function(e){return new(function(e){!function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&u(e,n)}(d,e);var n,t,r,l=c(d);function d(){var e;return function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,d),f(s(e=l.call(this,{name:"PCBView",displayName:"PCB",comment:"PCB 2D View module",description:"PCB View module for show 2D designs.",order:11,dependencies:["pcb"]})),"canBeSelect",(function(n){if(n){if(Object.getOwnPropertyDescriptor(n,"pcbId"))return!0;if(Object.getOwnPropertyDescriptor(n,"primitives")&&n.primitives&&n.primitives.find((function(n){return e.canBeSelect(window.__CORE__.response.metadata.primitives[n])})))return!0}return!1})),f(s(e),"onKeyUp",(function(n){e.active&&(!n||82!==n.keyCode&&"KeyR"!==n.code||setTimeout((function(){return e.engine.resetView()}),1),e.engine.layerManager&&n&&"+"===n.key&&setTimeout((function(){return e.engine.layerManager.nextOnceLayer()}),1),e.engine.layerManager&&n&&"-"===n.key&&setTimeout((function(){return e.engine.layerManager.prevOnceLayer()}),1))})),e.logger=window.__CORE__.createLogger("PCBView"),e.loadingSimulation=!1,e.pcbDidLoad=!1,e}return n=d,(t=[{key:"events",get:function(){return["PCBView:didInit","PCBView:didActivateError","PCBView:documentChanged","PCBView:documentInfo","PCBView:layerManagerCreated","PCBView:shown","PCBView:hidden","PCBView:switchSimulation","PCBView:selectSimulationNet","PCBView:selectSimulationLayer","PCBView:selectSimulationViewOption","PCBView:probeActivated","PCBView:probeDeactivated"]}},{key:"hidden",get:function(){var e,n,t;return!this.engine||!(null!==(e=this.Core.response)&&void 0!==e&&null!==(n=e.storage)&&void 0!==n&&null!==(t=n.files)&&void 0!==t&&t.find((function(e){return"PcbGraphiteData"===e.fileType})))}},{key:"hasControls",value:function(e){e.push({type:"select"}),e.push({type:"zoom"}),e.push({type:"pan"}),e.push({type:"reset"}),e.push({type:"layers"})}},{key:"setup",value:function(e){var n=this;return new Promise((function(t){if(n.Core=e,n.engine=n.Core.engines.PcbEngine,n.engine){window.addEventListener("keyup",n.onKeyUp);var i=n.Core.bus;i.on("PcbEngine:layerManagerCreated",(function(){n.layerManager=n.engine.layerManager,i.emit("PCBView:layerManagerCreated",n.layerManager)})),i.on("PcbEngine:beforeImportPCB",(function(){n.updateLoader("large","Rendering PCB","icon-render-loader-32")})),i.on("PcbEngine:afterImportPCB",(function(){n.updateLoader()})),i.on("PcbEngine:didDocumentAttachError",(function(e){n.updateLoader("error",e.message,null),i.emit("Document:open-error",{name:"PCB",message:e.message,error:e})})),i.on("PcbEngine:didDocumentAttach",(function(e){i.emit("Views:enable"),n.updateLoader(),i.emit("PCBView:documentChanged",e)})),i.on("PcbEngine:beforeDocumentInit",(function(e){return n.onPcbDocumentLoad(e)})),i.on("PcbEngine:afterDocumentInit",(function(){return n.onPcbDocumentDidLoad()})),i.on("PCBView:documentInfo",(function(e){var t;if(e){var i;if(e.id)i=n.engine.allDocuments.find((function(n){return n.id===e.id}));else{var r=n.engine.activeDocumentIndex;i=n.engine.allDocuments[r],e.id=i.id}i&&(e.name=null!==(t=i.displayName)&&void 0!==t?t:i.name)}})),i.on("PcbEngine:resetView",(function(){return n.onResetView()})),i.on("PCBView:switchSimulation",function(){var e,t=(e=regeneratorRuntime.mark((function e(t){var i,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=n.engine)&&t&&0!==t.length){e.next=4;break}return n.logger.LogDebug("Simulation data items is empty"),e.abrupt("return");case 4:return n.enabled=t.some((function(e){return e.enabled})),n.loadingSimulation=!0,e.next=8,i.loadSimulation(t);case 8:r=e.sent,n.loadingSimulation=!1,r&&(n.enabled?i.showSimulation():i.hideSimulation(),n.pcbDidLoad&&n.updateLoader());case 11:case"end":return e.stop()}}),e)})),function(){var n=this,t=arguments;return new Promise((function(i,r){var a=e.apply(n,t);function u(e){o(a,i,r,u,c,"next",e)}function c(e){o(a,i,r,u,c,"throw",e)}u(void 0)}))});return function(e){return t.apply(this,arguments)}}()),i.on("PCBView:selectSimulationNet",(function(e){n.engine.showSimulation(e.kind,e.id)})),i.on("PCBView:selectSimulationLayer",(function(e){n.engine.showSimulation(void 0,void 0,e)})),i.on("PCBView:selectSimulationViewOption",(function(e){n.engine.selectSimulationViewOption(e.text)})),i.on("PCBView:probeActivated",(function(){n.engine.changeProbeState(!0)})),i.on("PCBView:probeDeactivated",(function(){n.engine.changeProbeState(!1)})),i.on("Simulation:outdated",(function(e){n.engine.handleOutdatedSimulation(e)})),w.forEach((function(e){return i.on(e,(function(e){i.emit("sceneInteracted",e)}))}))}t()}))}},{key:"activate",value:function(e){var n=this;this.logger.LogDebug("Activate PCB 2D view"),this.active=!0,this.div=e,e.id="PCBView_container",this.engine?this.engine.init(this.Core).then((function(){return n.emitInitEvent()})).then((function(){return n.active?n.engine.showView(e,2):Promise.resolve()})).then((function(){n.active&&n.Core.bus.emit("PCBView:shown",e)})).catch((function(e){var t,r;n.updatePreview(null),e.innerError&&e.innerError.code===i.a.StoreExpired?n.updateLoader("error",e.message,"info-16","small"):((null==e||null===(t=e.innerError)||void 0===t?void 0:t.code)===i.a.WebGLNotSupported&&v.dispatchCustomErrorEvent("NotShown.WebGL"),(null==e||null===(r=e.innerError)||void 0===r?void 0:r.code)===i.a.WebGLNotSupportedExtension&&e.innerError.extensionsList.forEach((function(e){return v.dispatchCustomErrorEvent("NotShown.WebGLExtension.".concat(e))})),n.updateLoader("error",e.message,null))})):this.updateLoader("error","PCB engine has not found.",null)}},{key:"deactivate",value:function(){this.logger.LogDebug("Deactivate PCB 2D view"),this.active=!1,this.engine&&(this.engine.hideView(),this.Core.bus.emit("PCBView:hidden")),this.updateLoader()}},{key:"emitInitEvent",value:function(){var e=this;return new Promise((function(n){e.initRaised||(e.initRaised=!0,e.Core.bus.emit("PCBView:didInit")),n()}))}},{key:"onPcbDocumentLoad",value:function(e){this.active&&(this.updateLoader("large","Downloading PCB","render-loader-32"),this.updatePreview(e))}},{key:"onPcbDocumentDidLoad",value:function(){this.updatePreview(null),this.loadingSimulation||this.updateLoader(),this.pcbDidLoad=!0}},{key:"onResetView",value:function(){this.engine.resetView()}},{key:"updatePreview",value:function(e){this.preview&&(this.preview.destroy(),this.preview=null);try{e&&(this.preview=window.__APP__.preview(this.div,e.previewUrl2D))}catch(e){console.log("Setup 2D preview error")}}},{key:"updateLoader",value:function(e,n,t){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"large";if(this.loader&&(this.loader.destroy(),this.loader=null),this.div&&e&&n){var r={message:n,type:e,size:i};t&&(r.icon=t),this.loader=window.__APP__.loader(this.div,r)}}}])&&a(n.prototype,t),r&&a(n,r),Object.defineProperty(n,"prototype",{writable:!1}),d}(e))}});window.__CORE__&&window.__CORE__.addModule(e)}});